<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Jenas Datenbanksystem &apos;System J&apos;: DbjBufferContent.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>DbjBufferContent.cpp</h1><a href="_dbj_buffer_content_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************\</span>
00002 <span class="comment"> *                                                                       *</span>
00003 <span class="comment"> * (C) 2005                                                              *</span>
00004 <span class="comment"> * Lehrstuhl fuer Datenbanken und Informationssysteme                    *</span>
00005 <span class="comment"> * Friedrich-Schiller-Universitaet Jena                                  *</span>
00006 <span class="comment"> * Ernst-Abbe-Platz 1-2                                                  *</span>
00007 <span class="comment"> * 07745 Jena                                                            *</span>
00008 <span class="comment"> *                                                                       *</span>
00009 <span class="comment">\*************************************************************************/</span>
00010 
00011 <span class="preprocessor">#include &lt;iostream&gt;</span>
00012 <span class="preprocessor">#include &lt;iomanip&gt;</span>
00013 
00014 <span class="preprocessor">#include "<a class="code" href="_dbj_buffer_manager_8hpp.html">DbjBufferManager.hpp</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="_dbj_b_m_config_8hpp.html">DbjBMConfig.hpp</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="_dbj_b_m_hash_8hpp.html">DbjBMHash.hpp</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="_dbj_l_r_u_8hpp.html">DbjLRU.hpp</a>"</span>
00018 
00019 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00020 
<a name="l00021"></a><a class="code" href="_dbj_buffer_content_8cpp.html#a0">00021</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="_dbj_components_8hpp.html#a12">DbjComponent</a> <a class="code" href="_dbj_buffer_content_8cpp.html#a0">componentId</a> = <a class="code" href="_dbj_components_8hpp.html#a12a9">BufferManager</a>;
00022 
00023 <span class="comment">// Methode, die den Inhalt des Puffers auf STDOUT rausschreibt</span>
<a name="l00024"></a><a class="code" href="class_dbj_buffer_manager.html#a11">00024</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_buffer_manager.html#a11">DbjBufferManager::dump</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> dumpLru, <span class="keyword">const</span> <span class="keywordtype">bool</span> dumpHash,
00025         <span class="keyword">const</span> <span class="keywordtype">bool</span> dumpPages)<span class="keyword"> const</span>
00026 <span class="keyword"></span>{
00027     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00028     <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> outputCount = 0;
00029     <span class="keywordtype">bool</span> gotLatch = <span class="keyword">false</span>;
00030 
00031     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00032 
00033     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_buffer_manager.html#r1">latch</a> || !<a class="code" href="class_dbj_buffer_manager.html#r2">hash</a> || !<a class="code" href="class_dbj_buffer_manager.html#r3">lru</a> || !<a class="code" href="class_dbj_buffer_manager.html#r4">data</a>) {
00034         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00035         <span class="keywordflow">goto</span> cleanup;
00036     }
00037     <span class="keywordflow">if</span> (!dumpLru &amp;&amp; !dumpHash &amp;&amp; !dumpPages) {
00038         <span class="keywordflow">goto</span> cleanup;
00039     }
00040 
00041     rc = <a class="code" href="class_dbj_buffer_manager.html#r1">latch</a>-&gt;<a class="code" href="class_dbj_latch.html#a2">get</a>(DbjLatch::Shared);
00042     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00043         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00044         <span class="keywordflow">goto</span> cleanup;
00045     }
00046     gotLatch = <span class="keyword">true</span>;
00047 
00048     <span class="keywordflow">if</span> (dumpLru) {
00049         cout &lt;&lt; <span class="stringliteral">"=========================================================="</span>
00050             <span class="stringliteral">"================="</span> &lt;&lt; endl;
00051         rc = <a class="code" href="class_dbj_buffer_manager.html#r3">lru</a>-&gt;<a class="code" href="class_dbj_l_r_u.html#a8">dump</a>();
00052         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00053             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00054             <span class="keywordflow">goto</span> cleanup;
00055         }
00056     }
00057     <span class="keywordflow">if</span> (dumpHash) {
00058         cout &lt;&lt; <span class="stringliteral">"=========================================================="</span>
00059             <span class="stringliteral">"================="</span> &lt;&lt; endl;
00060         rc = <a class="code" href="class_dbj_buffer_manager.html#r2">hash</a>-&gt;<a class="code" href="class_dbj_b_m_hash.html#a5">dump</a>();
00061         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00062             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00063             <span class="keywordflow">goto</span> cleanup;
00064         }
00065     }
00066 
00067     <span class="keywordflow">if</span> (dumpPages) {
00068         cout &lt;&lt; <span class="stringliteral">"=========================================================="</span>
00069             <span class="stringliteral">"================="</span> &lt;&lt; endl;
00070         cout &lt;&lt; <span class="stringliteral">" Pages currently in buffer pool"</span> &lt;&lt; endl;
00071         cout &lt;&lt; <span class="stringliteral">"----------------------------------------------------------"</span>
00072             <span class="stringliteral">"-----------------"</span> &lt;&lt; endl;
00073         <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga15">Uint32</a> i = 0; i &lt; DBJ_BM_NUM_PAGES; i++) {
00074             <span class="keywordflow">if</span> (<a class="code" href="class_dbj_buffer_manager.html#r4">data</a>[i].<a class="code" href="class_dbj_page.html#a0">getSegmentId</a>() != 0) {
00075                 <span class="keywordflow">if</span> (outputCount % 50 == 0) {
00076                     cout &lt;&lt; <span class="stringliteral">"Slot-of-Page SegmentId    PageId       "</span>
00077                         <span class="stringliteral">"FixCount     Dirty"</span> &lt;&lt; endl;
00078                     cout &lt;&lt; <span class="stringliteral">"------------ ------------ ------------ "</span>
00079                         <span class="stringliteral">"------------ -----"</span> &lt;&lt; endl;
00080                 }
00081                 cout &lt;&lt; setw(12) &lt;&lt; i &lt;&lt; <span class="stringliteral">" "</span>
00082                      &lt;&lt; setw(12) &lt;&lt; <a class="code" href="class_dbj_buffer_manager.html#r4">data</a>[i].<a class="code" href="class_dbj_page.html#a0">getSegmentId</a>() &lt;&lt; <span class="stringliteral">" "</span>
00083                      &lt;&lt; setw(12) &lt;&lt; data[i].getPageId() &lt;&lt; <span class="stringliteral">" "</span>
00084                      &lt;&lt; setw(12) &lt;&lt; data[i].fixCount &lt;&lt; <span class="stringliteral">" "</span>
00085                      &lt;&lt; setw(5)  &lt;&lt; boolalpha &lt;&lt; data[i].dirty &lt;&lt; endl;
00086                 outputCount++;
00087             }
00088         }
00089         cout &lt;&lt; <span class="stringliteral">"----------------------------------------------------------"</span>
00090             <span class="stringliteral">"-----------------"</span> &lt;&lt; endl;
00091         cout &lt;&lt; <span class="stringliteral">" All other slots between [0, "</span> &lt;&lt; (DBJ_BM_NUM_PAGES - 1)
00092              &lt;&lt; <span class="stringliteral">"] are empty."</span> &lt;&lt; endl;
00093     }
00094     cout &lt;&lt; <span class="stringliteral">"=========================================================="</span>
00095         <span class="stringliteral">"================="</span> &lt;&lt; endl;
00096 
00097  cleanup:
00098     <span class="keywordflow">if</span> (gotLatch) {
00099         <a class="code" href="class_dbj_buffer_manager.html#r1">latch</a>-&gt;<a class="code" href="class_dbj_latch.html#a3">release</a>();
00100     }
00101     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00102 }
00103 
00104 <span class="comment">// Schreibe Hash-Informationen</span>
<a name="l00105"></a><a class="code" href="class_dbj_b_m_hash.html#a5">00105</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_b_m_hash.html#a5">DbjBMHash::dump</a>()<span class="keyword"> const</span>
00106 <span class="keyword"></span>{
00107     <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> outputCount = 0;
00108 
00109     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00110 
00111     cout &lt;&lt; <span class="stringliteral">" Content of the Buffer Pool Hash"</span> &lt;&lt; endl;
00112     cout &lt;&lt; <span class="stringliteral">"----------------------------------------------------------"</span>
00113         <span class="stringliteral">"-----------------"</span> &lt;&lt; endl;
00114     <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga15">Uint32</a> i = <a class="code" href="class_dbj_b_m_hash.html#v3">FIRST_BUCKET</a>; i &lt;= <a class="code" href="class_dbj_b_m_hash.html#v4">LAST_BUCKET</a>; i++) {
00115         <span class="keywordtype">bool</span> printBucketNumber = <span class="keyword">true</span>;
00116         <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> current = 0;
00117 
00118         <span class="keywordflow">if</span> (<a class="code" href="class_dbj_b_m_hash.html#r0">hashArray</a>[i].<a class="code" href="struct_dbj_b_m_hash_1_1_hash_entry.html#o1">next</a> == i) { <span class="comment">// Bucket ist leer</span>
00119             <span class="keywordflow">continue</span>;
00120         }
00121 
00122         current = <a class="code" href="class_dbj_b_m_hash.html#r0">hashArray</a>[i].<a class="code" href="struct_dbj_b_m_hash_1_1_hash_entry.html#o1">next</a>;
00123         <span class="keywordflow">while</span> (current != i) {
00124             <span class="keywordflow">if</span> (current &gt;= DBJ_BM_NUM_PAGES) {
00125                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00126                 <span class="keywordflow">goto</span> cleanup;
00127             }
00128 
00129             <span class="keywordflow">if</span> (outputCount % 50 == 0) {
00130                 cout &lt;&lt; <span class="stringliteral">"Bucket Slot-in-Hash SegmentId    PageId       "</span>
00131                     <span class="stringliteral">"Next"</span> &lt;&lt; endl;
00132                 cout &lt;&lt; <span class="stringliteral">"------ ------------ ------------ ------------ "</span>
00133                     <span class="stringliteral">"------------"</span> &lt;&lt; endl;
00134             }
00135             <span class="keywordflow">if</span> (printBucketNumber) {
00136                 cout &lt;&lt; setw(6) &lt;&lt; (i - FIRST_BUCKET) &lt;&lt; <span class="stringliteral">" "</span>;
00137                 printBucketNumber = <span class="keyword">false</span>;
00138             }
00139             <span class="keywordflow">else</span> {
00140                 cout &lt;&lt; <span class="stringliteral">"       "</span>;
00141             }
00142             cout &lt;&lt; setw(12) &lt;&lt; current &lt;&lt; <span class="stringliteral">" "</span>
00143                  &lt;&lt; setw(12) &lt;&lt; <a class="code" href="class_dbj_b_m_hash.html#v0">pages</a>[current].<a class="code" href="class_dbj_page.html#a0">getSegmentId</a>() &lt;&lt; <span class="stringliteral">" "</span>
00144                  &lt;&lt; setw(12) &lt;&lt; pages[current].getPageId() &lt;&lt; <span class="stringliteral">" "</span>;
00145             <span class="keywordflow">if</span> (hashArray[current].next == i) {
00146                 cout &lt;&lt; setw(12) &lt;&lt; <span class="stringliteral">"&lt;end&gt;"</span> &lt;&lt; endl;
00147             }
00148             <span class="keywordflow">else</span> {
00149                 cout &lt;&lt; setw(12) &lt;&lt; hashArray[current].next &lt;&lt; endl;
00150             }
00151             outputCount++;
00152 
00153             <span class="comment">// naechsten Eintrag in der Liste</span>
00154             current = hashArray[current].next;
00155         }
00156     }
00157     cout &lt;&lt; <span class="stringliteral">"----------------------------------------------------------"</span>
00158         <span class="stringliteral">"-----------------"</span> &lt;&lt; endl;
00159     cout &lt;&lt; <span class="stringliteral">" All other buckets between [1, "</span> &lt;&lt; DBJ_BM_NUM_HASH_BUCKETS
00160          &lt;&lt; <span class="stringliteral">"] are empty."</span> &lt;&lt; endl;
00161 
00162  cleanup:
00163     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00164 }
00165 
00166 
00167 <span class="comment">// Schreibe LRU-Informationen</span>
<a name="l00168"></a><a class="code" href="class_dbj_l_r_u.html#a8">00168</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_l_r_u.html#a8">DbjLRU::dump</a>()<span class="keyword"> const</span>
00169 <span class="keyword"></span>{
00170     <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> current = 0;
00171     <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> outputCount = 0;
00172 
00173     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00174 
00175     cout &lt;&lt; <span class="stringliteral">" Content of the LRU list"</span> &lt;&lt; endl;
00176     cout &lt;&lt; <span class="stringliteral">"----------------------------------------------------------"</span>
00177         <span class="stringliteral">"-----------------"</span> &lt;&lt; endl;
00178     cout &lt;&lt; <span class="stringliteral">" Most-recently-used page is at the top of the list;"</span> &lt;&lt; endl;
00179     cout &lt;&lt; <span class="stringliteral">" least-recently-used is at the bottom."</span> &lt;&lt; endl;
00180     cout &lt;&lt; <span class="stringliteral">"----------------------------------------------------------"</span>
00181         <span class="stringliteral">"-----------------"</span> &lt;&lt; endl;
00182     current = <a class="code" href="class_dbj_l_r_u.html#r0">lru</a>[<a class="code" href="class_dbj_l_r_u.html#v2">USED_LIST_HEAD</a>].<a class="code" href="struct_dbj_l_r_u_1_1_lru_element.html#o1">next</a>;
00183     <span class="keywordflow">while</span> (current != <a class="code" href="class_dbj_l_r_u.html#v2">USED_LIST_HEAD</a>) {
00184         <span class="keywordflow">if</span> (current == <a class="code" href="class_dbj_l_r_u.html#v1">EMPTY_LIST_HEAD</a> || current &gt;= DBJ_BM_NUM_PAGES) {
00185             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00186             <span class="keywordflow">goto</span> cleanup;
00187         }
00188 
00189         <span class="keywordflow">if</span> (outputCount % 50 == 0) {
00190             cout &lt;&lt; <span class="stringliteral">"Slot-in-LRU  SegmentId    PageId       Next"</span> &lt;&lt; endl;
00191             cout &lt;&lt; <span class="stringliteral">"------------ ------------ ------------ ------------"</span> &lt;&lt; endl;
00192         }
00193 
00194         cout &lt;&lt; setw(12) &lt;&lt; current &lt;&lt; <span class="stringliteral">" "</span>
00195              &lt;&lt; setw(12) &lt;&lt; <a class="code" href="class_dbj_l_r_u.html#v0">pages</a>[current].<a class="code" href="class_dbj_page.html#a0">getSegmentId</a>() &lt;&lt; <span class="stringliteral">" "</span>
00196              &lt;&lt; setw(12) &lt;&lt; pages[current].getPageId() &lt;&lt; <span class="stringliteral">" "</span>;
00197         <span class="keywordflow">if</span> (lru[current].next == <a class="code" href="class_dbj_l_r_u.html#v2">USED_LIST_HEAD</a>) {
00198             cout &lt;&lt; setw(12) &lt;&lt; <span class="stringliteral">"&lt;end&gt;"</span> &lt;&lt; endl;
00199         }
00200         <span class="keywordflow">else</span> {
00201             cout &lt;&lt; setw(12) &lt;&lt; lru[current].next &lt;&lt; endl;
00202         }
00203         outputCount++;
00204 
00205         <span class="comment">// naechster Eintrag</span>
00206         current = lru[current].next;
00207     }
00208 
00209     cout &lt;&lt; <span class="stringliteral">"----------------------------------------------------------"</span>
00210         <span class="stringliteral">"-----------------"</span> &lt;&lt; endl;
00211     cout &lt;&lt; <span class="stringliteral">" All other slots between [0, "</span> &lt;&lt; (DBJ_BM_NUM_PAGES-1)
00212          &lt;&lt; <span class="stringliteral">"] are empty."</span> &lt;&lt; endl;
00213 
00214  cleanup:
00215     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00216 }
00217 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jul 4 15:40:28 2005 for Jenas Datenbanksystem 'System J' by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.8 </small></address>
</body>
</html>
