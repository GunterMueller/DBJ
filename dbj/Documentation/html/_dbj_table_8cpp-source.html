<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Jenas Datenbanksystem &apos;System J&apos;: DbjTable.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>DbjTable.cpp</h1><a href="_dbj_table_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************\</span>
00002 <span class="comment"> *                                                                       *</span>
00003 <span class="comment"> * (C) 2004-2005                                                         *</span>
00004 <span class="comment"> * Lehrstuhl fuer Datenbanken und Informationssysteme                    *</span>
00005 <span class="comment"> * Friedrich-Schiller-Universitaet Jena                                  *</span>
00006 <span class="comment"> * Ernst-Abbe-Platz 1-2                                                  *</span>
00007 <span class="comment"> * 07745 Jena                                                            *</span>
00008 <span class="comment"> *                                                                       *</span>
00009 <span class="comment">\*************************************************************************/</span>
00010 
00011 <span class="preprocessor">#include "<a class="code" href="_dbj_table_8hpp.html">DbjTable.hpp</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="_dbj_index_8hpp.html">DbjIndex.hpp</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="_dbj_record_tuple_8hpp.html">DbjRecordTuple.hpp</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="_dbj_record_manager_8hpp.html">DbjRecordManager.hpp</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="_dbj_index_manager_8hpp.html">DbjIndexManager.hpp</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="_dbj_catalog_manager_8hpp.html">DbjCatalogManager.hpp</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="_dbj_index_iterator_8hpp.html">DbjIndexIterator.hpp</a>"</span>
00018 
<a name="l00019"></a><a class="code" href="_dbj_table_8cpp.html#a0">00019</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="_dbj_components_8hpp.html#a12">DbjComponent</a> <a class="code" href="_dbj_table_8cpp.html#a0">componentId</a> = <a class="code" href="_dbj_components_8hpp.html#a12a4">CatalogManager</a>;
00020 
00021 
00022 <span class="comment">// Konstruktor</span>
<a name="l00023"></a><a class="code" href="class_dbj_table.html#a0">00023</a> <a class="code" href="class_dbj_table.html#a0">DbjTable::DbjTable</a>()
00024     : tableId(DBJ_UNKNOWN_TABLE_ID), tupleCount(0), numColumns(0),
00025       columnDefs(NULL), minRecordLength(0), maxRecordLength(0),
00026       numIndexes(0), indexes(NULL), gotIndexes(false), indexMgr(NULL)
00027 {
00028     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00029 
00030     <a class="code" href="group__memory__functions.html#ga6">DbjMemSet</a>(<a class="code" href="class_dbj_table.html#r1">tableName</a>, <span class="charliteral">'\0'</span>, <span class="keyword">sizeof</span> <a class="code" href="class_dbj_table.html#r1">tableName</a>);
00031 
00032     <a class="code" href="class_dbj_table.html#r10">indexMgr</a> = <a class="code" href="class_dbj_index_manager.html#e0">DbjIndexManager::getInstance</a>();
00033 }
00034 
00035 <span class="comment">// Destruktor</span>
<a name="l00036"></a><a class="code" href="class_dbj_table.html#a1">00036</a> <a class="code" href="class_dbj_table.html#a1">DbjTable::~DbjTable</a>()
00037 {
00038     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00039 
00040     <span class="comment">// Spalten</span>
00041     <span class="keyword">delete</span> [] <a class="code" href="class_dbj_table.html#r4">columnDefs</a>;
00042 
00043     <span class="comment">// Indexe</span>
00044     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_table.html#r8">indexes</a> != NULL) {
00045         <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> i = 0; i &lt; <a class="code" href="class_dbj_table.html#r7">numIndexes</a>; i++) {
00046             <span class="keyword">delete</span> <a class="code" href="class_dbj_table.html#r8">indexes</a>[i];
00047         }
00048         <span class="keyword">delete</span> [] <a class="code" href="class_dbj_table.html#r8">indexes</a>;
00049     }
00050 }
00051 
00052 <span class="comment">// gib Tabellen-ID</span>
<a name="l00053"></a><a class="code" href="class_dbj_table.html#a2">00053</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a2">DbjTable::getTableId</a>(<a class="code" href="group__tableid.html#ga1">TableId</a> &amp;table)<span class="keyword"> const</span>
00054 <span class="keyword"></span>{
00055     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00056 
00057     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_table.html#r0">tableId</a> == DBJ_UNKNOWN_TABLE_ID || <a class="code" href="class_dbj_table.html#r0">tableId</a> &lt; DBJ_MIN_TABLE_ID ||
00058             <a class="code" href="class_dbj_table.html#r0">tableId</a> &gt; DBJ_MAX_TABLE_ID) {
00059         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00060         <span class="keywordflow">goto</span> cleanup;
00061     }
00062     table = <a class="code" href="class_dbj_table.html#r0">tableId</a>;
00063 
00064  cleanup:
00065     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00066 }
00067 
00068 <span class="comment">// gib Tabellenname</span>
<a name="l00069"></a><a class="code" href="class_dbj_table.html#a3">00069</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a3">DbjTable::getTableName</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *&amp;name)<span class="keyword"> const</span>
00070 <span class="keyword"></span>{
00071     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00072 
00073     <span class="keywordflow">if</span> (*<a class="code" href="class_dbj_table.html#r1">tableName</a> == <span class="charliteral">'\0'</span>) {
00074         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00075         <span class="keywordflow">goto</span> cleanup;
00076     }
00077     name = <a class="code" href="class_dbj_table.html#r1">tableName</a>;
00078 
00079  cleanup:
00080     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00081 }
00082 
00083 <span class="comment">// gib Anzahl der Spalten in der Tabelle</span>
<a name="l00084"></a><a class="code" href="class_dbj_table.html#a5">00084</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a5">DbjTable::getNumColumns</a>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> &amp;numCols)<span class="keyword"> const</span>
00085 <span class="keyword"></span>{
00086     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00087 
00088     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_table.html#r3">numColumns</a> == 0) {
00089         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00090         <span class="keywordflow">goto</span> cleanup;
00091     }
00092     numCols = <a class="code" href="class_dbj_table.html#r3">numColumns</a>;
00093 
00094  cleanup:
00095     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00096 }
00097 
00098 <span class="comment">// berechne minimale Laenge eines Records der Tabelle</span>
<a name="l00099"></a><a class="code" href="class_dbj_table.html#a6">00099</a> <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <a class="code" href="class_dbj_table.html#a6">DbjTable::getMinRecordLength</a>()<span class="keyword"> const</span>
00100 <span class="keyword"></span>{
00101     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00102 
00103     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_table.html#r5">minRecordLength</a> == 0) {
00104         const_cast&lt;DbjTable *&gt;(<span class="keyword">this</span>)-&gt;calculateMinMaxRecordLength();
00105     }
00106 
00107     <span class="keywordflow">return</span> <a class="code" href="class_dbj_table.html#r5">minRecordLength</a>;
00108 }
00109 
00110 <span class="comment">// berechne maximale Laenge eines Records der Tabelle</span>
<a name="l00111"></a><a class="code" href="class_dbj_table.html#a7">00111</a> <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <a class="code" href="class_dbj_table.html#a7">DbjTable::getMaxRecordLength</a>()<span class="keyword"> const</span>
00112 <span class="keyword"></span>{
00113     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00114 
00115     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_table.html#r6">maxRecordLength</a> == 0) {
00116         const_cast&lt;DbjTable *&gt;(<span class="keyword">this</span>)-&gt;calculateMinMaxRecordLength();
00117     }
00118 
00119     <span class="keywordflow">return</span> <a class="code" href="class_dbj_table.html#r6">maxRecordLength</a>;
00120 }
00121 
00122 
00123 <span class="comment">// gib bestimmten Spaltenname</span>
<a name="l00124"></a><a class="code" href="class_dbj_table.html#a8">00124</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a8">DbjTable::getColumnName</a>(<span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnNumber,
00125         <span class="keyword">const</span> <span class="keywordtype">char</span> *&amp;colName)<span class="keyword"> const</span>
00126 <span class="keyword"></span>{
00127     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00128 
00129     <span class="keywordflow">if</span> (columnNumber &gt;= <a class="code" href="class_dbj_table.html#r3">numColumns</a>) {
00130         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00131         <span class="keywordflow">goto</span> cleanup;
00132     }
00133     colName = <a class="code" href="class_dbj_table.html#r4">columnDefs</a>[columnNumber].<a class="code" href="struct_dbj_table_1_1_column_definition.html#o0">name</a>; 
00134 
00135  cleanup:
00136     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00137 }
00138 
00139 
00140 <span class="comment">// gib Spaltennummer fuer angegebenen Spaltennamen zurueck</span>
<a name="l00141"></a><a class="code" href="class_dbj_table.html#a9">00141</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a9">DbjTable::getColumnNumber</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *colName,
00142         <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> &amp;columnNumber)<span class="keyword"> const</span>
00143 <span class="keyword"></span>{
00144     <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
00145 
00146     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00147 
00148     <span class="keywordflow">if</span> (!colName) {
00149         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00150         <span class="keywordflow">goto</span> cleanup;
00151     }
00152     <a class="code" href="group__trace__def.html#ga7">DBJ_TRACE_STRING</a>(1, colName);
00153 
00154     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_table.html#r3">numColumns</a> == 0) {
00155         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00156         <span class="keywordflow">goto</span> cleanup;
00157     }
00158 
00159     <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> i = 0; i &lt; <a class="code" href="class_dbj_table.html#r3">numColumns</a>; i++) {
00160         <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(<a class="code" href="class_dbj_table.html#r4">columnDefs</a>[i].name, colName) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
00161             columnNumber = i;
00162             found = <span class="keyword">true</span>;
00163             <span class="keywordflow">break</span>;
00164         }
00165     }
00166     <span class="keywordflow">if</span> (!found) {
00167         <a class="code" href="_dbj_error_8hpp.html#a3">DBJ_SET_ERROR_TOKEN2</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a32">DBJ_CAT_COLUMN_NOT_IN_TABLE</a>, colName, <a class="code" href="class_dbj_table.html#r1">tableName</a>);
00168     }
00169 
00170  cleanup:
00171     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00172 }
00173 
00174 
00175 <span class="comment">// gib Datentyp einer Spalte zurueck</span>
<a name="l00176"></a><a class="code" href="class_dbj_table.html#a10">00176</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a10">DbjTable::getColumnDatatype</a>(<span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnNumber,
00177         DbjDataType &amp;type)<span class="keyword"> const</span>
00178 <span class="keyword"></span>{
00179     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00180 
00181     <span class="keywordflow">if</span> (columnNumber &gt;= <a class="code" href="class_dbj_table.html#r3">numColumns</a>) {
00182         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00183         <span class="keywordflow">goto</span> cleanup;
00184     }
00185     type = <a class="code" href="class_dbj_table.html#r4">columnDefs</a>[columnNumber].<a class="code" href="struct_dbj_table_1_1_column_definition.html#o1">dataType</a>;
00186 
00187  cleanup:
00188     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00189 }
00190 
00191 <span class="comment">// gib maximale Laenge der Spalte</span>
<a name="l00192"></a><a class="code" href="class_dbj_table.html#a11">00192</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a11">DbjTable::getMaxColumnLength</a>(<span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnNumber,
00193             <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> &amp;maxDataLength)<span class="keyword"> const</span>
00194 <span class="keyword"></span>{
00195     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00196 
00197     <span class="keywordflow">if</span> (columnNumber &gt;= <a class="code" href="class_dbj_table.html#r3">numColumns</a>) {
00198         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00199         <span class="keywordflow">goto</span> cleanup;
00200     }
00201     <span class="keywordflow">switch</span> (<a class="code" href="class_dbj_table.html#r4">columnDefs</a>[columnNumber].<a class="code" href="struct_dbj_table_1_1_column_definition.html#o1">dataType</a>) {
00202       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>:
00203           maxDataLength = <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>);
00204           <span class="keywordflow">break</span>;
00205       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>:
00206           maxDataLength = <a class="code" href="class_dbj_table.html#r4">columnDefs</a>[columnNumber].<a class="code" href="struct_dbj_table_1_1_column_definition.html#o3">maxLength</a>;
00207           <span class="keywordflow">break</span>;
00208       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>:
00209         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00210         <span class="keywordflow">goto</span> cleanup;
00211     }
00212 
00213  cleanup:
00214     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00215 }
00216 
00217 
00218 <span class="comment">// Sind NULL-Werte in der Spalte erlaubt?</span>
<a name="l00219"></a><a class="code" href="class_dbj_table.html#a12">00219</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a12">DbjTable::getIsNullable</a>(<span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnNumber,
00220         <span class="keywordtype">bool</span> &amp;nullable)<span class="keyword"> const</span>
00221 <span class="keyword"></span>{
00222     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00223 
00224     <span class="keywordflow">if</span> (columnNumber &gt;= <a class="code" href="class_dbj_table.html#r3">numColumns</a>) {
00225         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00226         <span class="keywordflow">goto</span> cleanup;
00227     }
00228     nullable = <a class="code" href="class_dbj_table.html#r4">columnDefs</a>[columnNumber].<a class="code" href="struct_dbj_table_1_1_column_definition.html#o2">isNullable</a>;
00229 
00230  cleanup:
00231     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00232 }
00233 
00234 
00235 <span class="comment">// setze Namen einer Spalte</span>
<a name="l00236"></a><a class="code" href="class_dbj_table.html#a14">00236</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a13">DbjTable::setColumnName</a>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnNumber, <span class="keyword">const</span> <span class="keywordtype">char</span> *colName,
00237         <span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> colNameLength)
00238 {
00239     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00240 
00241     <span class="keywordflow">if</span> (columnNumber &gt;= <a class="code" href="class_dbj_table.html#r3">numColumns</a> || !colName || colNameLength == 0) {
00242         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00243         <span class="keywordflow">goto</span> cleanup;
00244     }
00245 
00246     <span class="keywordflow">if</span> (colNameLength &gt;= <span class="keyword">sizeof</span> <a class="code" href="class_dbj_table.html#r4">columnDefs</a>[columnNumber].<a class="code" href="struct_dbj_table_1_1_column_definition.html#o0">name</a>) {
00247         <a class="code" href="_dbj_error_8hpp.html#a3">DBJ_SET_ERROR_TOKEN2</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a45">DBJ_CAT_COLUMN_NAME_TOO_LONG</a>, colName,
00248                 DBJ_MAX_COLUMN_NAME_LENGTH);
00249         <span class="keywordflow">goto</span> cleanup;
00250     }
00251     <a class="code" href="group__trace__def.html#ga7">DBJ_TRACE_STRING</a>(10, colName);
00252     <a class="code" href="group__memory__functions.html#ga5">DbjMemCopy</a>(columnDefs[columnNumber].name, colName, colNameLength);
00253     columnDefs[columnNumber].name[colNameLength] = <span class="charliteral">'\0'</span>;
00254 
00255  cleanup:
00256     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00257 }
00258 
00259 <span class="comment">// ermittle Anzahl der Index auf der Tabelle</span>
<a name="l00260"></a><a class="code" href="class_dbj_table.html#a15">00260</a> <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> <a class="code" href="class_dbj_table.html#a15">DbjTable::getNumIndexes</a>()<span class="keyword"> const</span>
00261 <span class="keyword"></span>{
00262     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00263 
00264     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00265 
00266     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_table.html#r9">gotIndexes</a>) {
00267         rc = const_cast&lt;DbjTable *&gt;(<span class="keyword">this</span>)-&gt;retrieveIndexInformation();
00268         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00269             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00270             <span class="keywordflow">goto</span> cleanup;
00271         }
00272     }
00273 
00274  cleanup:
00275     <span class="keywordflow">return</span> <a class="code" href="class_dbj_table.html#r7">numIndexes</a>;
00276 }
00277 
00278 
00279 <span class="comment">// gib Index-Deskriptor</span>
<a name="l00280"></a><a class="code" href="class_dbj_table.html#a16">00280</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a16">DbjTable::getIndex</a>(<span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> indexPosition, <a class="code" href="class_dbj_index.html">DbjIndex</a> *&amp;index)
00281     <span class="keyword">const</span>
00282 {
00283     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00284 
00285     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00286 
00287     <span class="keywordflow">if</span> (!gotIndexes) {
00288         rc = const_cast&lt;DbjTable *&gt;(<span class="keyword">this</span>)-&gt;retrieveIndexInformation();
00289         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00290             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00291             <span class="keywordflow">goto</span> cleanup;
00292         }
00293     }
00294     <span class="keywordflow">if</span> (indexPosition &gt; numIndexes) {
00295         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00296         <span class="keywordflow">goto</span> cleanup;
00297     }
00298     index = indexes[indexPosition];
00299 
00300  cleanup:
00301     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00302 }
00303 
00304 
00305 <span class="comment">// ermittle, ob Index auf Spalte existiert</span>
<a name="l00306"></a><a class="code" href="class_dbj_table.html#a17">00306</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a17">DbjTable::hasIndexOfType</a>(<span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnNumber,
00307         <span class="keyword">const</span> DbjIndexType &amp;indexType, <a class="code" href="group__tableid.html#ga5">IndexId</a> &amp;indexId)<span class="keyword"> const</span>
00308 <span class="keyword"></span>{
00309     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00310     <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
00311 
00312     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00313 
00314     <span class="keywordflow">if</span> (columnNumber &gt; <a class="code" href="class_dbj_table.html#r3">numColumns</a>) {
00315         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00316         <span class="keywordflow">goto</span> cleanup;
00317     }
00318     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_table.html#r9">gotIndexes</a>) {
00319         rc = const_cast&lt;DbjTable *&gt;(<span class="keyword">this</span>)-&gt;retrieveIndexInformation();
00320         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00321             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00322             <span class="keywordflow">goto</span> cleanup;
00323         }
00324     }
00325 
00326     <span class="comment">// durchlaufe das Array aller Indexe der Tabelle</span>
00327     <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> i = 0; i &lt; <a class="code" href="class_dbj_table.html#r7">numIndexes</a>; i++) {
00328         <a class="code" href="group__datatypes.html#ga1">DbjIndexType</a> type = <a class="code" href="group__datatypes.html#gga1a37">UnknownIndexType</a>;
00329         <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> colNumber = 0;
00330         rc = <a class="code" href="class_dbj_table.html#r8">indexes</a>[i]-&gt;<a class="code" href="class_dbj_index.html#a5">getColumnNumber</a>(colNumber);
00331         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00332             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00333             <span class="keywordflow">goto</span> cleanup;
00334         }
00335         <span class="keywordflow">if</span> (colNumber != columnNumber) {
00336             <span class="keywordflow">continue</span>;
00337         }
00338         rc = indexes[i]-&gt;getIndexType(type);
00339         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00340             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00341             <span class="keywordflow">goto</span> cleanup;
00342         }
00343         <span class="keywordflow">if</span> (type == indexType) {
00344             rc = indexes[i]-&gt;getIndexId(indexId);
00345             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00346                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00347                 <span class="keywordflow">goto</span> cleanup;
00348             }
00349             found = <span class="keyword">true</span>;
00350             <span class="keywordflow">break</span>;
00351         }
00352     }
00353     <span class="keywordflow">if</span> (!found) {
00354         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a4">DBJ_NOT_FOUND_WARN</a>);
00355         <span class="keywordflow">goto</span> cleanup;
00356     }
00357 
00358  cleanup:
00359     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00360 }
00361 
00362 
00363 <span class="comment">// Benenne Tabelle</span>
<a name="l00364"></a><a class="code" href="class_dbj_table.html#a19">00364</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a18">DbjTable::setTableName</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *table, <span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> length)
00365 {
00366     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00367 
00368     <span class="keywordflow">if</span> (!table || length == 0) {
00369         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00370         <span class="keywordflow">goto</span> cleanup;
00371     }
00372     <span class="keywordflow">if</span> (length &gt;= <span class="keyword">sizeof</span> <a class="code" href="class_dbj_table.html#r1">tableName</a>) {
00373         <span class="keywordtype">char</span> *terminated = <span class="keyword">new</span> <span class="keywordtype">char</span>[length+1];
00374         <span class="keywordflow">if</span> (!terminated) {
00375             <span class="keywordflow">goto</span> cleanup;
00376         }
00377         <a class="code" href="group__memory__functions.html#ga5">DbjMemCopy</a>(terminated, table, length);
00378         terminated[length] = <span class="charliteral">'\0'</span>;
00379         <a class="code" href="_dbj_error_8hpp.html#a3">DBJ_SET_ERROR_TOKEN2</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a44">DBJ_CAT_TABLE_NAME_TOO_LONG</a>, terminated,
00380                 DBJ_MAX_TABLE_NAME_LENGTH);
00381         <span class="keyword">delete</span> terminated;
00382         <span class="keywordflow">goto</span> cleanup;
00383     }
00384 
00385     <a class="code" href="group__memory__functions.html#ga5">DbjMemCopy</a>(<a class="code" href="class_dbj_table.html#r1">tableName</a>, table, length);
00386     <a class="code" href="class_dbj_table.html#r1">tableName</a>[length] = <span class="charliteral">'\0'</span>;
00387 
00388  cleanup:
00389     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00390 }
00391 
00392 <span class="comment">// Erzeuge Spalten</span>
<a name="l00393"></a><a class="code" href="class_dbj_table.html#a20">00393</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a20">DbjTable::createColumns</a>(<span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> num)
00394 {
00395     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00396     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(1, <span class="stringliteral">"Number of columns in table"</span>, num);
00397 
00398     <span class="keywordflow">if</span> (num == 0) {
00399         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00400         <span class="keywordflow">goto</span> cleanup;
00401     }
00402     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_table.html#r3">numColumns</a> &gt; 0) {
00403         <span class="keyword">delete</span> [] <a class="code" href="class_dbj_table.html#r4">columnDefs</a>;
00404     }
00405     <a class="code" href="class_dbj_table.html#r4">columnDefs</a> = <span class="keyword">new</span> <a class="code" href="struct_dbj_table_1_1_column_definition.html">ColumnDefinition</a>[num];
00406     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_table.html#r4">columnDefs</a>) {
00407         <span class="keywordflow">goto</span> cleanup;
00408     }
00409     <a class="code" href="class_dbj_table.html#r3">numColumns</a> = num;
00410 
00411  cleanup:
00412     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00413 }
00414 
00415 
00416 <span class="comment">// Setze Spaltendefinition</span>
<a name="l00417"></a><a class="code" href="class_dbj_table.html#a21">00417</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#a21">DbjTable::setColumnDefinition</a>(<span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnNumber,
00418         <span class="keyword">const</span> <span class="keywordtype">char</span> *colName, <span class="keyword">const</span> DbjDataType type,
00419         <span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> maxDataLength, <span class="keyword">const</span> <span class="keywordtype">bool</span> nulls)
00420 {
00421     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00422     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> maxLength = 0;
00423 
00424     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00425 
00426     <span class="keywordflow">if</span> (columnNumber &gt;= <a class="code" href="class_dbj_table.html#r3">numColumns</a> || colName == NULL ||
00427             type == <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>) {
00428         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00429         <span class="keywordflow">goto</span> cleanup;
00430     }
00431     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(1, <span class="stringliteral">"Spaltennummer"</span>, columnNumber);
00432 
00433     <span class="keywordflow">switch</span> (type) {
00434       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>:
00435           <span class="keywordflow">if</span> (maxDataLength == 0) {
00436               <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00437               <span class="keywordflow">goto</span> cleanup;
00438           }
00439           maxLength = maxDataLength;
00440           <span class="keywordflow">break</span>;
00441       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>:
00442           maxLength = <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>);
00443       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>:
00444           <span class="keywordflow">break</span>;
00445     }
00446 
00447     <span class="comment">// Werte setzen</span>
00448     rc = <a class="code" href="class_dbj_table.html#a13">setColumnName</a>(columnNumber, colName);
00449     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00450         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00451         <span class="keywordflow">goto</span> cleanup;
00452     }
00453     <a class="code" href="class_dbj_table.html#r4">columnDefs</a>[columnNumber].<a class="code" href="struct_dbj_table_1_1_column_definition.html#o1">dataType</a> = type;
00454     <a class="code" href="class_dbj_table.html#r4">columnDefs</a>[columnNumber].<a class="code" href="struct_dbj_table_1_1_column_definition.html#o2">isNullable</a> = nulls;
00455     <a class="code" href="class_dbj_table.html#r4">columnDefs</a>[columnNumber].<a class="code" href="struct_dbj_table_1_1_column_definition.html#o3">maxLength</a> = maxLength;
00456 
00457     <span class="comment">// invalidiere Recordlaengen</span>
00458     <a class="code" href="class_dbj_table.html#r5">minRecordLength</a> = 0;
00459     <a class="code" href="class_dbj_table.html#r6">maxRecordLength</a> = 0;
00460 
00461  cleanup:
00462     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00463 }
00464 
<a name="l00465"></a><a class="code" href="class_dbj_table.html#d0">00465</a> <span class="keywordtype">void</span> <a class="code" href="class_dbj_table.html#d0">DbjTable::calculateMinMaxRecordLength</a>()
00466 {
00467     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> min = 0;
00468     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> max = 0;
00469 
00470     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00471 
00472     <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> i = 0; i &lt; <a class="code" href="class_dbj_table.html#r3">numColumns</a>; i++) {
00473         <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> dataType = <a class="code" href="class_dbj_table.html#r4">columnDefs</a>[i].<a class="code" href="struct_dbj_table_1_1_column_definition.html#o1">dataType</a>;
00474         <span class="keywordtype">bool</span> isNullable = columnDefs[i].isNullable;
00475         <span class="keywordflow">if</span> (dataType == <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a> &amp;&amp; isNullable == <span class="keyword">false</span>) {
00476             min += <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>);
00477             max += <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>);
00478         }
00479         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dataType == <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a> &amp;&amp; isNullable == <span class="keyword">true</span>) {
00480             min += 1; 
00481             max += 1 + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>);
00482         }
00483         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dataType == <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a> &amp;&amp; isNullable == <span class="keyword">false</span>) {
00484             min += <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>);
00485             max += <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>) + columnDefs[i].maxLength;
00486         }
00487         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dataType == <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a> &amp;&amp; isNullable == <span class="keyword">true</span>) {
00488             min += 1;
00489             max += 1 + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>) + columnDefs[i].maxLength;
00490         }
00491     }
00492 
00493     <a class="code" href="class_dbj_table.html#r6">maxRecordLength</a> = max;
00494     <a class="code" href="class_dbj_table.html#r5">minRecordLength</a> = min;
00495 
00496     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(10, <span class="stringliteral">"Max record length"</span>, <a class="code" href="class_dbj_table.html#r6">maxRecordLength</a>);
00497     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(11, <span class="stringliteral">"Min record length"</span>, <a class="code" href="class_dbj_table.html#r5">minRecordLength</a>);
00498 }
00499 
00500 <span class="comment">// Hole alle Index-Deskriptoren</span>
<a name="l00501"></a><a class="code" href="class_dbj_table.html#d1">00501</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_table.html#d1">DbjTable::retrieveIndexInformation</a>()
00502 {
00503     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00504     <a class="code" href="class_dbj_catalog_manager.html">DbjCatalogManager</a> *catalogMgr = <a class="code" href="class_dbj_catalog_manager.html#e0">DbjCatalogManager::getInstance</a>();
00505     <a class="code" href="class_dbj_table.html">DbjTable</a> *sysIndexes = NULL;
00506     <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> arraySize = 0;
00507     <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> nextPos = 0;
00508     <a class="code" href="class_dbj_index_key.html">DbjIndexKey</a> key;
00509     <a class="code" href="class_dbj_index_iterator.html">DbjIndexIterator</a> *iter = NULL;
00510     <a class="code" href="class_dbj_record_manager.html">DbjRecordManager</a> *recordMgr = <a class="code" href="class_dbj_record_manager.html#e0">DbjRecordManager::getInstance</a>();
00511     <a class="code" href="class_dbj_record.html">DbjRecord</a> *record = NULL;
00512 
00513     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00514 
00515     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_table.html#r0">tableId</a> == DBJ_UNKNOWN_TABLE_ID || <a class="code" href="class_dbj_table.html#r9">gotIndexes</a> || <a class="code" href="class_dbj_table.html#r7">numIndexes</a> &gt; 0 ||
00516             !catalogMgr) {
00517         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00518         <span class="keywordflow">goto</span> cleanup;
00519     }
00520 
00521     rc = catalogMgr-&gt;<a class="code" href="class_dbj_catalog_manager.html#a2">getTableDescriptor</a>(DbjCatalogManager::SYSINDEXES_ID,
00522             sysIndexes);
00523     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00524         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00525         <span class="keywordflow">goto</span> cleanup;
00526     }
00527 
00528     <span class="comment">// stelle Speicher fuer die Zeiger auf die Deskriptoren zur Verfuegung</span>
00529     arraySize = 10;
00530     <a class="code" href="class_dbj_table.html#r8">indexes</a> = <span class="keyword">new</span> <a class="code" href="class_dbj_index.html">DbjIndex</a> *[arraySize];
00531     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_table.html#r8">indexes</a>) {
00532         <span class="keywordflow">goto</span> cleanup;
00533     }
00534     <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga15">Uint32</a> i = 0; i &lt; arraySize; i++) {
00535         <a class="code" href="class_dbj_table.html#r8">indexes</a>[i] = 0;
00536     }
00537 
00538     <span class="comment">// finde alle Indexe auf der aktuellen Tabelle</span>
00539     key.<a class="code" href="class_dbj_index_key.html#o0">dataType</a> = <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>;
00540     key.<a class="code" href="class_dbj_index_key.html#o1">intKey</a> = <a class="code" href="class_dbj_table.html#r0">tableId</a>;
00541     rc = <a class="code" href="class_dbj_table.html#r10">indexMgr</a>-&gt;<a class="code" href="class_dbj_index_manager.html#a6">findRange</a>(DbjCatalogManager::IDX_SYSINDEXES_TABLEID_ID,
00542             &amp;key, &amp;key, iter);
00543     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00544         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00545         <span class="keywordflow">goto</span> cleanup;
00546     }
00547     <span class="keywordflow">while</span> (iter-&gt;<a class="code" href="class_dbj_index_iterator.html#a1">hasNext</a>()) {
00548         <a class="code" href="struct_tuple_id.html">TupleId</a> tupleId;
00549         <a class="code" href="group__tableid.html#ga5">IndexId</a> idxId = DBJ_UNKNOWN_INDEX_ID;
00550 
00551         rc = iter-&gt;<a class="code" href="class_dbj_index_iterator.html#a2">getNextTupleId</a>(tupleId);
00552         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00553             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00554             <span class="keywordflow">goto</span> cleanup;
00555         }
00556         rc = recordMgr-&gt;<a class="code" href="class_dbj_record_manager.html#a5">get</a>(DbjCatalogManager::SYSINDEXES_ID, tupleId, record);
00557         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00558             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00559             <span class="keywordflow">goto</span> cleanup;
00560         }
00561         {
00562             <span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga12">Sint32</a> *catIndexId = NULL;
00563             <a class="code" href="class_dbj_record_tuple.html">DbjRecordTuple</a> recTuple(record, sysIndexes);
00564             <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00565                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00566                 <span class="keywordflow">goto</span> cleanup;
00567             }
00568             record = NULL;
00569             rc = recTuple.<a class="code" href="class_dbj_record_tuple.html#a6">getInt</a>(2, catIndexId);
00570             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00571                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00572                 <span class="keywordflow">goto</span> cleanup;
00573             }
00574             <span class="keywordflow">if</span> (!catIndexId || *catIndexId &lt; DBJ_MIN_INDEX_ID ||
00575                     *catIndexId &gt; DBJ_MAX_INDEX_ID) {
00576                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a42">DBJ_CAT_INCONSISTENT_CATALOG</a>);
00577                 <span class="keywordflow">goto</span> cleanup;
00578             }
00579             idxId = *catIndexId;
00580         }
00581 
00582         <span class="comment">// hole Index-Descriptor vom Catalog Mgr</span>
00583         rc = catalogMgr-&gt;<a class="code" href="class_dbj_catalog_manager.html#a4">getIndexDescriptor</a>(idxId, <a class="code" href="class_dbj_table.html#r8">indexes</a>[nextPos]);
00584         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00585             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00586             <span class="keywordflow">goto</span> cleanup;
00587         }
00588         nextPos++;
00589 
00590         <span class="comment">// nicht mehr genuegend Speicher, um die Zeiger alle zu hinterlegen -</span>
00591         <span class="comment">// hole mehr Speicher</span>
00592         <span class="keywordflow">if</span> (nextPos &gt;= arraySize) {
00593             DbjIndex **tmp = <a class="code" href="class_dbj_table.html#r8">indexes</a>;
00594 
00595             arraySize += 10;
00596             indexes = <span class="keyword">new</span> DbjIndex *[arraySize];
00597             <span class="keywordflow">if</span> (!indexes) {
00598                 <span class="keywordflow">goto</span> cleanup;
00599             }
00600 
00601             <span class="comment">// kopiere alte Zeiger und initialisiere neue Positionen</span>
00602             <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga15">Uint32</a> i = 0; i &lt; nextPos; i++) {
00603                 indexes[i] = tmp[i];
00604             }
00605             <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga15">Uint32</a> i = nextPos; i &lt; arraySize; i++) {
00606                 indexes[i] = NULL;
00607             }
00608             <span class="keyword">delete</span> [] tmp;
00609         }
00610     }
00611     <a class="code" href="class_dbj_table.html#r9">gotIndexes</a> = <span class="keyword">true</span>;
00612     <a class="code" href="class_dbj_table.html#r7">numIndexes</a> = nextPos;
00613 
00614  cleanup:
00615     <span class="keyword">delete</span> sysIndexes;
00616     <span class="keyword">delete</span> iter;
00617     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00618 }
00619 
00620 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jul 4 15:40:30 2005 for Jenas Datenbanksystem 'System J' by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.8 </small></address>
</body>
</html>
