<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Jenas Datenbanksystem &apos;System J&apos;: DbjCompiler.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>DbjCompiler.cpp</h1><a href="_dbj_compiler_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************\</span>
00002 <span class="comment"> *                                                                       *</span>
00003 <span class="comment"> * (C) 2004-2005                                                         *</span>
00004 <span class="comment"> * Lehrstuhl fuer Datenbanken und Informationssysteme                    *</span>
00005 <span class="comment"> * Friedrich-Schiller-Universitaet Jena                                  *</span>
00006 <span class="comment"> * Ernst-Abbe-Platz 1-2                                                  *</span>
00007 <span class="comment"> * 07745 Jena                                                            *</span>
00008 <span class="comment"> *                                                                       *</span>
00009 <span class="comment">\*************************************************************************/</span>
00010 
00011 <span class="preprocessor">#include &lt;locale.h&gt;</span> <span class="comment">// setlocale()</span>
00012 <span class="preprocessor">#include &lt;stdlib.h&gt;</span> <span class="comment">// strtol()</span>
00013 <span class="preprocessor">#include &lt;ctype.h&gt;</span>  <span class="comment">// isspace(), isalnum(), toupper()</span>
00014 <span class="preprocessor">#include &lt;limits.h&gt;</span> <span class="comment">// LONG_MIN, LONG_MAX</span>
00015 
00016 <span class="preprocessor">#include "<a class="code" href="_dbj_compiler_8hpp.html">DbjCompiler.hpp</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="_dbj_access_plan_8hpp.html">DbjAccessPlan.hpp</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="_dbj_catalog_manager_8hpp.html">DbjCatalogManager.hpp</a>"</span>
00019 
00020 <span class="preprocessor">#include "<a class="code" href="_dbj_parser_token_8hpp.html">DbjParserToken.hpp</a>"</span>
00021 <span class="preprocessor">#include "<a class="code" href="_dbj_parser_8hpp.html">DbjParser.hpp</a>"</span> <span class="comment">// Tokens von Bison-generierten Parser</span>
00022 
00023 
<a name="l00024"></a><a class="code" href="_dbj_compiler_8cpp.html#a1">00024</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="_dbj_components_8hpp.html#a12">DbjComponent</a> <a class="code" href="_dbj_compiler_8cpp.html#a1">componentId</a> = <a class="code" href="_dbj_components_8hpp.html#a12a2">Compiler</a>;
00025 
00026 <span class="comment">// Konstruktor</span>
<a name="l00027"></a><a class="code" href="class_dbj_compiler.html#a0">00027</a> <a class="code" href="class_dbj_compiler.html#a0">DbjCompiler::DbjCompiler</a>()
00028     : plan(NULL), stmtString(NULL), stmtStringEnd(NULL),
00029       currentPos(NULL), catalogMgr(NULL)
00030 {
00031     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00032 
00033     <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a> = <a class="code" href="class_dbj_catalog_manager.html#e0">DbjCatalogManager::getInstance</a>();
00034 }
00035 
00036 <span class="comment">// Destruktor</span>
<a name="l00037"></a><a class="code" href="class_dbj_compiler.html#a1">00037</a> <a class="code" href="class_dbj_compiler.html#a1">DbjCompiler::~DbjCompiler</a>()
00038 {
00039     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00040     <span class="keyword">delete</span> <a class="code" href="class_dbj_compiler.html#r0">plan</a>;
00041 }
00042 
00043 
00044 <span class="comment">// Parse string and build initial access plan</span>
<a name="l00045"></a><a class="code" href="class_dbj_compiler.html#a2">00045</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#a2">DbjCompiler::parse</a>(<span class="keywordtype">char</span> <span class="keyword">const</span> *statement,
00046         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *&amp;accessPlan)
00047 {
00048     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00049 
00050     <span class="comment">// switch to default locale the user might have defined</span>
00051     setlocale(LC_ALL, <span class="stringliteral">""</span>);
00052 
00053     <span class="comment">// check parameters</span>
00054     <span class="keywordflow">if</span> (!statement || *statement == <span class="charliteral">'\0'</span> || accessPlan != NULL) {
00055         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00056         <span class="keywordflow">goto</span> cleanup;
00057     }
00058     <a class="code" href="group__trace__def.html#ga7">DBJ_TRACE_STRING</a>(1, statement);
00059 
00060     <a class="code" href="class_dbj_compiler.html#r1">stmtString</a> = statement;
00061     <a class="code" href="class_dbj_compiler.html#r2">stmtStringEnd</a> = statement + strlen(statement);
00062     <a class="code" href="class_dbj_compiler.html#r3">currentPos</a> = <a class="code" href="class_dbj_compiler.html#r1">stmtString</a>;
00063 
00064     {
00065         <span class="keywordtype">int</span> yyrc = <a class="code" href="class_dbj_compiler.html#d3">yyparse</a>();
00066         accessPlan = <a class="code" href="class_dbj_compiler.html#r0">plan</a>;
00067         <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00068             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00069             <span class="keywordflow">goto</span> cleanup;
00070         }
00071         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (yyrc != 0) {
00072             <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a7">DBJ_COMPILER_PARSE_FAIL</a>, yyrc);
00073             <span class="keywordflow">goto</span> cleanup;
00074         }
00075     }
00076     <span class="keywordflow">if</span> (!accessPlan) {
00077         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a8">DBJ_COMPILER_NO_ACCESS_PLAN</a>);
00078         <span class="keywordflow">goto</span> cleanup;
00079     }
00080         
00081  cleanup:
00082     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_compiler.html#r0">plan</a> != accessPlan &amp;&amp; <a class="code" href="class_dbj_compiler.html#r0">plan</a> != NULL) {
00083         <span class="keyword">delete</span> <a class="code" href="class_dbj_compiler.html#r0">plan</a>;
00084     }
00085     <a class="code" href="class_dbj_compiler.html#r0">plan</a> = NULL;
00086     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00087 }
00088 
00089 
00090 <span class="comment">// Validiere Zugriffsplan</span>
<a name="l00091"></a><a class="code" href="class_dbj_compiler.html#a3">00091</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#a3">DbjCompiler::validatePlan</a>(<a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *&amp;accessPlan)
00092 {
00093     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00094 
00095     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00096 
00097     <span class="keywordflow">if</span> (!accessPlan) {
00098         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00099         <span class="keywordflow">goto</span> cleanup;
00100     }
00101     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_compiler.html#r0">plan</a> != NULL) {
00102         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00103         <span class="keywordflow">goto</span> cleanup;
00104     }
00105     <a class="code" href="class_dbj_compiler.html#r0">plan</a> = accessPlan;
00106 
00107     <span class="keywordflow">switch</span> (<a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>()) {
00108       <span class="keywordflow">case</span> DbjAccessPlan::CreateTableStmt:
00109           rc = <a class="code" href="class_dbj_compiler.html#d7">validateCreateTable</a>();
00110           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00111               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00112               <span class="keywordflow">goto</span> cleanup;
00113           }
00114           <span class="keywordflow">break</span>;
00115       <span class="keywordflow">case</span> DbjAccessPlan::DropTableStmt:
00116           rc = <a class="code" href="class_dbj_compiler.html#d8">validateDropTable</a>();
00117           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00118               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00119               <span class="keywordflow">goto</span> cleanup;
00120           }
00121           <span class="keywordflow">break</span>;
00122       <span class="keywordflow">case</span> DbjAccessPlan::CreateIndexStmt:
00123           rc = <a class="code" href="class_dbj_compiler.html#d9">validateCreateIndex</a>();
00124           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00125               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00126               <span class="keywordflow">goto</span> cleanup;
00127           }
00128           <span class="keywordflow">break</span>;
00129       <span class="keywordflow">case</span> DbjAccessPlan::DropIndexStmt:
00130           rc = <a class="code" href="class_dbj_compiler.html#d10">validateDropIndex</a>();
00131           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00132               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00133               <span class="keywordflow">goto</span> cleanup;
00134           }
00135           <span class="keywordflow">break</span>;
00136       <span class="keywordflow">case</span> DbjAccessPlan::InsertStmt:
00137           rc = <a class="code" href="class_dbj_compiler.html#d11">validateInsert</a>();
00138           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00139               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00140               <span class="keywordflow">goto</span> cleanup;
00141           }
00142           <span class="keywordflow">break</span>;
00143       <span class="keywordflow">case</span> DbjAccessPlan::UpdateStmt:
00144           rc = <a class="code" href="class_dbj_compiler.html#d12">validateUpdate</a>();
00145           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00146               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00147               <span class="keywordflow">goto</span> cleanup;
00148           }
00149           <span class="keywordflow">break</span>;
00150       <span class="keywordflow">case</span> DbjAccessPlan::DeleteStmt:
00151           rc = <a class="code" href="class_dbj_compiler.html#d13">validateDelete</a>();
00152           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00153               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00154               <span class="keywordflow">goto</span> cleanup;
00155           }
00156           <span class="keywordflow">break</span>;
00157       <span class="keywordflow">case</span> DbjAccessPlan::SelectStmt:
00158           rc = <a class="code" href="class_dbj_compiler.html#d14">validateSelect</a>();
00159           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00160               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00161               <span class="keywordflow">goto</span> cleanup;
00162           }
00163           <span class="keywordflow">break</span>;
00164       <span class="keywordflow">case</span> DbjAccessPlan::CommitStmt:
00165       <span class="keywordflow">case</span> DbjAccessPlan::RollbackStmt:
00166           rc = <a class="code" href="class_dbj_compiler.html#d17">validateEndOfTransaction</a>();
00167           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00168               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00169               <span class="keywordflow">goto</span> cleanup;
00170           }
00171           <span class="keywordflow">break</span>;
00172       <span class="keywordflow">default</span>:
00173           <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00174           <span class="keywordflow">goto</span> cleanup;
00175     }
00176 
00177  cleanup:
00178     accessPlan = <a class="code" href="class_dbj_compiler.html#r0">plan</a>;
00179     plan = NULL;
00180     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00181 }
00182 
00183 
00184 <span class="comment">// Erzeuge Knoten (mit '\0'-terminierten textuellen Wert)</span>
<a name="l00185"></a><a class="code" href="class_dbj_compiler.html#d0">00185</a> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *<a class="code" href="class_dbj_compiler.html#d0">DbjCompiler::createNode</a>(DbjAccessPlan::NodeType nodeType,
00186         <span class="keywordtype">char</span> <span class="keyword">const</span> *textValue)
00187 {
00188     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00189     <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *node = NULL;
00190 
00191     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00192 
00193     <span class="comment">// erzeuge Knoten</span>
00194     <span class="keywordflow">switch</span> (nodeType) {
00195       <span class="keywordflow">case</span> DbjAccessPlan::Table: node = <span class="keyword">new</span> <a class="code" href="class_dbj_access_plan_table.html">DbjAccessPlanTable</a>(); <span class="keywordflow">break</span>;
00196       <span class="keywordflow">case</span> DbjAccessPlan::Column: node = <span class="keyword">new</span> <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a>(); <span class="keywordflow">break</span>;
00197       <span class="keywordflow">default</span>: node = <span class="keyword">new</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a>(nodeType); <span class="keywordflow">break</span>;
00198     }
00199     <span class="keywordflow">if</span> (!node) {
00200         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00201         <span class="keywordflow">goto</span> cleanup;
00202     }
00203 
00204     <span class="comment">// setze Text wenn angegeben</span>
00205     <span class="keywordflow">if</span> (textValue != NULL) {
00206         rc = node-&gt;<a class="code" href="class_dbj_access_plan.html#d4">setStringData</a>(textValue);
00207         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00208             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00209             <span class="keywordflow">goto</span> cleanup;
00210         }
00211     }
00212 
00213  cleanup:
00214     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00215         <span class="keyword">delete</span> node;
00216         node = NULL;
00217     }
00218     <span class="keywordflow">return</span> node;
00219 }
00220 
00221 
00222 <span class="comment">// Erzeuge Knoten</span>
<a name="l00223"></a><a class="code" href="class_dbj_compiler.html#d2">00223</a> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *<a class="code" href="class_dbj_compiler.html#d0">DbjCompiler::createNode</a>(DbjAccessPlan::NodeType nodeType,
00224         <a class="code" href="class_dbj_access_plan_1_1_string_value.html">DbjAccessPlan::StringValue</a> <span class="keyword">const</span> &amp;textValue)
00225 {
00226     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00227     <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *node = NULL;
00228 
00229     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00230 
00231     <span class="comment">// erzeuge Knoten</span>
00232     node = <a class="code" href="class_dbj_compiler.html#d0">createNode</a>(nodeType, textValue.<a class="code" href="class_dbj_access_plan_1_1_string_value.html#o1">data</a>);
00233     <span class="keywordflow">if</span> (!node) {
00234         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00235         <span class="keywordflow">goto</span> cleanup;
00236     }
00237 
00238     <span class="comment">// setze Text</span>
00239     rc = node-&gt;<a class="code" href="class_dbj_access_plan.html#d4">setStringData</a>(textValue);
00240     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00241         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00242         <span class="keywordflow">goto</span> cleanup;
00243     }
00244 
00245     <span class="comment">// Tabellen- Spalten- und Indexnamen werden im Rest des Systems nur in</span>
00246     <span class="comment">// Grossbuchstaben mitgefuehrt</span>
00247     <span class="keywordflow">if</span> (nodeType == DbjAccessPlan::Table ||
00248             nodeType == DbjAccessPlan::Column ||
00249             nodeType == DbjAccessPlan::Index ||
00250             nodeType == DbjAccessPlan::UniqueIndex) {
00251         rc = node-&gt;<a class="code" href="class_dbj_access_plan.html#d5">convertStringToUpperCase</a>();
00252         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00253             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00254             <span class="keywordflow">goto</span> cleanup;
00255         }
00256     }
00257 
00258  cleanup:
00259     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00260         <span class="keyword">delete</span> node;
00261         node = NULL;
00262     }
00263     <span class="keywordflow">return</span> node;
00264 }
00265 
00266 
00267 <span class="comment">// Kopiere gegebenen Knoten</span>
<a name="l00268"></a><a class="code" href="class_dbj_compiler.html#d1">00268</a> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *<a class="code" href="class_dbj_compiler.html#d1">DbjCompiler::copyNode</a>(<a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> <span class="keyword">const</span> *node)
00269 {
00270     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00271     <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *copy = NULL;
00272     <a class="code" href="group__int__datatypes.html#ga12">Sint32</a> <span class="keyword">const</span> *intData = NULL;
00273 
00274     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00275 
00276     <span class="comment">// erzeuge Knoten</span>
00277     copy = <a class="code" href="class_dbj_compiler.html#d0">createNode</a>(node-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>(), node-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
00278     <span class="keywordflow">if</span> (!copy) {
00279         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00280         <span class="keywordflow">goto</span> cleanup;
00281     }
00282     intData = node-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>();
00283     <span class="keywordflow">if</span> (intData != NULL) {
00284         rc = copy-&gt;<a class="code" href="class_dbj_access_plan.html#d7">setIntData</a>(*intData);
00285         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00286             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00287             <span class="keywordflow">goto</span> cleanup;
00288         }
00289     }
00290 
00291  cleanup:
00292     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00293         <span class="keyword">delete</span> copy;
00294         copy = NULL;
00295     }
00296     <span class="keywordflow">return</span> copy;
00297 }
00298 
00299 
00300 <span class="comment">// Makro zum Abgleich eines Tokens im String</span>
<a name="l00301"></a><a class="code" href="_dbj_compiler_8cpp.html#a0">00301</a> <span class="preprocessor">#define MATCH_TOKEN(str, token)                                 \</span>
00302 <span class="preprocessor">        if (checkSymbolMatch(currentPos, str)) {                \</span>
00303 <span class="preprocessor">            currentPos += strlen(str);                          \</span>
00304 <span class="preprocessor">            return token;                                       \</span>
00305 <span class="preprocessor">        }</span>
00306 <span class="preprocessor"></span>
00307 
00308 <span class="comment">// Lexer</span>
<a name="l00309"></a><a class="code" href="class_dbj_compiler.html#d4">00309</a> <span class="keywordtype">int</span> <a class="code" href="class_dbj_compiler.html#d4">DbjCompiler::yylex</a>(<span class="keywordtype">void</span> *tokenVal)
00310 {
00311     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00312 
00313     <a class="code" href="_dbj_parser_8hpp.html#a53">YYSTYPE</a> *tokenValue = static_cast&lt;YYSTYPE *&gt;(tokenVal);
00314 
00315     <span class="comment">// parse the whole string</span>
00316     <span class="keywordflow">while</span> (<a class="code" href="class_dbj_compiler.html#r3">currentPos</a> &lt; <a class="code" href="class_dbj_compiler.html#r2">stmtStringEnd</a>) {
00317         <span class="comment">// skip any whitespaces</span>
00318         <span class="keywordflow">while</span> (isspace(*<a class="code" href="class_dbj_compiler.html#r3">currentPos</a>)) {
00319             <a class="code" href="class_dbj_compiler.html#r3">currentPos</a>++;
00320         }
00321         <span class="keywordflow">if</span> (*<a class="code" href="class_dbj_compiler.html#r3">currentPos</a> == <span class="charliteral">'\0'</span>) {
00322             <span class="keywordflow">break</span>; <span class="comment">// end of string reached</span>
00323         }
00324 
00325         <span class="comment">/*</span>
00326 <span class="comment">         * skip C-style comments</span>
00327 <span class="comment">         */</span>
00328         <span class="keywordflow">if</span> (<a class="code" href="class_dbj_compiler.html#r3">currentPos</a>[0] == <span class="charliteral">'/'</span> &amp;&amp; <a class="code" href="class_dbj_compiler.html#r3">currentPos</a>[1] == <span class="charliteral">'*'</span>) {
00329             currentPos += 2;
00330             <span class="keywordflow">while</span> (*currentPos != <span class="charliteral">'\0'</span> &amp;&amp; currentPos[0] != <span class="charliteral">'*'</span> &amp;&amp;
00331                     currentPos[1] != <span class="charliteral">'/'</span>) {
00332                 currentPos++;
00333             }
00334             <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">'\0'</span>) {
00335                 <span class="keywordflow">break</span>; <span class="comment">// end of string reached</span>
00336             }
00337             currentPos += 2;
00338             <span class="keywordflow">while</span> (isspace(*currentPos)) {
00339                 currentPos++;
00340             }
00341             <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">'\0'</span>) {
00342                 <span class="keywordflow">break</span>; <span class="comment">// end of string reached</span>
00343             }
00344         }
00345 
00346         <span class="comment">/*</span>
00347 <span class="comment">         * Now we use a huge switch statement to figure out what we're</span>
00348 <span class="comment">         * reading.  We will check for all keywords.  If we can't find</span>
00349 <span class="comment">         * anything, we have a parse error.</span>
00350 <span class="comment">         */</span>
00351 
00352         <span class="comment">// CREATE TABLE</span>
00353         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"CREATE"</span>, <a class="code" href="_dbj_parser_8cpp.html#a4">T_CREATE</a>);
00354         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"TABLE"</span>, <a class="code" href="_dbj_parser_8cpp.html#a5">T_TABLE</a>);
00355         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"INTEGER"</span>, <a class="code" href="_dbj_parser_8cpp.html#a6">T_INTEGER_TYPE</a>);
00356         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"INT"</span>, <a class="code" href="_dbj_parser_8cpp.html#a6">T_INTEGER_TYPE</a>);
00357         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"VARCHAR"</span>, <a class="code" href="_dbj_parser_8cpp.html#a7">T_VARCHAR_TYPE</a>);
00358         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"NOT"</span>, <a class="code" href="_dbj_parser_8cpp.html#a8">T_NOT</a>);
00359         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"NULL"</span>, <a class="code" href="_dbj_parser_8cpp.html#a9">T_NULL</a>);
00360         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"PRIMARY"</span>, <a class="code" href="_dbj_parser_8cpp.html#a10">T_PRIMARY</a>);
00361         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"KEY"</span>, <a class="code" href="_dbj_parser_8cpp.html#a11">T_KEY</a>);
00362 
00363         <span class="comment">// DROP TABLE</span>
00364         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"DROP"</span>, <a class="code" href="_dbj_parser_8cpp.html#a12">T_DROP</a>);
00365  
00366         <span class="comment">// CREATE INDEX</span>
00367         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"INDEX"</span>, <a class="code" href="_dbj_parser_8cpp.html#a13">T_INDEX</a>);
00368         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"UNIQUE"</span>, <a class="code" href="_dbj_parser_8cpp.html#a14">T_UNIQUE</a>);
00369         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"ON"</span>, <a class="code" href="_dbj_parser_8cpp.html#a15">T_ON</a>);
00370         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"OF"</span>, <a class="code" href="_dbj_parser_8cpp.html#a16">T_OF</a>);
00371         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"TYPE"</span>, <a class="code" href="_dbj_parser_8cpp.html#a17">T_TYPE</a>);
00372         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"BTREE"</span>, <a class="code" href="_dbj_parser_8cpp.html#a18">T_BTREE</a>);
00373         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"HASH"</span>, <a class="code" href="_dbj_parser_8cpp.html#a19">T_HASH</a>);
00374 
00375         <span class="comment">// DROP INDEX</span>
00376 
00377         <span class="comment">// INSERT</span>
00378         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"INSERT"</span>, <a class="code" href="_dbj_parser_8cpp.html#a20">T_INSERT</a>);
00379         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"INTO"</span>, <a class="code" href="_dbj_parser_8cpp.html#a21">T_INTO</a>);
00380         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"VALUES"</span>, <a class="code" href="_dbj_parser_8cpp.html#a22">T_VALUES</a>);
00381 
00382         <span class="comment">// UPDATE</span>
00383         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"UPDATE"</span>, <a class="code" href="_dbj_parser_8cpp.html#a23">T_UPDATE</a>);
00384         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"SET"</span>, <a class="code" href="_dbj_parser_8cpp.html#a24">T_SET</a>);
00385 
00386         <span class="comment">// DELETE</span>
00387         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"DELETE"</span>, <a class="code" href="_dbj_parser_8cpp.html#a25">T_DELETE</a>);
00388         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"FROM"</span>, <a class="code" href="_dbj_parser_8cpp.html#a26">T_FROM</a>);
00389         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"AS"</span>, <a class="code" href="_dbj_parser_8cpp.html#a27">T_AS</a>);
00390 
00391         <span class="comment">// SELECT</span>
00392         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"SELECT"</span>, <a class="code" href="_dbj_parser_8cpp.html#a28">T_SELECT</a>);
00393 
00394         <span class="comment">// where clause</span>
00395         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"WHERE"</span>, <a class="code" href="_dbj_parser_8cpp.html#a30">T_WHERE</a>);
00396         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"AND"</span>, <a class="code" href="_dbj_parser_8cpp.html#a31">T_AND</a>);
00397         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"OR"</span>, <a class="code" href="_dbj_parser_8cpp.html#a32">T_OR</a>);
00398         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"IS"</span>, <a class="code" href="_dbj_parser_8cpp.html#a39">T_IS</a>);
00399         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"LIKE"</span>, <a class="code" href="_dbj_parser_8cpp.html#a40">T_LIKE</a>);
00400         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"REGEX"</span>, <a class="code" href="_dbj_parser_8cpp.html#a41">T_REGEX</a>);
00401         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"REGEXP"</span>, <a class="code" href="_dbj_parser_8cpp.html#a41">T_REGEX</a>);
00402         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"BETWEEN"</span>, <a class="code" href="_dbj_parser_8cpp.html#a42">T_BETWEEN</a>);
00403 
00404         <span class="comment">// COMMIT</span>
00405         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"COMMIT"</span>, <a class="code" href="_dbj_parser_8cpp.html#a43">T_COMMIT</a>);
00406         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"WORK"</span>, <a class="code" href="_dbj_parser_8cpp.html#a44">T_WORK</a>);
00407 
00408         <span class="comment">// ROLLBACK</span>
00409         <a class="code" href="_dbj_compiler_8cpp.html#a0">MATCH_TOKEN</a>(<span class="stringliteral">"ROLLBACK"</span>, <a class="code" href="_dbj_parser_8cpp.html#a45">T_ROLLBACK</a>);
00410 
00411         <span class="comment">// some general stuff appearing all over the place</span>
00412         <span class="comment">// (special characters cannot be handled by MATCH_TOKEN because there,</span>
00413         <span class="comment">//  we check that no alpha-numeric character follow the token - but</span>
00414         <span class="comment">//  that can very well be the case after a '(' ...)</span>
00415         <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">'.'</span>) {
00416             currentPos++;
00417             <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a49">T_PERIOD</a>;
00418         }
00419         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">','</span>) {
00420             currentPos++;
00421             <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a50">T_COMMA</a>;
00422         }
00423         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">'*'</span>) {
00424             currentPos++;
00425             <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a29">T_STAR</a>;
00426         }
00427         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">'('</span>) {
00428             currentPos++;
00429             <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a51">T_LEFT_PAREN</a>;
00430         }
00431         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">')'</span>) {
00432             currentPos++;
00433             <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a52">T_RIGHT_PAREN</a>;
00434         }
00435         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">'='</span>) {
00436             currentPos++;
00437             <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a33">T_SIGN_EQUAL</a>;
00438         }
00439         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">'&lt;'</span>) {
00440             currentPos++;
00441             <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">'='</span>) {
00442                 currentPos++;
00443                 <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a35">T_SIGN_SMALLER_EQUAL</a>;
00444             }
00445             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">'&gt;'</span>) {
00446                 currentPos++;
00447                 <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a38">T_SIGN_NOTEQUAL</a>;
00448             }
00449             <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a34">T_SIGN_SMALLER</a>;
00450         }
00451         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">'&gt;'</span>) {
00452             currentPos++;
00453             <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">'='</span>) {
00454                 currentPos++;
00455                 <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a37">T_SIGN_LARGER_EQUAL</a>;
00456             }
00457             <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a36">T_SIGN_LARGER</a>;
00458         }
00459 
00460         <span class="comment">// check if we have a non-quoted/quoted string</span>
00461         <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">'\''</span> || *currentPos == <span class="charliteral">'"'</span>) {
00462             <span class="keywordtype">char</span> <span class="keyword">const</span> delimiter = *currentPos;
00463             <span class="keywordtype">bool</span> doLoop = <span class="keyword">true</span>;
00464 
00465             <span class="comment">// set beginning of string</span>
00466             currentPos++;
00467             tokenValue-&gt;stringValue.data = currentPos;
00468 
00469             <span class="comment">// search end of string - skip escaped characters</span>
00470             <span class="keywordflow">while</span> (doLoop) {
00471                 <span class="keywordflow">while</span> (*currentPos != <span class="charliteral">'\0'</span> &amp;&amp; *currentPos != delimiter) {
00472                     currentPos++;
00473                 }
00474                 <span class="keywordflow">if</span> (*currentPos == <span class="charliteral">'\0'</span>) {
00475                     <span class="comment">// inside an unterminated string</span>
00476                     <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a9">DBJ_COMPILER_UNTERMINATED_STRING</a>,
00477                             tokenValue-&gt;stringValue.data);
00478                     <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a53">T_UNKNOWN</a>;
00479                 }
00480                 <span class="keywordflow">if</span> (currentPos[1] == delimiter) {
00481                     <span class="comment">// next character is also a delimiter? - skip both</span>
00482                     currentPos += 2;
00483                     tokenValue-&gt;stringValue.delimiter = delimiter;
00484                 }
00485                 <span class="keywordflow">else</span> {
00486                     currentPos++;
00487                     doLoop = <span class="keyword">false</span>;
00488                     <span class="keywordflow">break</span>;
00489                 }
00490             }
00491             tokenValue-&gt;stringValue.length =
00492                 currentPos - tokenValue-&gt;stringValue.data - 1;
00493             <a class="code" href="group__trace__def.html#ga3">DBJ_TRACE_DATA1</a>(20,
00494                     tokenValue-&gt;stringValue.length,
00495                     tokenValue-&gt;stringValue.data);
00496             <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a47">T_STRING</a>;
00497         }
00498         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isalpha(*currentPos) || *currentPos == <span class="charliteral">'_'</span>) {
00499             <span class="comment">// set beginning of string</span>
00500             tokenValue-&gt;stringValue.data = currentPos;
00501 
00502             <span class="comment">// search end of string (first non-alphanumeric character)</span>
00503             <span class="keywordflow">while</span> (isalnum(*currentPos) || *currentPos == <span class="charliteral">'_'</span>) {
00504                 currentPos++;
00505             }
00506             tokenValue-&gt;stringValue.length =
00507                 currentPos - tokenValue-&gt;stringValue.data;
00508             <a class="code" href="group__trace__def.html#ga3">DBJ_TRACE_DATA1</a>(10,
00509                     tokenValue-&gt;stringValue.length,
00510                     tokenValue-&gt;stringValue.data);
00511             <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a46">T_IDENTIFIER</a>;
00512         }
00513         <span class="keywordflow">else</span> {
00514             <span class="comment">// and finally, we might have an integer number</span>
00515             <span class="keywordtype">char</span> *endPtr = NULL;
00516             <span class="keywordtype">long</span> value = strtol(currentPos, &amp;endPtr, 10);
00517             <span class="keywordflow">if</span> (currentPos != endPtr) {
00518                 <span class="keywordflow">if</span> (value == LONG_MIN || value == LONG_MAX) {
00519                     <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a10">DBJ_COMPILER_INVALID_NUMBER</a>,
00520                             currentPos);
00521                     currentPos++;
00522                     <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a53">T_UNKNOWN</a>;
00523                 }
00524                 <span class="comment">// we got something - return that</span>
00525                 <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(30, <span class="stringliteral">"Integer Wert"</span>, value);
00526 
00527                 currentPos = endPtr;
00528                 tokenValue-&gt;integerValue = value;
00529                 <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a48">T_NUMBER</a>;
00530             }
00531         }
00532 
00533         <span class="comment">// nothing matched so far... that can only mean that we have a</span>
00534         <span class="comment">// syntax error</span>
00535         <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a11">DBJ_COMPILER_UNKNOWN_TOKEN</a>, currentPos);
00536         currentPos++;
00537         <span class="keywordflow">return</span> <a class="code" href="_dbj_parser_8cpp.html#a53">T_UNKNOWN</a>;
00538     }
00539 
00540     <span class="keywordflow">return</span> 0; <span class="comment">// end of parsing</span>
00541 } <span class="comment">// yylex()</span>
00542 
00543 <span class="comment">// we don't need that anymore</span>
00544 <span class="preprocessor">#undef MATCH_TOKEN</span>
00545 <span class="preprocessor"></span>
00546 
00547 <span class="comment">// Teste auf Symbol in gegebenen String</span>
<a name="l00548"></a><a class="code" href="class_dbj_compiler.html#d5">00548</a> <span class="keywordtype">bool</span> <a class="code" href="class_dbj_compiler.html#d5">DbjCompiler::checkSymbolMatch</a>(<span class="keywordtype">char</span> <span class="keyword">const</span> *str, <span class="keywordtype">char</span> <span class="keyword">const</span> *symbol)
00549 {
00550     <span class="keywordflow">if</span> (!str || !symbol) {
00551         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00552         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00553     }
00554 
00555     <span class="comment">// do a case-insenstive comparison of symbol and string</span>
00556     size_t strLength = strlen(str);
00557     size_t symbolLength = strlen(symbol);
00558     <span class="keywordflow">if</span> (strLength &lt; symbolLength) {
00559         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00560     }
00561     <span class="keywordflow">for</span> (size_t i = 0; i &lt; symbolLength; i++) {
00562         <span class="comment">// compare strings using upper case characters</span>
00563         <span class="keywordflow">if</span> (toupper(str[i]) != toupper(symbol[i])) {
00564             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00565         }
00566     }
00567 
00568     <span class="comment">// string &amp; symbol identical - check length</span>
00569     <span class="comment">// (string ends directly behind symbol)</span>
00570     <span class="keywordflow">if</span> (strLength == symbolLength) {
00571         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00572     }
00573 
00574     <span class="comment">// string is longer than symbol - check character behind symbol</span>
00575     <span class="comment">// (if no other character, it's a matches)</span>
00576     <span class="keywordflow">if</span> (!isalnum(str[symbolLength]) &amp;&amp; str[symbolLength] != <span class="charliteral">'_'</span>) {
00577         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00578     }
00579 
00580     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00581 }
00582 
00583 
00584 <span class="comment">// Fehler waehrend des Parsens</span>
<a name="l00585"></a><a class="code" href="class_dbj_compiler.html#d6">00585</a> <span class="keywordtype">void</span> <a class="code" href="class_dbj_compiler.html#d6">DbjCompiler::yyerror</a>(<span class="keywordtype">char</span> <span class="keyword">const</span> *errorText)
00586 {
00587     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00588 
00589     <a class="code" href="group__trace__def.html#ga7">DBJ_TRACE_STRING</a>(1, errorText ? errorText : <span class="stringliteral">"&lt;NULL&gt;"</span>);
00590 
00591     <span class="comment">// we alread have an error message set</span>
00592     <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00593         <span class="keywordflow">return</span>;
00594     }
00595 
00596     <span class="comment">// special error message for incomplete statements</span>
00597     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_compiler.html#r3">currentPos</a> == <a class="code" href="class_dbj_compiler.html#r2">stmtStringEnd</a>) {
00598         <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a12">DBJ_COMPILER_PARSE_EARLY_END</a>, <a class="code" href="class_dbj_compiler.html#r1">stmtString</a>);
00599     }
00600     <span class="keywordflow">else</span> {
00601         <span class="keywordtype">char</span> <span class="keyword">const</span> *lastToken = <a class="code" href="class_dbj_compiler.html#r3">currentPos</a>;
00602 
00603         <span class="comment">// find the beginning of the last token that was processed by yylex()</span>
00604         <span class="keywordflow">while</span> (lastToken &gt; <a class="code" href="class_dbj_compiler.html#r1">stmtString</a> &amp;&amp; isspace(*lastToken)) {
00605             lastToken--;
00606         }
00607         <span class="keywordflow">while</span> (lastToken &gt;= <a class="code" href="class_dbj_compiler.html#r1">stmtString</a> &amp;&amp; !isspace(*lastToken)) {
00608             lastToken--;
00609         }
00610         lastToken++;
00611         <a class="code" href="_dbj_error_8hpp.html#a5">DBJ_SET_ERROR_TOKEN4</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a13">DBJ_COMPILER_PARSE_ERROR_TOKEN</a>, errorText,
00612                 <a class="code" href="class_dbj_compiler.html#r1">stmtString</a>, lastToken, currentPos);
00613     }
00614 }
00615 
00616 
00617 <span class="comment">// Validiere Plan fuer "CREATE TABLE"</span>
<a name="l00618"></a><a class="code" href="class_dbj_compiler.html#d7">00618</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d7">DbjCompiler::validateCreateTable</a>()
00619 {
00620     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00621     <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *table = NULL;
00622 
00623     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00624 
00625     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_compiler.html#r0">plan</a> || <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::CreateTableStmt) {
00626         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00627         <span class="keywordflow">goto</span> cleanup;
00628     }
00629 
00630     <span class="comment">// pruefe ob Tabelle noch nicht existiert</span>
00631     table = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00632     {
00633         <a class="code" href="group__tableid.html#ga1">TableId</a> tableId = DBJ_UNKNOWN_TABLE_ID;
00634 
00635         <span class="keywordflow">if</span> (!table || table-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table ||
00636                 table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
00637             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00638             <span class="keywordflow">goto</span> cleanup;
00639         }
00640         rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a1">getTableId</a>(table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), tableId);
00641         <span class="keywordflow">if</span> (rc == <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00642             <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a14">DBJ_COMPILER_TABLE_ALREADY_EXISTS</a>,
00643                     table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
00644             <span class="keywordflow">goto</span> cleanup;
00645         }
00646         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a4">DBJ_NOT_FOUND_WARN</a>) {
00647             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00648             <span class="keywordflow">goto</span> cleanup;
00649         }
00650         <span class="keywordflow">else</span> {
00651             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>); <span class="comment">// Fehler vom Catalog Mgr zuruecksetzen</span>
00652         }
00653     }
00654 
00655     <span class="comment">// pruefe ob alle Spaltennamen eindeutig sind; wir verwenden hier einen</span>
00656     <span class="comment">// simplen nested loop</span>
00657     {
00658         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *column1 = table-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00659         <span class="keywordflow">if</span> (column1 == NULL) {
00660             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00661             <span class="keywordflow">goto</span> cleanup;
00662         }
00663 
00664         <span class="comment">// alle Spalten brauchen einen Namen und Datentypen!</span>
00665         <span class="keywordflow">while</span> (column1 != NULL) {
00666             <span class="keywordflow">if</span> (column1-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL ||
00667                     column1-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Column ||
00668                     column1-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>() == NULL ||
00669                     column1-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() !=
00670                     DbjAccessPlan::DataType) {
00671                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00672                 <span class="keywordflow">goto</span> cleanup;
00673             }
00674             column1 = column1-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00675         }
00676 
00677         column1 = table-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00678         <span class="keywordflow">while</span> (column1 != NULL) {
00679             <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *column2 = column1-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00680             <span class="keywordflow">while</span> (column2 != NULL) {
00681                 <span class="keywordtype">char</span> <span class="keyword">const</span> *name1 = column1-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>();
00682                 <span class="keywordtype">char</span> <span class="keyword">const</span> *name2 = column2-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>();
00683 
00684                 <span class="comment">// teste colunm1 und column2</span>
00685                 <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(name1, name2) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
00686                     <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a17">DBJ_COMPILER_DUPLICATE_COLUMN_NAME</a>,
00687                             name1);
00688                     <span class="keywordflow">goto</span> cleanup;
00689                 }
00690                 column2 = column2-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00691             }
00692             column1 = column1-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00693         }
00694     }
00695 
00696     <span class="comment">// pruefe ob Primaerschluessel auf existierender und NOT NULL-Spalte</span>
00697     <span class="comment">// gelegt wurde</span>
00698     <span class="keywordflow">if</span> (table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()) {
00699         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *column = table-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00700         <span class="keywordtype">bool</span> foundPrimaryKey = <span class="keyword">false</span>;
00701         <span class="keywordtype">char</span> <span class="keyword">const</span> *primaryKeyColumn = table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>();
00702 
00703         <span class="keywordflow">if</span> (!primaryKeyColumn) {
00704             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00705             <span class="keywordflow">goto</span> cleanup;
00706         }
00707 
00708         <span class="keywordflow">while</span> (column != NULL) {
00709             <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(primaryKeyColumn,
00710                         column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>()) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
00711                 foundPrimaryKey = <span class="keyword">true</span>;
00712 
00713                 <span class="comment">// NotNull</span>
00714                 <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *notNull = column-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00715                 <span class="keywordflow">if</span> (notNull == NULL) {
00716                     notNull = <a class="code" href="class_dbj_compiler.html#d0">createNode</a>(DbjAccessPlan::NotNullOption);
00717                     <span class="keywordflow">if</span> (!notNull) {
00718                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00719                         <span class="keywordflow">goto</span> cleanup;
00720                     }
00721                     column-&gt;<a class="code" href="class_dbj_access_plan.html#d3">addSon</a>(notNull);
00722                 }
00723                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (notNull-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::NotNullOption) {
00724                     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00725                     <span class="keywordflow">goto</span> cleanup;
00726                 }
00727                 <span class="keywordflow">break</span>;
00728             }
00729             column = column-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00730         }
00731 
00732         <span class="keywordflow">if</span> (!foundPrimaryKey) {
00733             <a class="code" href="_dbj_error_8hpp.html#a3">DBJ_SET_ERROR_TOKEN2</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a18">DBJ_COMPILER_KEY_COLUMN_NOT_FOUND</a>,
00734                     primaryKeyColumn, table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
00735             <span class="keywordflow">goto</span> cleanup;
00736         }
00737     }
00738 
00739  cleanup:
00740     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00741 }
00742 
00743 
00744 <span class="comment">// Validiere Plan fuer "DROP TABLE"</span>
<a name="l00745"></a><a class="code" href="class_dbj_compiler.html#d8">00745</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d8">DbjCompiler::validateDropTable</a>()
00746 {
00747     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00748     <a class="code" href="class_dbj_access_plan_table.html">DbjAccessPlanTable</a> *table = NULL;
00749 
00750     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00751 
00752     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_compiler.html#r0">plan</a> || <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::DropTableStmt ||
00753             !<a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>() ||
00754             <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table) {
00755         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00756         <span class="keywordflow">goto</span> cleanup;
00757     }
00758 
00759     <span class="comment">// pruefe ob Tabelle existiert</span>
00760     table = static_cast&lt;DbjAccessPlanTable *&gt;(<a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>());
00761     {
00762         <a class="code" href="group__tableid.html#ga1">TableId</a> tableId = DBJ_UNKNOWN_TABLE_ID;
00763         <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
00764 
00765         <span class="keywordflow">if</span> (!table || table-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table ||
00766                 table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
00767             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00768             <span class="keywordflow">goto</span> cleanup;
00769         }
00770         rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a1">getTableId</a>(table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), tableId);
00771         <span class="keywordflow">if</span> (rc == <a class="code" href="_dbj_error_codes_8hpp.html#a107a4">DBJ_NOT_FOUND_WARN</a>) {
00772             <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a15">DBJ_COMPILER_TABLE_NOT_EXISTS</a>,
00773                     table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
00774             <span class="keywordflow">goto</span> cleanup;
00775         }
00776         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00777             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00778             <span class="keywordflow">goto</span> cleanup;
00779         }
00780 
00781         <span class="comment">// speichere Table-ID in Plan</span>
00782         table-&gt;setIntData(tableId);
00783 
00784         <span class="comment">// speicher Tabellen-Deskriptor im Plan</span>
00785         rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a2">getTableDescriptor</a>(tableId, tableDesc);
00786         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00787             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00788             <span class="keywordflow">goto</span> cleanup;
00789         }
00790         rc = table-&gt;<a class="code" href="class_dbj_access_plan_table.html#d0">setTableDescriptor</a>(tableDesc);
00791         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00792             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00793             <span class="keyword">delete</span> tableDesc;
00794             <span class="keywordflow">goto</span> cleanup;
00795         }
00796     }
00797 
00798  cleanup:
00799     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00800 }
00801 
00802 
00803 <span class="comment">// Validiere Plan fuer "CREATE INDEX"</span>
<a name="l00804"></a><a class="code" href="class_dbj_compiler.html#d9">00804</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d9">DbjCompiler::validateCreateIndex</a>()
00805 {
00806     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00807     <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *index = NULL;
00808     <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *table = NULL;
00809     <a class="code" href="group__tableid.html#ga1">TableId</a> tableId = DBJ_UNKNOWN_TABLE_ID;
00810 
00811     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00812 
00813     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_compiler.html#r0">plan</a> || <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::CreateIndexStmt) {
00814         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00815         <span class="keywordflow">goto</span> cleanup;
00816     }
00817 
00818     <span class="comment">// pruefe, dass Index noch nicht existiert</span>
00819     index = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00820     {
00821         <a class="code" href="group__tableid.html#ga5">IndexId</a> indexId = DBJ_UNKNOWN_INDEX_ID;
00822 
00823         <span class="keywordflow">if</span> (!index ||
00824                 (index-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Index &amp;&amp;
00825                         index-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::UniqueIndex) ||
00826                 index-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
00827             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00828             <span class="keywordflow">goto</span> cleanup;
00829         }
00830         rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a3">getIndexId</a>(index-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), indexId);
00831         <span class="keywordflow">if</span> (rc == <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00832             <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a19">DBJ_COMPILER_INDEX_ALREADY_EXISTS</a>,
00833                     index-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
00834             <span class="keywordflow">goto</span> cleanup;
00835         }
00836         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a4">DBJ_NOT_FOUND_WARN</a>) {
00837             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00838             <span class="keywordflow">goto</span> cleanup;
00839         }
00840         <span class="keywordflow">else</span> {
00841             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>); <span class="comment">// Fehler vom Catalog Mgr zuruecksetzen</span>
00842         }
00843     }
00844 
00845     <span class="comment">// pruefe ob Tabelle bereits existiert</span>
00846     table = index-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00847     {
00848         <span class="keywordflow">if</span> (!table || table-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table ||
00849                 table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
00850             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00851             <span class="keywordflow">goto</span> cleanup;
00852         }
00853 
00854         rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a1">getTableId</a>(table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), tableId);
00855         <span class="keywordflow">if</span> (rc == <a class="code" href="_dbj_error_codes_8hpp.html#a107a4">DBJ_NOT_FOUND_WARN</a>) {
00856             <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a15">DBJ_COMPILER_TABLE_NOT_EXISTS</a>,
00857                     table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
00858             <span class="keywordflow">goto</span> cleanup;
00859         }
00860         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00861             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00862             <span class="keywordflow">goto</span> cleanup;
00863         }
00864 
00865         <span class="comment">// speichere Table-ID in Plan</span>
00866         rc = table-&gt;<a class="code" href="class_dbj_access_plan.html#d7">setIntData</a>(tableId);
00867         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00868             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00869             <span class="keywordflow">goto</span> cleanup;
00870         }
00871     }
00872 
00873     <span class="comment">// pruefe ob Spalte existiert</span>
00874     {
00875         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *column = table-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00876         <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
00877         <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnId = 0;
00878 
00879         <span class="keywordflow">if</span> (!column || column-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Column ||
00880                 column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
00881             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00882             <span class="keywordflow">goto</span> cleanup;
00883         }
00884 
00885         <span class="comment">// hole den Table-Deskriptor, ueber welchen wir die</span>
00886         <span class="comment">// Spalteninformationen bekommen</span>
00887         rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a2">getTableDescriptor</a>(tableId, tableDesc);
00888         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00889             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00890             <span class="keywordflow">goto</span> cleanup;
00891         }
00892         rc = static_cast&lt;DbjAccessPlanTable *&gt;(table)-&gt;
00893             setTableDescriptor(tableDesc);
00894         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00895             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00896             <span class="keyword">delete</span> tableDesc;
00897             <span class="keywordflow">goto</span> cleanup;
00898         }
00899         rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a9">getColumnNumber</a>(column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), columnId);
00900         <span class="keywordflow">if</span> (rc == <a class="code" href="_dbj_error_codes_8hpp.html#a107a4">DBJ_NOT_FOUND_WARN</a>) {
00901             <a class="code" href="_dbj_error_8hpp.html#a3">DBJ_SET_ERROR_TOKEN2</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a22">DBJ_COMPILER_COLUMN_NOT_FOUND</a>,
00902                     column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
00903             <span class="keywordflow">goto</span> cleanup;
00904         }
00905         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00906             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00907             <span class="keywordflow">goto</span> cleanup;
00908         }
00909 
00910         <span class="comment">// speichere column-ID in Plan</span>
00911         rc = column-&gt;<a class="code" href="class_dbj_access_plan.html#d7">setIntData</a>(columnId);
00912         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00913             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00914             <span class="keywordflow">goto</span> cleanup;
00915         }
00916     }
00917 
00918     <span class="comment">// ueberpruefe, ob der Index-Typ angehaengt wurde - wenn nicht, haenge ihn</span>
00919     <span class="comment">// dran</span>
00920     {
00921         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *indexType = table-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00922 
00923         <span class="keywordflow">if</span> (!indexType) {
00924             indexType = <a class="code" href="class_dbj_compiler.html#d0">createNode</a>(DbjAccessPlan::IndexType, <span class="stringliteral">"BTREE"</span>);
00925             <span class="keywordflow">if</span> (!indexType) {
00926                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00927                 <span class="keywordflow">goto</span> cleanup;
00928             }
00929             index-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#d3">addSon</a>(indexType);
00930         }
00931         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (indexType-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL ||
00932                 indexType-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::IndexType) {
00933             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00934             <span class="keywordflow">goto</span> cleanup;
00935         }
00936     }
00937 
00938  cleanup:
00939     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00940 }
00941 
00942 
00943 <span class="comment">// Validiere Plan fuer "DROP INDEX"</span>
<a name="l00944"></a><a class="code" href="class_dbj_compiler.html#d10">00944</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d10">DbjCompiler::validateDropIndex</a>()
00945 {
00946     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00947     <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *index = NULL;
00948 
00949     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00950 
00951     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_compiler.html#r0">plan</a> || <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::DropIndexStmt) {
00952         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00953         <span class="keywordflow">goto</span> cleanup;
00954     }
00955 
00956     <span class="comment">// pruefe ob Index existiert</span>
00957     index = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00958     {
00959         <a class="code" href="group__tableid.html#ga5">IndexId</a> indexId = DBJ_UNKNOWN_INDEX_ID;
00960 
00961         <span class="keywordflow">if</span> (!index || index-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
00962             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00963             <span class="keywordflow">goto</span> cleanup;
00964         }
00965         rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a3">getIndexId</a>(index-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), indexId);
00966         <span class="keywordflow">if</span> (rc == <a class="code" href="_dbj_error_codes_8hpp.html#a107a4">DBJ_NOT_FOUND_WARN</a>) {
00967             <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a20">DBJ_COMPILER_INDEX_NOT_EXISTS</a>,
00968                     index-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
00969             <span class="keywordflow">goto</span> cleanup;
00970         }
00971         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00972             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00973             <span class="keywordflow">goto</span> cleanup;
00974         }
00975 
00976         <span class="comment">// speichere Index-ID in Plan</span>
00977         index-&gt;<a class="code" href="class_dbj_access_plan.html#d7">setIntData</a>(indexId);
00978     }
00979 
00980  cleanup:
00981     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00982 }
00983 
00984 <span class="comment">// Validiere Zugriffsplan fuer "INSERT"</span>
<a name="l00985"></a><a class="code" href="class_dbj_compiler.html#d11">00985</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d11">DbjCompiler::validateInsert</a>()
00986 {
00987     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00988     <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
00989     <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *table = NULL;
00990     <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *row = NULL;
00991     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> numColumns = 0;
00992     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> rowNumber = 1;
00993 
00994     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00995 
00996     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_compiler.html#r0">plan</a> || <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::InsertStmt) {
00997         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00998         <span class="keywordflow">goto</span> cleanup;
00999     }
01000 
01001     <span class="comment">// pruefe ob Tabelle existiert</span>
01002     table = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01003     <span class="keywordflow">if</span> (!table || table-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Sources ||
01004             !table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>() ||
01005             table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table ||
01006             table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
01007         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01008         <span class="keywordflow">goto</span> cleanup;
01009     }
01010     table = table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01011     {
01012         <a class="code" href="group__tableid.html#ga1">TableId</a> tableId = DBJ_UNKNOWN_TABLE_ID;
01013 
01014         <span class="comment">// bestimme Tabellen-ID</span>
01015         rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a1">getTableId</a>(table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), tableId);
01016         <span class="keywordflow">if</span> (rc == <a class="code" href="_dbj_error_codes_8hpp.html#a107a4">DBJ_NOT_FOUND_WARN</a>) {
01017             <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a15">DBJ_COMPILER_TABLE_NOT_EXISTS</a>,
01018                     table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01019             <span class="keywordflow">goto</span> cleanup;
01020         }
01021         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01022             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01023             <span class="keywordflow">goto</span> cleanup;
01024         }
01025         <span class="comment">// speichere Tabellen-ID in Plan</span>
01026         table-&gt;<a class="code" href="class_dbj_access_plan.html#d7">setIntData</a>(tableId);
01027 
01028         <span class="comment">// hole den Table-Deskriptor, ueber welchen wir die</span>
01029         <span class="comment">// Spalteninformationen bekommen</span>
01030         rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a2">getTableDescriptor</a>(tableId, tableDesc);
01031         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01032             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01033             <span class="keywordflow">goto</span> cleanup;
01034         }
01035         rc = static_cast&lt;DbjAccessPlanTable *&gt;(table)-&gt;
01036             setTableDescriptor(tableDesc);
01037         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01038             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01039             <span class="keyword">delete</span> tableDesc;
01040             <span class="keywordflow">goto</span> cleanup;
01041         }
01042     }
01043 
01044     <span class="comment">// traversiere alle Zeilen und ueberpruefe jeweils die Anzahl der Werte</span>
01045     <span class="comment">// und deren Datentypen</span>
01046     rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a5">getNumColumns</a>(numColumns);
01047     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01048         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01049         <span class="keywordflow">goto</span> cleanup;
01050     }
01051     row = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01052     <span class="keywordflow">if</span> (!row) {
01053         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01054         <span class="keywordflow">goto</span> cleanup;
01055     }
01056     <span class="keywordflow">while</span> (row != NULL) {
01057         <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> currentColumn = 0;
01058         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *value = row-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01059 
01060         <span class="keywordflow">while</span> (value != NULL) {
01061             <span class="keywordtype">bool</span> nullable = <span class="keyword">false</span>;
01062             <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> dataType = <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>;
01063 
01064             <span class="comment">// pruefe, ob NULL-Wert in NOT NULL Spalte eingefuegt werden soll</span>
01065             <span class="keywordflow">if</span> (value-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() == DbjAccessPlan::NullValue) {
01066                 rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a12">getIsNullable</a>(currentColumn, nullable);
01067                 <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01068                     <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01069                     <span class="keywordflow">goto</span> cleanup;
01070                 }
01071                 <span class="keywordflow">if</span> (!nullable) {
01072                     <span class="keyword">const</span> <span class="keywordtype">char</span> *columnName = NULL;
01073                     rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a8">getColumnName</a>(currentColumn, columnName);
01074                     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01075                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01076                         <span class="keywordflow">goto</span> cleanup;
01077                     }
01078                     <a class="code" href="_dbj_error_8hpp.html#a3">DBJ_SET_ERROR_TOKEN2</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a24">DBJ_COMPILER_COLUMN_NOT_NULLABLE</a>,
01079                             columnName, table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01080                     <span class="keywordflow">goto</span> cleanup;
01081                 }
01082             }
01083 
01084             <span class="comment">// pruefe Datentyp</span>
01085             rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(currentColumn,  dataType);
01086             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01087                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01088                 <span class="keywordflow">goto</span> cleanup;
01089             }
01090 
01091             <span class="keywordflow">switch</span> (dataType) {
01092               <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>:
01093                   <span class="keywordflow">if</span> (value-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::VarcharValue &amp;&amp;
01094                           value-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::NullValue) {
01095                       <span class="keyword">const</span> <span class="keywordtype">char</span> *columnName = NULL;
01096                       rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a8">getColumnName</a>(currentColumn, columnName);
01097                       <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01098                           <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01099                           <span class="keywordflow">goto</span> cleanup;
01100                       }
01101                       <a class="code" href="_dbj_error_8hpp.html#a6">DBJ_SET_ERROR_TOKEN5</a>(
01102                               <a class="code" href="_dbj_error_codes_8hpp.html#a107a26">DBJ_COMPILER_INSERT_VALUE_TYPE_MISMATCH</a>,
01103                               columnName, rowNumber,
01104                               table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"VARCHAR"</span>, <span class="stringliteral">"INTEGER"</span>);
01105                       <span class="keywordflow">goto</span> cleanup;
01106                   }
01107                   <span class="keywordflow">break</span>;
01108               <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>:
01109                   <span class="keywordflow">if</span> (value-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::IntegerValue &amp;&amp;
01110                           value-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::NullValue) {
01111                       <span class="keyword">const</span> <span class="keywordtype">char</span> *columnName = NULL;
01112                       rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a8">getColumnName</a>(currentColumn, columnName);
01113                       <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01114                           <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01115                           <span class="keywordflow">goto</span> cleanup;
01116                       }
01117                       <a class="code" href="_dbj_error_8hpp.html#a6">DBJ_SET_ERROR_TOKEN5</a>(
01118                               <a class="code" href="_dbj_error_codes_8hpp.html#a107a26">DBJ_COMPILER_INSERT_VALUE_TYPE_MISMATCH</a>,
01119                               columnName, rowNumber,
01120                               table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"INTEGER"</span>, <span class="stringliteral">"VARCHAR"</span>);
01121                       <span class="keywordflow">goto</span> cleanup;
01122                   }
01123                   <span class="keywordflow">break</span>;
01124               <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>:
01125                   <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01126                   <span class="keywordflow">goto</span> cleanup;
01127             }
01128 
01129             <span class="comment">// bearbeit naechsten Wert des aktuellen Tupels</span>
01130             value = value-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01131             currentColumn++;
01132             <span class="keywordflow">if</span> (currentColumn &gt;= numColumns) {
01133                 <span class="keywordflow">while</span> (value != NULL) {
01134                     value = value-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01135                     currentColumn++;
01136                 }
01137                 <span class="keywordflow">break</span>;
01138             }
01139         }
01140         <span class="keywordflow">if</span> (currentColumn != numColumns) {
01141             <a class="code" href="_dbj_error_8hpp.html#a5">DBJ_SET_ERROR_TOKEN4</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a25">DBJ_COMPILER_INSERT_INVALID_NUM_VALUES</a>,
01142                     rowNumber, table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), currentColumn,
01143                     numColumns);
01144             <span class="keywordflow">goto</span> cleanup;
01145         }
01146 
01147         row = row-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01148         rowNumber++;
01149     }
01150 
01151  cleanup:
01152     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01153 }
01154 
01155 
01156 <span class="comment">// Validiere Zugriffsplan fuer "UPDATE"</span>
<a name="l01157"></a><a class="code" href="class_dbj_compiler.html#d12">01157</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d12">DbjCompiler::validateUpdate</a>()
01158 {
01159     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01160     <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
01161     <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *node = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01162     <a class="code" href="class_dbj_access_plan_table.html">DbjAccessPlanTable</a> *table = NULL;
01163     <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *whereClause = NULL;
01164 
01165     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01166 
01167     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_compiler.html#r0">plan</a> || <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::UpdateStmt) {
01168         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01169         <span class="keywordflow">goto</span> cleanup;
01170     }
01171 
01172     <span class="comment">// pruefe ob Tabelle existiert</span>
01173     node = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01174     <span class="keywordflow">if</span> (!node || node-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Sources ||
01175             node-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>() == NULL ||
01176             node-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table ||
01177             node-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
01178         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01179         <span class="keywordflow">goto</span> cleanup;
01180     }
01181     table = static_cast&lt;DbjAccessPlanTable *&gt;(node-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>());
01182     {
01183         <a class="code" href="group__tableid.html#ga1">TableId</a> tableId = DBJ_UNKNOWN_TABLE_ID;
01184 
01185         <span class="comment">// bestimme Tabellen-ID und speichere sie im Plan</span>
01186         rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a1">getTableId</a>(table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), tableId);
01187         <span class="keywordflow">if</span> (rc == <a class="code" href="_dbj_error_codes_8hpp.html#a107a4">DBJ_NOT_FOUND_WARN</a>) {
01188             <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a15">DBJ_COMPILER_TABLE_NOT_EXISTS</a>,
01189                     table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01190             <span class="keywordflow">goto</span> cleanup;
01191         }
01192         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01193             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01194             <span class="keywordflow">goto</span> cleanup;
01195         }
01196         table-&gt;setIntData(tableId);
01197 
01198         <span class="comment">// hole Tabellen-Deskriptor</span>
01199         rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a2">getTableDescriptor</a>(tableId, tableDesc);
01200         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01201             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01202             <span class="keywordflow">goto</span> cleanup;
01203         }
01204         rc = table-&gt;<a class="code" href="class_dbj_access_plan_table.html#d0">setTableDescriptor</a>(tableDesc);
01205         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01206             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01207             <span class="keyword">delete</span> tableDesc;
01208             <span class="keywordflow">goto</span> cleanup;
01209         }
01210     }
01211 
01212     <span class="comment">// pruefe alle Zuweisungen</span>
01213     {
01214         <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *column = NULL;
01215         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *value = NULL;
01216         node = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01217         <span class="keywordflow">if</span> (node == NULL || node-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Assignment ||
01218                 node-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>() == NULL) {
01219             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01220             <span class="keywordflow">goto</span> cleanup;
01221         }
01222 
01223         value = node;
01224         <span class="keywordflow">while</span> (value-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>() != NULL) {
01225             node = value-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01226             <span class="keywordflow">if</span> (node-&gt;getNodeType() != DbjAccessPlan::Column) {
01227                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01228                 <span class="keywordflow">goto</span> cleanup;
01229             }
01230             column = static_cast&lt;DbjAccessPlanColumn *&gt;(node);
01231             value = column-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01232             <span class="keywordflow">if</span> (!value) {
01233                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01234                 <span class="keywordflow">goto</span> cleanup;
01235             }
01236 
01237             <span class="comment">// pruefe, ob Korrelationsnamen der Spalte(n) angegeben ist und</span>
01238             <span class="comment">// mit Korrelations- bzw. Tabellennamen der Tabelle uebereinstimmt</span>
01239             rc = <a class="code" href="class_dbj_compiler.html#d18">resolveColumn</a>(table, column);
01240             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01241                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01242                 <span class="keywordflow">goto</span> cleanup;
01243             }
01244             <span class="keywordflow">if</span> (value-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() == DbjAccessPlan::Column) {
01245                 rc = <a class="code" href="class_dbj_compiler.html#d18">resolveColumn</a>(table,
01246                         static_cast&lt;DbjAccessPlanColumn *&gt;(value));
01247                 <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01248                     <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01249                     <span class="keywordflow">goto</span> cleanup;
01250                 }
01251             }
01252 
01253             <span class="comment">// pruefe, ob Zuweisung zulaessig ist</span>
01254             rc = <a class="code" href="class_dbj_compiler.html#d20">validateAssignment</a>(column, value);
01255             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01256                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01257                 <span class="keywordflow">goto</span> cleanup;
01258             }
01259         }
01260     }
01261 
01262     <span class="comment">// validiere WHERE-Klausel</span>
01263     whereClause = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01264     <span class="keywordflow">if</span> (whereClause != NULL) {
01265         rc = <a class="code" href="class_dbj_compiler.html#d15">validateWhereClause</a>(static_cast&lt;DbjAccessPlanTable *&gt;(table),
01266                 whereClause);
01267         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01268             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01269             <span class="keywordflow">goto</span> cleanup;
01270         }
01271     }
01272 
01273  cleanup:
01274     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01275 }
01276 
01277 
01278 <span class="comment">// Validiere Zugriffsplan fuer "DELETE"</span>
<a name="l01279"></a><a class="code" href="class_dbj_compiler.html#d13">01279</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d13">DbjCompiler::validateDelete</a>()
01280 {
01281     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01282     <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
01283     <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *table = NULL;
01284 
01285     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01286 
01287     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_compiler.html#r0">plan</a> || <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::DeleteStmt) {
01288         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01289         <span class="keywordflow">goto</span> cleanup;
01290     }
01291 
01292     <span class="comment">// pruefe ob Tabelle existiert</span>
01293     table = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01294     <span class="keywordflow">if</span> (!table || table-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Sources ||
01295             !table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>() ||
01296             table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table ||
01297             table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
01298         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01299         <span class="keywordflow">goto</span> cleanup;
01300     }
01301     table = table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01302     {
01303         <a class="code" href="group__tableid.html#ga1">TableId</a> tableId = DBJ_UNKNOWN_TABLE_ID;
01304 
01305         <span class="comment">// bestimme Tabellen-ID und speichere sie im Plan</span>
01306         rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a1">getTableId</a>(table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), tableId);
01307         <span class="keywordflow">if</span> (rc == <a class="code" href="_dbj_error_codes_8hpp.html#a107a4">DBJ_NOT_FOUND_WARN</a>) {
01308             <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a15">DBJ_COMPILER_TABLE_NOT_EXISTS</a>,
01309                     table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01310             <span class="keywordflow">goto</span> cleanup;
01311         }
01312         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01313             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01314             <span class="keywordflow">goto</span> cleanup;
01315         }
01316         table-&gt;<a class="code" href="class_dbj_access_plan.html#d7">setIntData</a>(tableId);
01317 
01318         <span class="comment">// hole Tabellen-Deskriptor</span>
01319         rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a2">getTableDescriptor</a>(tableId, tableDesc);
01320         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01321             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01322             <span class="keywordflow">goto</span> cleanup;
01323         }
01324         rc = static_cast&lt;DbjAccessPlanTable *&gt;(table)-&gt;
01325             setTableDescriptor(tableDesc);
01326         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01327             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01328             <span class="keyword">delete</span> tableDesc;
01329             <span class="keywordflow">goto</span> cleanup;
01330         }
01331     }
01332 
01333     <span class="comment">// validiere WHERE-Klausel</span>
01334     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>() != NULL) {
01335         rc = <a class="code" href="class_dbj_compiler.html#d15">validateWhereClause</a>(static_cast&lt;DbjAccessPlanTable *&gt;(table),
01336                 <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>());
01337         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01338             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01339             <span class="keywordflow">goto</span> cleanup;
01340         }
01341     }
01342 
01343  cleanup:
01344     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01345 }
01346 
01347 
01348 <span class="comment">// Validiere Zugriffsplan fuer "SELECT"</span>
<a name="l01349"></a><a class="code" href="class_dbj_compiler.html#d14">01349</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d14">DbjCompiler::validateSelect</a>()
01350 {
01351     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01352     <a class="code" href="class_dbj_access_plan_table.html">DbjAccessPlanTable</a> *tableList = NULL;
01353 
01354     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01355 
01356     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_compiler.html#r0">plan</a> || <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::SelectStmt) {
01357         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01358         <span class="keywordflow">goto</span> cleanup;
01359     }
01360 
01361     <span class="comment">// pruefe ob alle Tabellennamen (mit Korrelationsnamen) eindeutig sind und</span>
01362     <span class="comment">// setze Tabellen-ID &amp; Tabellen-Deskriptor</span>
01363     {
01364         <a class="code" href="group__tableid.html#ga1">TableId</a> tableId = DBJ_UNKNOWN_TABLE_ID;
01365         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *table1 = NULL;
01366         <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
01367 
01368         <span class="keywordflow">if</span> (<a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>() == NULL || <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>() == NULL) {
01369             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01370             <span class="keywordflow">goto</span> cleanup;
01371         }
01372         table1 = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01373         <span class="keywordflow">if</span> (table1 == NULL) {
01374             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01375             <span class="keywordflow">goto</span> cleanup;
01376         }
01377 
01378         <span class="comment">// alle Tabellen brauchen einen Namen!</span>
01379         <span class="keywordflow">while</span> (table1 != NULL) {
01380             <span class="keywordflow">if</span> (table1-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL ||
01381                     table1-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table) {
01382                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01383                 <span class="keywordflow">goto</span> cleanup;
01384             }
01385             table1 = table1-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01386         }
01387 
01388         <span class="comment">// pruefe auf doppelte Tabellennamen (beachte Umbenennungen)</span>
01389         table1 = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01390         <span class="keywordflow">while</span> (table1 != NULL) {
01391             <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *table2 = table1-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01392 
01393             <span class="keywordflow">while</span> (table2 != NULL) {
01394                 <span class="keywordtype">char</span> <span class="keyword">const</span> *name1 = static_cast&lt;DbjAccessPlanTable *&gt;(
01395                         table1)-&gt;getCorrelationName();
01396                 <span class="keywordtype">char</span> <span class="keyword">const</span> *name2 = static_cast&lt;DbjAccessPlanTable *&gt;(
01397                         table2)-&gt;getCorrelationName();
01398                 <span class="keywordflow">if</span> (name1 == NULL) {
01399                     name1 = table1-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>();
01400                 }
01401                 <span class="keywordflow">if</span> (name2 == NULL) {
01402                     name2 = table2-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>();
01403                 }
01404                 <a class="code" href="group__trace__def.html#ga7">DBJ_TRACE_STRING</a>(10, name1);
01405                 <a class="code" href="group__trace__def.html#ga7">DBJ_TRACE_STRING</a>(11, name2);
01406 
01407                 <span class="comment">// teste table1 und table2</span>
01408                 <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(name1, name2) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
01409                     <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a16">DBJ_COMPILER_DUPLICATE_TABLE_NAME</a>,
01410                             name1);
01411                     <span class="keywordflow">goto</span> cleanup;
01412                 }
01413                 table2 = table2-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01414             }
01415 
01416             <span class="comment">// finde Tabellen-ID und Tabellen-Deskriptor</span>
01417             rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a1">getTableId</a>(table1-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), tableId);
01418             <span class="keywordflow">if</span> (rc == <a class="code" href="_dbj_error_codes_8hpp.html#a107a4">DBJ_NOT_FOUND_WARN</a>) {
01419                 <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a15">DBJ_COMPILER_TABLE_NOT_EXISTS</a>,
01420                         table1-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01421                 <span class="keywordflow">goto</span> cleanup;
01422             }
01423             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01424                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01425                 <span class="keywordflow">goto</span> cleanup;
01426             }
01427             rc = table1-&gt;<a class="code" href="class_dbj_access_plan.html#d7">setIntData</a>(tableId);
01428             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01429                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01430                 <span class="keywordflow">goto</span> cleanup;
01431             }
01432             rc = <a class="code" href="class_dbj_compiler.html#r4">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a2">getTableDescriptor</a>(tableId, tableDesc);
01433             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01434                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01435                 <span class="keywordflow">goto</span> cleanup;
01436             }
01437             rc = static_cast&lt;DbjAccessPlanTable *&gt;(table1)-&gt;
01438                 setTableDescriptor(tableDesc);
01439             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01440                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01441                 <span class="keywordflow">goto</span> cleanup;
01442             }
01443             tableDesc = NULL;
01444 
01445             <span class="comment">// bearbeite naechste Tabelle</span>
01446             table1 = table1-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01447         }
01448     }
01449     tableList = static_cast&lt;DbjAccessPlanTable *&gt;(
01450             <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>());
01451 
01452     <span class="comment">// bestimme die Spalten-IDs</span>
01453     {
01454         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *column = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01455         <span class="keywordflow">if</span> (!column) {
01456             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01457             <span class="keywordflow">goto</span> cleanup;
01458         }
01459 
01460         <span class="comment">// alle Spalten brauchen einen Namen!</span>
01461         <span class="keywordflow">while</span> (column != NULL) {
01462             <span class="keywordflow">if</span> (column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL ||
01463                     column-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Column) {
01464                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01465                 <span class="keywordflow">goto</span> cleanup;
01466             }
01467             column = column-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01468         }
01469 
01470         <span class="comment">// bestimme die Tabelle, zu der die Spalte gehoert</span>
01471         column = <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01472         <span class="keywordflow">while</span> (column != NULL) {
01473             <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *entry =
01474                 static_cast&lt;DbjAccessPlanColumn *&gt;(column);
01475 
01476             <span class="comment">// Sonderbehandlung fuer "SELECT * FROM ..."</span>
01477             <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"*"</span>) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
01478                 <a class="code" href="class_dbj_access_plan_table.html">DbjAccessPlanTable</a> *table = tableList;
01479                 <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *nextColumn = column-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01480 
01481                 <span class="comment">// haenge Nachfolger aus (wird spaeter wieder angehaengt)</span>
01482                 column-&gt;<a class="code" href="class_dbj_access_plan.html#d0">setNext</a>(NULL);
01483 
01484                 <span class="comment">// hole alle Spaltennamen fuer die eine Tabelle</span>
01485                 <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="class_dbj_access_plan_table.html#a1">getCorrelationName</a>() != NULL) {
01486                     <span class="keywordtype">bool</span> foundTable = <span class="keyword">false</span>;
01487 
01488                     <span class="comment">// finde Tabelle in Liste</span>
01489                     <span class="keywordflow">while</span> (table != NULL) {
01490                         <span class="keywordtype">char</span> <span class="keyword">const</span> *corrName = table-&gt;<a class="code" href="class_dbj_access_plan_table.html#a1">getCorrelationName</a>();
01491                         <span class="keywordflow">if</span> ((corrName &amp;&amp; <a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(
01492                                      entry-&gt;<a class="code" href="class_dbj_access_plan_table.html#a1">getCorrelationName</a>(),
01493                                      corrName) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) ||
01494                                 (!corrName &amp;&amp; <a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(
01495                                         entry-&gt;<a class="code" href="class_dbj_access_plan_table.html#a1">getCorrelationName</a>(),
01496                                         table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>()) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>)) {
01497                             foundTable = <span class="keyword">true</span>;
01498                             <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *expandStart = NULL;
01499                             <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *expandEnd = NULL;
01500                             rc = <a class="code" href="class_dbj_compiler.html#d19">expandStar</a>(table, expandStart, expandEnd);
01501                             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01502                                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01503                                 <span class="keywordflow">goto</span> cleanup;
01504                             }
01505 
01506                             <span class="comment">// haenge expandierte Liste an stelle des "*" ein</span>
01507                             <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="class_dbj_access_plan.html#a3">getPrevious</a>() == NULL) {
01508                                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01509                                 <span class="keywordflow">goto</span> cleanup;
01510                             }
01511                             entry-&gt;<a class="code" href="class_dbj_access_plan.html#a3">getPrevious</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#d0">setNext</a>(expandStart);
01512                             entry = expandEnd;
01513                             <span class="keywordflow">break</span>;
01514                         }
01515 
01516                         <span class="comment">// pruefe naechste Tabelle</span>
01517                         table = static_cast&lt;DbjAccessPlanTable *&gt;(
01518                                 table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>());
01519                     }
01520 
01521                     <span class="keywordflow">if</span> (!foundTable) {
01522                         <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(
01523                                 <a class="code" href="_dbj_error_codes_8hpp.html#a107a29">DBJ_COMPILER_CORRELATION_NAME_NOT_EXISTS</a>,
01524                                 entry-&gt;<a class="code" href="class_dbj_access_plan_table.html#a1">getCorrelationName</a>());
01525                         <span class="keywordflow">goto</span> cleanup;
01526                     }
01527                     <span class="keywordflow">if</span> (entry == column) {
01528                         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01529                         <span class="keywordflow">goto</span> cleanup;
01530                     }
01531 
01532                     <span class="comment">// loesche "*" Knoten</span>
01533                     <span class="keyword">delete</span> column;
01534                     column = entry;
01535                 }
01536                 <span class="keywordflow">else</span> {
01537                     <span class="comment">// loesche "*" Knoten aus der Liste</span>
01538                     <span class="keywordflow">if</span> (column-&gt;<a class="code" href="class_dbj_access_plan.html#a3">getPrevious</a>() == NULL) {
01539                         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01540                         <span class="keywordflow">goto</span> cleanup;
01541                     }
01542                     column = column-&gt;<a class="code" href="class_dbj_access_plan.html#a3">getPrevious</a>();
01543                     <span class="keyword">delete</span> column-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01544                     column-&gt;<a class="code" href="class_dbj_access_plan.html#d0">setNext</a>(NULL);
01545 
01546                     <span class="comment">// hole alle Spaltennamen aller Tabellen</span>
01547                     <span class="keywordflow">while</span> (table != NULL) {
01548                         <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *expandStart = NULL;
01549                         <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *expandEnd = NULL;
01550                         rc = <a class="code" href="class_dbj_compiler.html#d19">expandStar</a>(table, expandStart, expandEnd);
01551                         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01552                             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01553                             <span class="keywordflow">goto</span> cleanup;
01554                         }
01555 
01556                         column-&gt;<a class="code" href="class_dbj_access_plan.html#d0">setNext</a>(expandStart);
01557                         column = expandEnd;
01558 
01559                         <span class="comment">// gehen zur naechsten Tabelle</span>
01560                         table = static_cast&lt;DbjAccessPlanTable *&gt;(
01561                                 table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>());
01562                     }
01563                 }
01564 
01565                 <span class="comment">// haenge urspruenglichen Nachfolger wieder an</span>
01566                 column-&gt;<a class="code" href="class_dbj_access_plan.html#d0">setNext</a>(nextColumn);
01567             }
01568             <span class="keywordflow">else</span> {
01569                 rc = <a class="code" href="class_dbj_compiler.html#d18">resolveColumn</a>(tableList, entry);
01570                 <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01571                     <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01572                     <span class="keywordflow">goto</span> cleanup;
01573                 }
01574             }
01575 
01576             <span class="comment">// verarbeite naechste Spalte</span>
01577             column = column-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01578         }
01579     }
01580 
01581     <span class="comment">// pruefe WHERE-Klausel</span>
01582     rc = <a class="code" href="class_dbj_compiler.html#d15">validateWhereClause</a>(tableList, <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>());
01583     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01584         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01585         <span class="keywordflow">goto</span> cleanup;
01586     }
01587 
01588  cleanup:
01589     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01590 }
01591 
01592 
01593 <span class="comment">// Validiere Zugriffsplan fuer WHERE-Klausel</span>
<a name="l01594"></a><a class="code" href="class_dbj_compiler.html#d15">01594</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d15">DbjCompiler::validateWhereClause</a>(<a class="code" href="class_dbj_access_plan_table.html">DbjAccessPlanTable</a> *tableList,
01595         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *whereClause)
01596 {
01597     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01598 
01599     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01600 
01601     <span class="comment">// pruefe Eingabeparameter</span>
01602     <span class="keywordflow">if</span> (tableList == NULL) {
01603         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01604         <span class="keywordflow">goto</span> cleanup;
01605     }
01606 
01607     <span class="comment">// gehe zum ersten Praedikat</span>
01608     <span class="keywordflow">if</span> (!whereClause) {
01609         <span class="keywordflow">goto</span> cleanup;
01610     }
01611     <span class="keywordflow">if</span> (whereClause-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::WhereClause) {
01612         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01613         <span class="keywordflow">goto</span> cleanup;
01614     }
01615 
01616     rc = <a class="code" href="class_dbj_compiler.html#d16">validatePredicate</a>(tableList, whereClause-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>());
01617     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01618         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01619         <span class="keywordflow">goto</span> cleanup;
01620     }
01621 
01622  cleanup:
01623     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01624 }
01625 
01626 
01627 <span class="comment">// Validiere Zugriffsplan fuer ein Praedikat</span>
<a name="l01628"></a><a class="code" href="class_dbj_compiler.html#d16">01628</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d16">DbjCompiler::validatePredicate</a>(<a class="code" href="class_dbj_access_plan_table.html">DbjAccessPlanTable</a> *tableList,
01629         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *predicate)
01630 {
01631     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01632 
01633     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01634 
01635     <span class="comment">// ein Praedikat muss gegeben sein</span>
01636     <span class="keywordflow">if</span> (predicate == NULL) {
01637         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01638         <span class="keywordflow">goto</span> cleanup;
01639     }
01640 
01641     <span class="comment">// ueberspringe Negationen</span>
01642     <span class="keywordflow">if</span> (predicate-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() == DbjAccessPlan::Negation) {
01643         predicate = predicate-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01644     }
01645 
01646     <span class="comment">// gehe zum ersten Teil des Praedikats</span>
01647     <span class="keywordflow">if</span> (predicate-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() == DbjAccessPlan::Predicate) {
01648         <span class="comment">// gehe zum Sohn um das Praedikat aufzuloesen</span>
01649         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *next = predicate-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01650         <span class="keywordflow">if</span> (!next) {
01651             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01652             <span class="keywordflow">goto</span> cleanup;
01653         }
01654         rc = <a class="code" href="class_dbj_compiler.html#d16">validatePredicate</a>(tableList, next);
01655         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01656             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01657             <span class="keywordflow">goto</span> cleanup;
01658         }
01659 
01660         <span class="comment">// gehe zum Nachbarn wenn eine logische Verknuepfung angegeben wurde</span>
01661         next = predicate-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01662         <span class="keywordflow">if</span> (next != NULL) {
01663             <span class="keywordflow">if</span> (next-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::LogicalOperation) {
01664                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01665                 <span class="keywordflow">goto</span> cleanup;
01666             }
01667             next = next-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01668             rc = <a class="code" href="class_dbj_compiler.html#d16">validatePredicate</a>(tableList, next);
01669             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01670                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01671                 <span class="keywordflow">goto</span> cleanup;
01672             }
01673         }
01674         <span class="keywordflow">goto</span> cleanup;
01675     }
01676 
01677     <span class="comment">// loese das Praedikat auf (column/value - comparison - column/value)</span>
01678     {
01679         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *expr1 = predicate;
01680         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *expr2 = predicate-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01681         <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> expr1Type = <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>;
01682 
01683         <span class="keywordflow">if</span> (expr2 == NULL || expr2-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>() == NULL ||
01684                 expr2-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Comparison) {
01685             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01686             <span class="keywordflow">goto</span> cleanup;
01687         }
01688         expr2 = expr2-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01689 
01690         <span class="comment">// bestimme den Datentyp des ersten Ausdrucks</span>
01691         <span class="keywordflow">switch</span> (expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>()) {
01692           <span class="keywordflow">case</span> DbjAccessPlan::IntegerValue: expr1Type = <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>; <span class="keywordflow">break</span>;
01693           <span class="keywordflow">case</span> DbjAccessPlan::VarcharValue: expr1Type = <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>; <span class="keywordflow">break</span>;
01694           <span class="keywordflow">case</span> DbjAccessPlan::Column:
01695               {
01696                   <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
01697                   <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *column =
01698                       static_cast&lt;DbjAccessPlanColumn *&gt;(expr1);
01699 
01700                   <span class="comment">// bestimme weitere Informationen der Spalte</span>
01701                   rc = <a class="code" href="class_dbj_compiler.html#d18">resolveColumn</a>(tableList, column);
01702                   <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01703                       <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01704                       <span class="keywordflow">goto</span> cleanup;
01705                   }
01706 
01707                   <span class="comment">// hole den Table-Deskriptor fuer die Spalte</span>
01708                   tableDesc = column-&gt;<a class="code" href="class_dbj_access_plan_column.html#a3">getTableDescriptor</a>();
01709                   <span class="keywordflow">if</span> (!tableDesc) {
01710                       <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01711                       <span class="keywordflow">goto</span> cleanup;
01712                   }
01713 
01714                   <span class="comment">// hole den Datentyp fuer die Spalte</span>
01715                   rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(*(column-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>()),
01716                           expr1Type);
01717                   <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01718                       <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01719                       <span class="keywordflow">goto</span> cleanup;
01720                   }
01721               }
01722               <span class="keywordflow">break</span>;
01723           <span class="keywordflow">default</span>:
01724               <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01725               <span class="keywordflow">goto</span> cleanup;
01726         }
01727 
01728         <span class="comment">// gleiche Datentyp mit zweitem Ausdruck ab</span>
01729         <span class="keywordflow">switch</span> (expr2-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>()) {
01730           <span class="keywordflow">case</span> DbjAccessPlan::IntegerValue:
01731               <span class="keywordflow">if</span> (expr1Type == <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>) {
01732                   <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a28">DBJ_COMPILER_PREDICATE_TYPE_MISMATCH</a>,
01733                           expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01734                           expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01735                           *(expr2-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>()));
01736                   <span class="keywordflow">goto</span> cleanup;
01737               }
01738               <span class="keywordflow">break</span>;
01739           <span class="keywordflow">case</span> DbjAccessPlan::VarcharValue:
01740               <span class="keywordflow">if</span> (expr1Type == <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>) {
01741                   <span class="keywordflow">if</span> (expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() == DbjAccessPlan::Column) {
01742                       <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a28">DBJ_COMPILER_PREDICATE_TYPE_MISMATCH</a>,
01743                               expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01744                               expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01745                               expr2-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01746                   }
01747                   <span class="keywordflow">else</span> {
01748                       <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a28">DBJ_COMPILER_PREDICATE_TYPE_MISMATCH</a>,
01749                               *(expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>()),
01750                               expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01751                               expr2-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01752                   }
01753                   <span class="keywordflow">goto</span> cleanup;
01754               }
01755               <span class="keywordflow">break</span>;
01756           <span class="keywordflow">case</span> DbjAccessPlan::NullValue:
01757               <span class="keywordflow">break</span>;
01758           <span class="keywordflow">case</span> DbjAccessPlan::Column:
01759               {
01760                   <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
01761                   <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> expr2Type = <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>;
01762                   <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *column =
01763                       static_cast&lt;DbjAccessPlanColumn *&gt;(expr2);
01764 
01765                   <span class="comment">// bestimme weitere Informationen der Spalte</span>
01766                   rc = <a class="code" href="class_dbj_compiler.html#d18">resolveColumn</a>(tableList, column);
01767                   <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01768                       <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01769                       <span class="keywordflow">goto</span> cleanup;
01770                   }
01771 
01772                   <span class="comment">// hole den Table-Deskriptor fuer die Spalte</span>
01773                   tableDesc = column-&gt;<a class="code" href="class_dbj_access_plan_column.html#a3">getTableDescriptor</a>();
01774                   <span class="keywordflow">if</span> (!tableDesc) {
01775                       <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01776                       <span class="keywordflow">goto</span> cleanup;
01777                   }
01778 
01779                   <span class="comment">// hole den Datentyp fuer die Spalte</span>
01780                   rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(*(column-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>()),
01781                           expr2Type);
01782                   <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01783                       <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01784                       <span class="keywordflow">goto</span> cleanup;
01785                   }
01786                   <span class="keywordflow">if</span> (expr1Type != expr2Type) {
01787                       <span class="keywordflow">if</span> (expr1Type == <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>) {
01788                           <span class="keywordflow">if</span> (expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() == DbjAccessPlan::Column) {
01789                               <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(
01790                                       <a class="code" href="_dbj_error_codes_8hpp.html#a107a28">DBJ_COMPILER_PREDICATE_TYPE_MISMATCH</a>,
01791                                       expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01792                                       expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01793                                       expr2-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01794                           }
01795                           <span class="keywordflow">else</span> {
01796                               <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(
01797                                       <a class="code" href="_dbj_error_codes_8hpp.html#a107a28">DBJ_COMPILER_PREDICATE_TYPE_MISMATCH</a>,
01798                                       *(expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>()),
01799                                       expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01800                                       expr2-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01801                           }
01802                       }
01803                       <span class="keywordflow">else</span> {
01804                           <span class="keywordflow">if</span> (expr2-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() == DbjAccessPlan::Column) {
01805                               <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(
01806                                       <a class="code" href="_dbj_error_codes_8hpp.html#a107a28">DBJ_COMPILER_PREDICATE_TYPE_MISMATCH</a>,
01807                                       expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01808                                       expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01809                                       expr2-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01810                           }
01811                           <span class="keywordflow">else</span> {
01812                               <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(
01813                                       <a class="code" href="_dbj_error_codes_8hpp.html#a107a28">DBJ_COMPILER_PREDICATE_TYPE_MISMATCH</a>,
01814                                       expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01815                                       expr1-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01816                                       *(expr2-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>()));
01817                           }
01818                       }
01819                       <span class="keywordflow">goto</span> cleanup;
01820                   }
01821               }
01822               <span class="keywordflow">break</span>;
01823           <span class="keywordflow">default</span>:
01824               <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01825               <span class="keywordflow">goto</span> cleanup;
01826         }
01827     }
01828 
01829  cleanup:
01830     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01831 }
01832 
01833 
01834 <span class="comment">// Validiere Zugriffsplan fuer "COMMIT" oder "ROLLBACK"</span>
<a name="l01835"></a><a class="code" href="class_dbj_compiler.html#d17">01835</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d17">DbjCompiler::validateEndOfTransaction</a>()
01836 {
01837     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01838 
01839     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_compiler.html#r0">plan</a> || (<a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::CommitStmt &amp;&amp;
01840                 <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::RollbackStmt)) {
01841         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01842         <span class="keywordflow">goto</span> cleanup;
01843     }
01844 
01845     <span class="comment">// kein weiterer Knoten im Plan</span>
01846     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>() != NULL || <a class="code" href="class_dbj_compiler.html#r0">plan</a>-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>() != NULL) {
01847         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01848         <span class="keywordflow">goto</span> cleanup;
01849     }
01850 
01851  cleanup:
01852     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01853 }
01854 
01855 <span class="comment">// Bestimme Tabelle fuer Spalte</span>
<a name="l01856"></a><a class="code" href="class_dbj_compiler.html#d18">01856</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d18">DbjCompiler::resolveColumn</a>(<a class="code" href="class_dbj_access_plan_table.html">DbjAccessPlanTable</a> *tableList,
01857         <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *column)
01858 {
01859     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01860     <a class="code" href="class_dbj_access_plan_table.html">DbjAccessPlanTable</a> *table = NULL;
01861     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnNumber = 0;
01862 
01863     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01864 
01865     <span class="comment">// ueberpruefe alle Tabellen</span>
01866     <span class="keywordflow">while</span> (tableList != NULL) {
01867         <span class="comment">/*</span>
01868 <span class="comment">         * Es gibt pro Tabelle-Spalte-Paar folgende 4 Moeglichkeiten fuer</span>
01869 <span class="comment">         * Korrelationsnamen:</span>
01870 <span class="comment">         *</span>
01871 <span class="comment">         *       \Tabelle   |                     |</span>
01872 <span class="comment">         *        \         |   mit Korr.-Name    |  ohne Korr.-Name</span>
01873 <span class="comment">         *   Spalte\        |                     |</span>
01874 <span class="comment">         * -----------------+---------------------+-------------------</span>
01875 <span class="comment">         *                  |                     | Korr.-Name der       </span>
01876 <span class="comment">         * mit Korr.-Name   | beide Namen muessen | Spalte muss mit</span>
01877 <span class="comment">         *                  | uebereinstimmen     | Tabellennamen</span>
01878 <span class="comment">         *                  |                     | uebereinstimmen</span>
01879 <span class="comment">         * -----------------+---------------------+-------------------</span>
01880 <span class="comment">         *  ohne Korr.-Name | Spalte muss in      | Spalte muss in</span>
01881 <span class="comment">         *                  | Tabelle vorkommen   | Tabelle vorkommen</span>
01882 <span class="comment">         *</span>
01883 <span class="comment">         * Im Ergebnis steht in "columnNumber" die ID der Spalte in der</span>
01884 <span class="comment">         * gefundenen Tabelle.  Weiterhin ist in "table" der Tabellen-Knoten</span>
01885 <span class="comment">         * vermerkt.</span>
01886 <span class="comment">         */</span>
01887 
01888         <span class="comment">// pruefe, ob Tabelle und Spalte gleichen Korrelationsnamen haben</span>
01889         <span class="keywordflow">if</span> (column-&gt;<a class="code" href="class_dbj_access_plan_table.html#a1">getCorrelationName</a>() != NULL) {
01890             <span class="keywordtype">char</span> <span class="keyword">const</span> *tabName = tableList-&gt;<a class="code" href="class_dbj_access_plan_table.html#a1">getCorrelationName</a>();
01891             <span class="keywordflow">if</span> (tabName == NULL) {
01892                 tabName = tableList-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>();
01893                 <span class="keywordflow">if</span> (tabName == NULL) {
01894                     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01895                     <span class="keywordflow">goto</span> cleanup;
01896                 }
01897             }
01898 
01899             <span class="comment">// ueberpruefe ob Namen uebereinstimmen und wir damit die richtige</span>
01900             <span class="comment">// Tabelle gefunden haben</span>
01901             <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(column-&gt;<a class="code" href="class_dbj_access_plan_table.html#a1">getCorrelationName</a>(), tabName) ==
01902                     <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
01903                 <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
01904                 <span class="keywordflow">if</span> (table != NULL) {
01905                     <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a23">DBJ_COMPILER_COLUMN_TABLE_NOT_UNIQUE</a>,
01906                             column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01907                     <span class="keywordflow">goto</span> cleanup;
01908                 }
01909                 table = tableList;
01910 
01911                 <span class="comment">// ueberpruefe ob Spalte in Tabelle ueberhaupt existiert und</span>
01912                 <span class="comment">// bestimme Spalten-ID</span>
01913                 tableDesc = tableList-&gt;getTableDescriptor();
01914                 <span class="keywordflow">if</span> (tableDesc == NULL) {
01915                     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01916                     <span class="keywordflow">goto</span> cleanup;
01917                 }
01918                 rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a9">getColumnNumber</a>(column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01919                         columnNumber);
01920                 <span class="keywordflow">if</span> (rc == <a class="code" href="_dbj_error_codes_8hpp.html#a107a4">DBJ_NOT_FOUND_WARN</a>) {
01921                     <a class="code" href="_dbj_error_8hpp.html#a3">DBJ_SET_ERROR_TOKEN2</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a22">DBJ_COMPILER_COLUMN_NOT_FOUND</a>,
01922                             column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01923                     <span class="keywordflow">goto</span> cleanup;
01924                 }
01925                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01926                     <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01927                     <span class="keywordflow">goto</span> cleanup;
01928                 }
01929             }
01930         }
01931         <span class="keywordflow">else</span> {
01932             <span class="comment">/*</span>
01933 <span class="comment">             * Der Korrelationsname der Tabelle ist nun egal; wir schauen</span>
01934 <span class="comment">             * einfach nach, ob die Spalte in der Tabelle vorkommt.</span>
01935 <span class="comment">             */</span>
01936             <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
01937             tableDesc = tableList-&gt;<a class="code" href="class_dbj_access_plan_table.html#a2">getTableDescriptor</a>();
01938             <span class="keywordflow">if</span> (!tableDesc) {
01939                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01940                 <span class="keywordflow">goto</span> cleanup;
01941             }
01942 
01943             <span class="comment">// suche nach Spalte im aktuellen Tabellendeskriptor</span>
01944             rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a9">getColumnNumber</a>(column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01945                     columnNumber);
01946             <span class="keywordflow">if</span> (rc == <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01947                 <span class="comment">// Tabelle gefunden</span>
01948                 <span class="keywordflow">if</span> (table != NULL) {
01949                     <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a23">DBJ_COMPILER_COLUMN_TABLE_NOT_UNIQUE</a>,
01950                             column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01951                     <span class="keywordflow">goto</span> cleanup;
01952                 }
01953                 table = tableList;
01954             }
01955             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a4">DBJ_NOT_FOUND_WARN</a>) {
01956                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01957                 <span class="keywordflow">goto</span> cleanup;
01958             }
01959             <span class="keywordflow">else</span> {
01960                 <span class="comment">// Spalte ist nicht in Tabelle</span>
01961                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>); <span class="comment">// Warning zuruecksetzen</span>
01962             }
01963         }
01964 
01965         <span class="comment">// bearbeite die naechste Tabelle</span>
01966         tableList = static_cast&lt;DbjAccessPlanTable *&gt;(tableList-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>());
01967     }
01968 
01969     <span class="comment">// es muss eine Tabelle gefunden worden sein</span>
01970     <span class="keywordflow">if</span> (!table) {
01971         <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a21">DBJ_COMPILER_COLUMN_NOT_FOUND_IN_ANY</a>,
01972                 column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01973         <span class="keywordflow">goto</span> cleanup;
01974     }
01975 
01976     <span class="comment">// setze alle noetigen Informationen fuer die Spalte</span>
01977     rc = column-&gt;<a class="code" href="class_dbj_access_plan_column.html#d1">setTableNode</a>(table);
01978     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01979         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01980         <span class="keywordflow">goto</span> cleanup;
01981     }
01982     rc = column-&gt;setIntData(columnNumber);
01983     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01984         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01985         <span class="keywordflow">goto</span> cleanup;
01986     }
01987 
01988  cleanup:
01989     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01990 }
01991 
01992 
01993 <span class="comment">// expandiere Spaltenliste</span>
<a name="l01994"></a><a class="code" href="class_dbj_compiler.html#d19">01994</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d19">DbjCompiler::expandStar</a>(<a class="code" href="class_dbj_access_plan_table.html">DbjAccessPlanTable</a> <span class="keyword">const</span> *table,
01995         <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *&amp;firstColumn, <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *&amp;lastColumn)
01996 {
01997     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01998     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> numColumns = 0;
01999     <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
02000 
02001     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
02002 
02003     <span class="keywordflow">if</span> (!table || firstColumn != NULL || lastColumn != NULL) {
02004         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
02005         <span class="keywordflow">goto</span> cleanup;
02006     }
02007 
02008     tableDesc = table-&gt;<a class="code" href="class_dbj_access_plan_table.html#a2">getTableDescriptor</a>();
02009     <span class="keywordflow">if</span> (!tableDesc) {
02010         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
02011         <span class="keywordflow">goto</span> cleanup;
02012     }
02013 
02014     <span class="comment">// hole alle Spaltennamen der Tabelle</span>
02015     rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a5">getNumColumns</a>(numColumns);
02016     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
02017         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
02018         <span class="keywordflow">goto</span> cleanup;
02019     }
02020     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(10, <span class="stringliteral">"Number of columns"</span>, numColumns);
02021     <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> i = 0; i &lt; numColumns; i++) {
02022         <span class="keywordtype">char</span> <span class="keyword">const</span> *columnName = NULL;
02023         <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *newEntry = <span class="keyword">new</span> <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a>();
02024         <span class="keywordflow">if</span> (!newEntry) {
02025             <span class="keywordflow">goto</span> cleanup;
02026         }
02027 
02028         <span class="comment">// setze Spaltennamen</span>
02029         rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a8">getColumnName</a>(i, columnName);
02030         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
02031             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
02032             <span class="keywordflow">goto</span> cleanup;
02033         }
02034         rc = newEntry-&gt;setStringData(columnName);
02035         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
02036             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
02037             <span class="keywordflow">goto</span> cleanup;
02038         }
02039         rc = newEntry-&gt;<a class="code" href="class_dbj_access_plan_table.html#b1">setCorrelationName</a>(table-&gt;<a class="code" href="class_dbj_access_plan_table.html#a1">getCorrelationName</a>() ?
02040                 table-&gt;<a class="code" href="class_dbj_access_plan_table.html#a1">getCorrelationName</a>() : table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
02041         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
02042             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
02043             <span class="keywordflow">goto</span> cleanup;
02044         }
02045 
02046         <span class="comment">// setze Spalten-ID</span>
02047         rc = newEntry-&gt;setIntData(i);
02048         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
02049             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
02050             <span class="keywordflow">goto</span> cleanup;
02051         }
02052 
02053         <span class="comment">// setze Tabellen-Informationen</span>
02054         rc = newEntry-&gt;<a class="code" href="class_dbj_access_plan_column.html#d1">setTableNode</a>(table);
02055         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
02056             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
02057             <span class="keywordflow">goto</span> cleanup;
02058         }
02059 
02060         <span class="comment">// haenge neue Spalte in Liste</span>
02061         <span class="keywordflow">if</span> (firstColumn == NULL) {
02062             firstColumn = newEntry;
02063         }
02064         <span class="keywordflow">if</span> (lastColumn == NULL) {
02065             lastColumn = newEntry;
02066         }
02067         <span class="keywordflow">else</span> {
02068             lastColumn-&gt;addNext(newEntry);
02069             lastColumn = newEntry;
02070         }
02071     }
02072 
02073     <span class="keywordflow">if</span> (firstColumn == NULL || lastColumn == NULL) {
02074         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
02075         <span class="keywordflow">goto</span> cleanup;
02076     }
02077 
02078  cleanup:
02079     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
02080 }
02081 
02082 
02083 <span class="comment">// Validiere Zuweisung eines UPDATE</span>
<a name="l02084"></a><a class="code" href="class_dbj_compiler.html#d20">02084</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_compiler.html#d20">DbjCompiler::validateAssignment</a>(<a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *column,
02085         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *value)
02086 {
02087     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
02088     <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
02089     <span class="keyword">const</span> <span class="keywordtype">char</span> *tableName = NULL;
02090     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnId = 0;
02091     <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> targetType = <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>;
02092     <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> sourceType = <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>;
02093 
02094     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
02095 
02096     <span class="keywordflow">if</span> (!column || column-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Column ||
02097             !column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() || !column-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() ||
02098             !value) {
02099         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
02100         <span class="keywordflow">goto</span> cleanup;
02101     }
02102 
02103     <span class="comment">// hole Deskriptor der Tabelle</span>
02104     tableDesc = column-&gt;<a class="code" href="class_dbj_access_plan_column.html#a3">getTableDescriptor</a>();
02105     <span class="keywordflow">if</span> (!tableDesc) {
02106         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
02107         <span class="keywordflow">goto</span> cleanup;
02108     }
02109     rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a3">getTableName</a>(tableName);
02110     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
02111         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
02112         <span class="keywordflow">goto</span> cleanup;
02113     }
02114 
02115     <span class="comment">// hole ID der Spalte</span>
02116     {
02117         <span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga12">Sint32</a> *<span class="keywordtype">id</span> = column-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>();
02118         <span class="keywordflow">if</span> (!<span class="keywordtype">id</span> || *id &lt; 0 || *id &gt; DBJ_MAX_UINT16) {
02119             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
02120             <span class="keywordflow">goto</span> cleanup;
02121         }
02122         columnId = <a class="code" href="group__int__datatypes.html#ga9">Uint16</a>(*<span class="keywordtype">id</span>);
02123     }
02124     <a class="code" href="group__trace__def.html#ga7">DBJ_TRACE_STRING</a>(1, tableName);
02125     <a class="code" href="group__trace__def.html#ga7">DBJ_TRACE_STRING</a>(2, column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
02126     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(3, <span class="stringliteral">"Column ID"</span>, columnId);
02127 
02128     <span class="comment">// ermittle Datentyp der Zielspalte</span>
02129     rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(columnId, targetType);
02130     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
02131         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
02132         <span class="keywordflow">goto</span> cleanup;
02133     }
02134 
02135     <span class="comment">// ermittle Datentyp der Quelle</span>
02136     <span class="keywordflow">switch</span> (value-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>()) {
02137       <span class="keywordflow">case</span> DbjAccessPlan::Column:
02138           {
02139               <span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga12">Sint32</a> *<span class="keywordtype">id</span> = NULL;
02140 
02141               <span class="keywordtype">id</span> = value-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>();
02142               <span class="keywordflow">if</span> (!<span class="keywordtype">id</span> || *id &lt; 0 || *id &gt; DBJ_MAX_UINT16) {
02143                   <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
02144                   <span class="keywordflow">goto</span> cleanup;
02145               }
02146               rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>(*<span class="keywordtype">id</span>), sourceType);
02147               <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
02148                   <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
02149                   <span class="keywordflow">goto</span> cleanup;
02150               }
02151           }
02152           <span class="keywordflow">break</span>;
02153 
02154       <span class="keywordflow">case</span> DbjAccessPlan::IntegerValue:
02155           sourceType = <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>;
02156           <span class="keywordflow">break</span>;
02157 
02158       <span class="keywordflow">case</span> DbjAccessPlan::VarcharValue:
02159           sourceType = <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>;
02160           <span class="keywordflow">break</span>;
02161 
02162       <span class="keywordflow">case</span> DbjAccessPlan::NullValue:
02163           {
02164               <span class="keywordtype">bool</span> nullable = <span class="keyword">false</span>;
02165               rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a12">getIsNullable</a>(columnId, nullable);
02166               <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
02167                   <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
02168                   <span class="keywordflow">goto</span> cleanup;
02169               }
02170               <span class="keywordflow">if</span> (!nullable) {
02171                   <a class="code" href="_dbj_error_8hpp.html#a3">DBJ_SET_ERROR_TOKEN2</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a24">DBJ_COMPILER_COLUMN_NOT_NULLABLE</a>,
02172                           column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), tableName);
02173                   <span class="keywordflow">goto</span> cleanup;
02174               }
02175           }
02176           sourceType = targetType;
02177           <span class="keywordflow">break</span>;
02178 
02179       <span class="keywordflow">default</span>:
02180           <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
02181           <span class="keywordflow">goto</span> cleanup;
02182     }
02183 
02184     <span class="comment">// pruefe Datentypen</span>
02185     <span class="keywordflow">switch</span> (targetType) {
02186       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>:
02187           <span class="keywordflow">if</span> (sourceType != <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>) {
02188               <span class="keyword">const</span> <span class="keywordtype">char</span> *columnName = NULL;
02189               rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a8">getColumnName</a>(columnId, columnName);
02190               <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
02191                   <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
02192                   <span class="keywordflow">goto</span> cleanup;
02193               }
02194               <a class="code" href="_dbj_error_8hpp.html#a5">DBJ_SET_ERROR_TOKEN4</a>(
02195                       <a class="code" href="_dbj_error_codes_8hpp.html#a107a27">DBJ_COMPILER_UPDATE_VALUE_TYPE_MISMATCH</a>,
02196                       columnName, tableName, <span class="stringliteral">"INTEGER"</span>, <span class="stringliteral">"VARCHAR"</span>);
02197               <span class="keywordflow">goto</span> cleanup;
02198           }
02199           <span class="keywordflow">break</span>;
02200       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>:
02201           <span class="keywordflow">if</span> (sourceType != <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>) {
02202               <span class="keyword">const</span> <span class="keywordtype">char</span> *columnName = NULL;
02203               rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a8">getColumnName</a>(columnId, columnName);
02204               <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
02205                   <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
02206                   <span class="keywordflow">goto</span> cleanup;
02207               }
02208               <a class="code" href="_dbj_error_8hpp.html#a5">DBJ_SET_ERROR_TOKEN4</a>(
02209                       <a class="code" href="_dbj_error_codes_8hpp.html#a107a27">DBJ_COMPILER_UPDATE_VALUE_TYPE_MISMATCH</a>,
02210                       columnName, tableName, <span class="stringliteral">"VARCHAR"</span>, <span class="stringliteral">"INTEGER"</span>);
02211               <span class="keywordflow">goto</span> cleanup;
02212           }
02213           <span class="keywordflow">break</span>;
02214       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>:
02215           <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
02216           <span class="keywordflow">goto</span> cleanup;
02217     }
02218 
02219  cleanup:
02220     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
02221 }
02222 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jul 4 15:40:29 2005 for Jenas Datenbanksystem 'System J' by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.8 </small></address>
</body>
</html>
