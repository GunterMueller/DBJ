<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Jenas Datenbanksystem &apos;System J&apos;: DbjRunTime.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>DbjRunTime.cpp</h1><a href="_dbj_run_time_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************\</span>
00002 <span class="comment"> *                                                                       *</span>
00003 <span class="comment"> * (C) 2004-2005                                                         *</span>
00004 <span class="comment"> * Lehrstuhl fuer Datenbanken und Informationssysteme                    *</span>
00005 <span class="comment"> * Friedrich-Schiller-Universitaet Jena                                  *</span>
00006 <span class="comment"> * Ernst-Abbe-Platz 1-2                                                  *</span>
00007 <span class="comment"> * 07745 Jena                                                            *</span>
00008 <span class="comment"> *                                                                       *</span>
00009 <span class="comment">\*************************************************************************/</span>
00010 
00011 
00012 <span class="preprocessor">#include "<a class="code" href="_dbj_run_time_8hpp.html">DbjRunTime.hpp</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="_dbj_access_plan_8hpp.html">DbjAccessPlan.hpp</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="_dbj_table_8hpp.html">DbjTable.hpp</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="_dbj_catalog_manager_8hpp.html">DbjCatalogManager.hpp</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="_dbj_record_manager_8hpp.html">DbjRecordManager.hpp</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="_dbj_index_manager_8hpp.html">DbjIndexManager.hpp</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="_dbj_lock_manager_8hpp.html">DbjLockManager.hpp</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="_dbj_string_8hpp.html">DbjString.hpp</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="_dbj_cross_product_tuple_iterator_8hpp.html">DbjCrossProductTupleIterator.hpp</a>"</span>
00021 <span class="preprocessor">#include "<a class="code" href="_dbj_projection_tuple_iterator_8hpp.html">DbjProjectionTupleIterator.hpp</a>"</span>
00022 <span class="preprocessor">#include "<a class="code" href="_dbj_selection_tuple_iterator_8hpp.html">DbjSelectionTupleIterator.hpp</a>"</span>
00023 <span class="preprocessor">#include "<a class="code" href="_dbj_record_tuple_iterator_8hpp.html">DbjRecordTupleIterator.hpp</a>"</span>
00024 <span class="preprocessor">#include "<a class="code" href="_dbj_index_tuple_iterator_8hpp.html">DbjIndexTupleIterator.hpp</a>"</span>
00025 
<a name="l00026"></a><a class="code" href="_dbj_run_time_8cpp.html#a0">00026</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="_dbj_components_8hpp.html#a12">DbjComponent</a> <a class="code" href="_dbj_run_time_8cpp.html#a0">componentId</a> = <a class="code" href="_dbj_components_8hpp.html#a12a5">RunTime</a>;
00027 
00028 
00029 <span class="comment">// Konstruktor</span>
<a name="l00030"></a><a class="code" href="class_dbj_run_time.html#a0">00030</a> <a class="code" href="class_dbj_run_time.html#a0">DbjRunTime::DbjRunTime</a>()
00031     : catalogMgr(NULL), indexMgr(NULL), recordMgr(NULL),
00032       fetchTupleIterator(NULL)
00033 {
00034     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00035 
00036     <a class="code" href="class_dbj_run_time.html#r0">catalogMgr</a> = <a class="code" href="class_dbj_catalog_manager.html#e0">DbjCatalogManager::getInstance</a>();
00037     <a class="code" href="class_dbj_run_time.html#r1">indexMgr</a> = <a class="code" href="class_dbj_index_manager.html#e0">DbjIndexManager::getInstance</a>();
00038     <a class="code" href="class_dbj_run_time.html#r2">recordMgr</a> = <a class="code" href="class_dbj_record_manager.html#e0">DbjRecordManager::getInstance</a>();
00039 }
00040 
00041 
00042 <span class="comment">// Fuehre Anweisung aus</span>
<a name="l00043"></a><a class="code" href="class_dbj_run_time.html#a1">00043</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#a1">DbjRunTime::execute</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *accessPlan)
00044 {
00045     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00046 
00047     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00048 
00049     <span class="keywordflow">if</span> (!accessPlan) {
00050         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00051         <span class="keywordflow">goto</span> cleanup;
00052     }
00053 
00054     <span class="keyword">delete</span> <a class="code" href="class_dbj_run_time.html#r3">fetchTupleIterator</a>;
00055     <a class="code" href="class_dbj_run_time.html#r3">fetchTupleIterator</a> = NULL;
00056 
00057     <span class="keywordflow">switch</span> (accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>()) {
00058       <span class="keywordflow">case</span> DbjAccessPlan::CreateTableStmt:
00059           rc = <a class="code" href="class_dbj_run_time.html#d0">executeCreateTable</a>(accessPlan);
00060           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00061               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00062               <span class="keywordflow">goto</span> cleanup;
00063           }
00064           <span class="keywordflow">break</span>;
00065 
00066       <span class="keywordflow">case</span> DbjAccessPlan::DropTableStmt:
00067           rc = <a class="code" href="class_dbj_run_time.html#d1">executeDropTable</a>(accessPlan);
00068           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00069               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00070               <span class="keywordflow">goto</span> cleanup;
00071           }
00072           <span class="keywordflow">break</span>;
00073 
00074       <span class="keywordflow">case</span> DbjAccessPlan::CreateIndexStmt:
00075           rc = <a class="code" href="class_dbj_run_time.html#d2">executeCreateIndex</a>(accessPlan);
00076           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00077               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00078               <span class="keywordflow">goto</span> cleanup;
00079           }
00080           <span class="keywordflow">break</span>;
00081 
00082       <span class="keywordflow">case</span> DbjAccessPlan::DropIndexStmt:
00083           rc = <a class="code" href="class_dbj_run_time.html#d3">executeDropIndex</a>(accessPlan);
00084           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00085               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00086               <span class="keywordflow">goto</span> cleanup;
00087           }
00088           <span class="keywordflow">break</span>;
00089 
00090       <span class="keywordflow">case</span> DbjAccessPlan::InsertStmt:
00091           rc = <a class="code" href="class_dbj_run_time.html#d4">executeInsert</a>(accessPlan);
00092           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00093               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00094               <span class="keywordflow">goto</span> cleanup;
00095           }
00096           <span class="keywordflow">break</span>;
00097 
00098       <span class="keywordflow">case</span> DbjAccessPlan::DeleteStmt:
00099           rc = <a class="code" href="class_dbj_run_time.html#d7">executeDelete</a>(accessPlan);
00100           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00101               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00102               <span class="keywordflow">goto</span> cleanup;
00103           }
00104           <span class="keywordflow">break</span>;
00105 
00106       <span class="keywordflow">case</span> DbjAccessPlan::SelectStmt:
00107           rc = <a class="code" href="class_dbj_run_time.html#d10">executeSelect</a>(accessPlan);
00108           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00109               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00110               <span class="keywordflow">goto</span> cleanup;
00111           }
00112           <span class="keywordflow">break</span>;
00113 
00114       <span class="keywordflow">case</span> DbjAccessPlan::CommitStmt:
00115           rc = <a class="code" href="class_dbj_run_time.html#r2">recordMgr</a>-&gt;<a class="code" href="class_dbj_record_manager.html#a7">commit</a>();
00116           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00117               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00118               <span class="keywordflow">goto</span> cleanup;
00119           }
00120           rc = <a class="code" href="class_dbj_run_time.html#r1">indexMgr</a>-&gt;<a class="code" href="class_dbj_index_manager.html#a9">commit</a>();
00121           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00122               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00123               <span class="keywordflow">goto</span> cleanup;
00124           }
00125           rc = <a class="code" href="class_dbj_run_time.html#r0">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a0">startTransaction</a>();
00126           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00127               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00128               <span class="keywordflow">goto</span> cleanup;
00129           }
00130           <span class="keywordflow">break</span>;
00131 
00132       <span class="keywordflow">case</span> DbjAccessPlan::RollbackStmt:
00133           rc = <a class="code" href="class_dbj_run_time.html#a3">executeRollback</a>();
00134           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00135               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00136               <span class="keywordflow">goto</span> cleanup;
00137           }
00138           <span class="keywordflow">break</span>;
00139 
00140       <span class="keywordflow">default</span>:
00141           <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00142           <span class="keywordflow">goto</span> cleanup;
00143     }
00144 
00145  cleanup:
00146     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();   
00147 }
00148 
00149 
00150 <span class="comment">// Lege neue Tabelle an</span>
<a name="l00151"></a><a class="code" href="class_dbj_run_time.html#d0">00151</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d0">DbjRunTime::executeCreateTable</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *accessPlan)
00152 {
00153     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00154     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *table = NULL;
00155     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *column = NULL;
00156     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *primaryKey = NULL;
00157     <a class="code" href="class_dbj_table.html">DbjTable</a> tableDesc;
00158     <span class="keyword">const</span> <span class="keywordtype">char</span> *tableName = NULL;
00159     <a class="code" href="group__tableid.html#ga1">TableId</a> tableId = DBJ_UNKNOWN_TABLE_ID;
00160     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> numColumns = 0;
00161 
00162     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00163 
00164     <span class="keywordflow">if</span> (!accessPlan ||
00165             accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::CreateTableStmt) {
00166         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00167         <span class="keywordflow">goto</span> cleanup;
00168     }
00169 
00170     <span class="comment">// Ermittle Namen der Tabelle</span>
00171     table = accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00172     <span class="keywordflow">if</span> (!table || table-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table ||
00173             table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
00174         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00175         <span class="keywordflow">goto</span> cleanup;
00176     }
00177     tableName = table-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>();
00178     <a class="code" href="group__trace__def.html#ga7">DBJ_TRACE_STRING</a>(10, tableName);
00179     rc = tableDesc.<a class="code" href="class_dbj_table.html#a18">setTableName</a>(tableName);
00180     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00181         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00182         <span class="keywordflow">goto</span> cleanup;
00183     }
00184 
00185     <span class="comment">// Zaehle Spalten</span>
00186     column = table-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00187     <span class="keywordflow">while</span> (column != NULL) {
00188         <span class="keywordflow">if</span> (numColumns == DBJ_MAX_UINT16) {
00189             <a class="code" href="_dbj_error_8hpp.html#a3">DBJ_SET_ERROR_TOKEN2</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a49">DBJ_RUNTIME_TOO_MANY_COLUMNS_IN_TABLE</a>,
00190                     tableName, numColumns);
00191             <span class="keywordflow">goto</span> cleanup;
00192         }
00193         <span class="keywordflow">if</span> (column-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Column ||
00194                 column-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
00195             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00196             <span class="keywordflow">goto</span> cleanup;
00197         }
00198         numColumns++;
00199         column = column-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00200     }
00201     <span class="keywordflow">if</span> (numColumns == 0) {
00202         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00203         <span class="keywordflow">goto</span> cleanup;
00204     }
00205     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(20, <span class="stringliteral">"Anzahl der Spalten"</span>, numColumns);
00206     rc = tableDesc.<a class="code" href="class_dbj_table.html#a20">createColumns</a>(numColumns);
00207     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00208         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00209         <span class="keywordflow">goto</span> cleanup;
00210     }
00211 
00212     <span class="comment">// Setze alle Spaltendefinitionen</span>
00213     column = table-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00214     <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> i = 0; i &lt; numColumns; i++, column = column-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()) {
00215         <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *type = column-&gt;getSon();
00216         <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> dataType = <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>;
00217         <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> maxLength = 0;
00218         <span class="keywordtype">bool</span> isNullable = <span class="keyword">true</span>;
00219 
00220         <span class="keywordflow">if</span> (!type || type-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::DataType ||
00221                 type-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
00222             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00223             <span class="keywordflow">goto</span> cleanup;
00224         }
00225         <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(type-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"INTEGER"</span>) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
00226             dataType = <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>;
00227             maxLength = <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>);
00228         }
00229         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(type-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"VARCHAR"</span>) ==
00230                 <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
00231             dataType = <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>;
00232             <span class="keywordflow">if</span> (type-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() == NULL) {
00233                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00234                 <span class="keywordflow">goto</span> cleanup;
00235             }
00236             <span class="keywordflow">if</span> (*type-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() &lt;= DBJ_MIN_UINT16 ||
00237                     *type-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() &gt; DBJ_MAX_UINT16) {
00238                 <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a50">DBJ_RUNTIME_COLUMN_TOO_LONG</a>,
00239                         *type-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>(), i, DBJ_MAX_UINT16);
00240                 <span class="keywordflow">goto</span> cleanup;
00241             }
00242             maxLength = *type-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>();
00243         }
00244         <span class="keywordflow">else</span> {
00245             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00246             <span class="keywordflow">goto</span> cleanup;
00247         }
00248         <span class="keywordflow">if</span> (type-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>() == NULL) {
00249             isNullable = <span class="keyword">true</span>;
00250         }
00251         <span class="keywordflow">else</span> {
00252             <span class="keywordflow">if</span> (type-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::NotNullOption) {
00253                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00254                 <span class="keywordflow">goto</span> cleanup;
00255             }
00256             isNullable = <span class="keyword">false</span>;
00257         }
00258 
00259         <span class="comment">// setze Spaltendefinition</span>
00260         rc = tableDesc.<a class="code" href="class_dbj_table.html#a21">setColumnDefinition</a>(i, column-&gt;getStringData(),
00261                 dataType, maxLength, isNullable);
00262         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00263             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00264             <span class="keywordflow">goto</span> cleanup;
00265         }
00266     }
00267 
00268     <span class="comment">// Erzeuge Tabelle und lege Segment an</span>
00269     rc = <a class="code" href="class_dbj_run_time.html#r0">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a5">addTable</a>(tableDesc, tableId);
00270     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00271         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00272         <span class="keywordflow">goto</span> cleanup;
00273     }
00274     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(50, <span class="stringliteral">"Table ID"</span>, tableId);
00275     rc = <a class="code" href="class_dbj_run_time.html#r2">recordMgr</a>-&gt;<a class="code" href="class_dbj_record_manager.html#a0">createTable</a>(tableId);
00276     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00277         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00278         <span class="keywordflow">goto</span> cleanup;
00279     }
00280 
00281     <span class="comment">// pruefe, ob Primaerschluessel definiert wurde; wenn nicht, dann sind wir</span>
00282     <span class="comment">// hier fertig</span>
00283     <span class="keywordflow">if</span> (table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>() == NULL) {
00284         <span class="keywordflow">goto</span> cleanup;
00285     }
00286     primaryKey = table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00287 
00288     <span class="comment">// Lege noch den Index fuer den Primaerschluessel an</span>
00289     <span class="keywordflow">if</span> (primaryKey-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Column ||
00290             primaryKey-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
00291         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00292         <span class="keywordflow">goto</span> cleanup;
00293     }
00294     {
00295         <a class="code" href="class_dbj_index.html">DbjIndex</a> indexDesc;
00296         <a class="code" href="group__tableid.html#ga5">IndexId</a> indexId = DBJ_UNKNOWN_INDEX_ID;
00297         <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> idxDataType = <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>;
00298 
00299         <span class="comment">// Konstruiere Indexnamen</span>
00300         {
00301             <span class="keywordtype">char</span> idxName[DBJ_MAX_INDEX_NAME_LENGTH+1] = { <span class="charliteral">'\0'</span> };
00302             <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> idxNameLength = <a class="code" href="group__system__macros.html#ga0">DbjMin</a>(strlen(tableName),
00303                     <span class="keyword">sizeof</span>(idxName) - 1);
00304             <span class="keywordflow">if</span> (idxNameLength + 3 &gt; DBJ_MAX_INDEX_NAME_LENGTH) {
00305                 idxNameLength = DBJ_MAX_INDEX_NAME_LENGTH - 3;
00306             }
00307             <a class="code" href="group__memory__functions.html#ga5">DbjMemCopy</a>(idxName, tableName, idxNameLength);
00308             <a class="code" href="group__memory__functions.html#ga5">DbjMemCopy</a>(idxName + idxNameLength, <span class="stringliteral">"_PK"</span>, 3);
00309             idxNameLength += 3;
00310             idxName[idxNameLength] = <span class="charliteral">'\0'</span>;
00311             rc = indexDesc.<a class="code" href="class_dbj_index.html#a7">setIndexName</a>(idxName, idxNameLength);
00312             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00313                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00314                 <span class="keywordflow">goto</span> cleanup;
00315             }
00316         }
00317 
00318         <span class="comment">// Ermittle Nummer und Datentyp der Spalte auf der der Index definiert</span>
00319         <span class="comment">// ist</span>
00320         {
00321             <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> idxColumn = 0;
00322             rc = tableDesc.<a class="code" href="class_dbj_table.html#a9">getColumnNumber</a>(primaryKey-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
00323                     idxColumn);
00324             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00325                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00326                 <span class="keywordflow">goto</span> cleanup;
00327             }
00328             rc = tableDesc.<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(idxColumn, idxDataType);
00329             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00330                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00331                 <span class="keywordflow">goto</span> cleanup;
00332             }
00333             rc = indexDesc.<a class="code" href="class_dbj_index.html#a11">setColumnNumber</a>(idxColumn);
00334             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00335                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00336                 <span class="keywordflow">goto</span> cleanup;
00337             }
00338         }
00339 
00340         <span class="comment">// Setze verbleibende Index-Attribute</span>
00341         rc = indexDesc.<a class="code" href="class_dbj_index.html#a9">setIndexType</a>(<a class="code" href="group__datatypes.html#gga1a35">BTree</a>);
00342         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00343             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00344             <span class="keywordflow">goto</span> cleanup;
00345         }
00346         rc = indexDesc.<a class="code" href="class_dbj_index.html#a10">setTableId</a>(tableId);
00347         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00348             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00349             <span class="keywordflow">goto</span> cleanup;
00350         }
00351         rc = indexDesc.<a class="code" href="class_dbj_index.html#a12">setUnique</a>(<span class="keyword">true</span>);
00352         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00353             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00354             <span class="keywordflow">goto</span> cleanup;
00355         }
00356 
00357         <span class="comment">// Erzeuge Index und dessen Segment</span>
00358         rc = <a class="code" href="class_dbj_run_time.html#r0">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a7">addIndex</a>(indexDesc, indexId);
00359         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00360             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00361             <span class="keywordflow">goto</span> cleanup;
00362         }
00363         rc = <a class="code" href="class_dbj_run_time.html#r1">indexMgr</a>-&gt;<a class="code" href="class_dbj_index_manager.html#a0">createIndex</a>(indexId, <span class="keyword">true</span>, <a class="code" href="group__datatypes.html#gga1a35">BTree</a>, idxDataType);
00364         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00365             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00366             <span class="keywordflow">goto</span> cleanup;
00367         }
00368     }
00369 
00370  cleanup:
00371     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00372 }
00373 
00374 <span class="comment">// Loesche Tabelle</span>
<a name="l00375"></a><a class="code" href="class_dbj_run_time.html#d1">00375</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d1">DbjRunTime::executeDropTable</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *accessPlan)
00376 {
00377     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00378     <a class="code" href="group__tableid.html#ga1">TableId</a> tableId = DBJ_UNKNOWN_TABLE_ID;
00379     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *table = NULL;
00380     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *index = NULL;
00381 
00382     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00383 
00384     <span class="keywordflow">if</span> (!accessPlan ||
00385             accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::DropTableStmt) {
00386         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00387         <span class="keywordflow">goto</span> cleanup;
00388     }
00389     table = accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00390     <span class="keywordflow">if</span> (!table || table-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table ||
00391             table-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() == NULL) {
00392         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00393         <span class="keywordflow">goto</span> cleanup;
00394     }
00395     tableId = *table-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>();
00396     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(10, <span class="stringliteral">"Table ID"</span>, tableId);
00397 
00398     <span class="comment">// Loesche Segment der Tabelle und Tabelle aus dem Katalog</span>
00399     rc = <a class="code" href="class_dbj_run_time.html#r2">recordMgr</a>-&gt;<a class="code" href="class_dbj_record_manager.html#a1">dropTable</a>(tableId);
00400     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00401         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00402         <span class="keywordflow">goto</span> cleanup;
00403     }
00404     rc = <a class="code" href="class_dbj_run_time.html#r0">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a6">removeTable</a>(tableId);
00405     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00406         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00407         <span class="keywordflow">goto</span> cleanup;
00408     }
00409 
00410     <span class="comment">// Loesche alle Index-Segmente und Indexe</span>
00411     index = table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00412     <span class="keywordflow">while</span> (index != NULL) {
00413         <a class="code" href="group__tableid.html#ga5">IndexId</a> indexId = DBJ_UNKNOWN_INDEX_ID;
00414 
00415         <span class="keywordflow">if</span> (index-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Index ||
00416                 index-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() == NULL) {
00417             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00418             <span class="keywordflow">goto</span> cleanup;
00419         }
00420         indexId = *index-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>();
00421         <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(20, <span class="stringliteral">"Index ID"</span>, indexId);
00422 
00423         rc = <a class="code" href="class_dbj_run_time.html#r1">indexMgr</a>-&gt;<a class="code" href="class_dbj_index_manager.html#a1">dropIndex</a>(indexId);
00424         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00425             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00426             <span class="keywordflow">goto</span> cleanup;
00427         }
00428         rc = <a class="code" href="class_dbj_run_time.html#r0">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a8">removeIndex</a>(indexId);
00429         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00430             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00431             <span class="keywordflow">goto</span> cleanup;
00432         }
00433 
00434         <span class="comment">// naechsten Index loeschen</span>
00435         index = index-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00436     }
00437 
00438  cleanup:
00439     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00440 }
00441 
00442 
00443 <span class="comment">// Lege neuen Index an</span>
<a name="l00444"></a><a class="code" href="class_dbj_run_time.html#d2">00444</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d2">DbjRunTime::executeCreateIndex</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *accessPlan)
00445 {
00446     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00447     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *node = NULL;
00448     <a class="code" href="class_dbj_index.html">DbjIndex</a> indexDesc;
00449     <a class="code" href="group__tableid.html#ga5">IndexId</a> indexId = DBJ_UNKNOWN_INDEX_ID;
00450     <span class="keywordtype">bool</span> unique = <span class="keyword">true</span>;
00451     <a class="code" href="group__datatypes.html#ga1">DbjIndexType</a> indexType = <a class="code" href="group__datatypes.html#gga1a37">UnknownIndexType</a>;
00452     <a class="code" href="group__tableid.html#ga1">TableId</a> tableId = DBJ_UNKNOWN_TABLE_ID;
00453     <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
00454     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnId = 0;
00455     <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> dataType = <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>;
00456     <a class="code" href="class_dbj_record_iterator.html">DbjRecordIterator</a> *recordIter = NULL;
00457     <a class="code" href="class_dbj_tuple.html">DbjTuple</a> *tuple = NULL;
00458 
00459     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00460 
00461     <span class="keywordflow">if</span> (!accessPlan ||
00462             accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::CreateIndexStmt) {
00463         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00464         <span class="keywordflow">goto</span> cleanup;
00465     }
00466 
00467     <span class="comment">// ermittle Namen des Index und Unique-Information</span>
00468     node = accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00469     <span class="keywordflow">if</span> (!node || (node-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Index &amp;&amp;
00470                 node-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::UniqueIndex) ||
00471             node-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
00472         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00473         <span class="keywordflow">goto</span> cleanup;
00474     }
00475     rc = indexDesc.<a class="code" href="class_dbj_index.html#a7">setIndexName</a>(node-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
00476     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00477         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00478         <span class="keywordflow">goto</span> cleanup;
00479     }
00480     unique = node-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() == DbjAccessPlan::UniqueIndex ? <span class="keyword">true</span> : <span class="keyword">false</span>;
00481     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(10, <span class="stringliteral">"Unique"</span>, unique);
00482     rc = indexDesc.<a class="code" href="class_dbj_index.html#a12">setUnique</a>(unique);
00483     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00484         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00485         <span class="keywordflow">goto</span> cleanup;
00486     }
00487 
00488     <span class="comment">// ermittle und setze Tabellen-ID</span>
00489     node = node-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00490     <span class="keywordflow">if</span> (!node || node-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table ||
00491             node-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() == NULL) {
00492         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00493         <span class="keywordflow">goto</span> cleanup;
00494     }
00495     tableId = *node-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>();
00496     tableDesc = reinterpret_cast&lt;const DbjAccessPlanTable *&gt;(node)-&gt;
00497         getTableDescriptor();
00498     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(20, <span class="stringliteral">"Table ID"</span>, tableId);
00499     rc = indexDesc.<a class="code" href="class_dbj_index.html#a10">setTableId</a>(tableId);
00500     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00501         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00502         <span class="keywordflow">goto</span> cleanup;
00503     }
00504 
00505     <span class="comment">// ermittle und setze Spaltennummer</span>
00506     node = node-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00507     <span class="keywordflow">if</span> (!node || node-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Column ||
00508             node-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() == NULL) {
00509         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00510         <span class="keywordflow">goto</span> cleanup;
00511     }
00512     columnId = *node-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>();
00513     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(30, <span class="stringliteral">"Column ID"</span>, columnId);
00514     rc = indexDesc.<a class="code" href="class_dbj_index.html#a11">setColumnNumber</a>(columnId);
00515     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00516         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00517         <span class="keywordflow">goto</span> cleanup;
00518     }
00519 
00520     <span class="comment">// ermittle und Setze Indextyp</span>
00521     node = node-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00522     <span class="keywordflow">if</span> (!node || node-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::IndexType ||
00523             node-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
00524         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00525         <span class="keywordflow">goto</span> cleanup;
00526     }
00527     <a class="code" href="group__trace__def.html#ga7">DBJ_TRACE_STRING</a>(40, node-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
00528     <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(node-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"BTREE"</span>) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
00529         indexType = <a class="code" href="group__datatypes.html#gga1a35">BTree</a>;
00530     }
00531     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(node-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"HASH"</span>) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
00532         indexType = <a class="code" href="group__datatypes.html#gga1a36">Hash</a>;
00533     }
00534     <span class="keywordflow">else</span> {
00535         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00536         <span class="keywordflow">goto</span> cleanup;
00537     }
00538     rc = indexDesc.<a class="code" href="class_dbj_index.html#a9">setIndexType</a>(<a class="code" href="group__datatypes.html#gga1a35">BTree</a>);
00539     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00540         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00541         <span class="keywordflow">goto</span> cleanup;
00542     }
00543 
00544     <span class="comment">// Jetzt ist der Deskriptor komplett, und wir koennen das Segment anlegen</span>
00545     <span class="comment">// und den Index in den Katalog eintragen</span>
00546     rc = <a class="code" href="class_dbj_run_time.html#r0">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a7">addIndex</a>(indexDesc, indexId);
00547     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00548         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00549         <span class="keywordflow">goto</span> cleanup;
00550     }
00551     rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(columnId, dataType);
00552     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00553         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00554         <span class="keywordflow">goto</span> cleanup;
00555     }
00556     rc = <a class="code" href="class_dbj_run_time.html#r1">indexMgr</a>-&gt;<a class="code" href="class_dbj_index_manager.html#a0">createIndex</a>(indexId, unique, indexType, dataType);
00557     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00558         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00559         <span class="keywordflow">goto</span> cleanup;
00560     }
00561 
00562     <span class="comment">/*</span>
00563 <span class="comment">     * Nun indexieren wir alle Tupel der Tabelle</span>
00564 <span class="comment">     */</span>
00565     rc = <a class="code" href="class_dbj_run_time.html#r2">recordMgr</a>-&gt;<a class="code" href="class_dbj_record_manager.html#a6">getRecordIterator</a>(tableId, recordIter);
00566     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00567         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00568         <span class="keywordflow">goto</span> cleanup;
00569     }
00570     {
00571         <span class="keyword">const</span> <a class="code" href="struct_tuple_id.html">TupleId</a> *tid = NULL;
00572         <a class="code" href="class_dbj_index_key.html">DbjIndexKey</a> idxKey;
00573         <a class="code" href="class_dbj_record_tuple_iterator.html">DbjRecordTupleIterator</a> iter(*recordIter, tableDesc);
00574         <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00575             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00576             <span class="keywordflow">goto</span> cleanup;
00577         }
00578         recordIter = NULL; <span class="comment">// "iter" uebernimmt Kontrolle des Objekts</span>
00579         idxKey.<a class="code" href="class_dbj_index_key.html#o0">dataType</a> = dataType;
00580 
00581         <span class="comment">// Table-Scan und einfuegen der Werte in den Index</span>
00582         <span class="keywordflow">while</span> (iter.<a class="code" href="class_dbj_record_tuple_iterator.html#a4">hasNext</a>()) {
00583             rc = iter.<a class="code" href="class_dbj_record_tuple_iterator.html#a2">getNextTuple</a>(tuple);
00584             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00585                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00586                 <span class="keywordflow">goto</span> cleanup;
00587             }
00588 
00589             tid = tuple-&gt;<a class="code" href="class_dbj_tuple.html#a7">getTupleId</a>();
00590             <span class="keywordflow">if</span> (!tid) {
00591                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00592                 <span class="keywordflow">goto</span> cleanup;
00593             }
00594 
00595             rc = <a class="code" href="class_dbj_run_time.html#d6">insertIntoIndex</a>(tuple, *tid, indexDesc, idxKey);
00596             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00597                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00598                 <span class="keywordflow">goto</span> cleanup;
00599             }
00600         }
00601     }
00602 
00603  cleanup:
00604     <span class="keyword">delete</span> recordIter;
00605     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00606 }
00607 
00608 
00609 <span class="comment">// Loesche Index</span>
<a name="l00610"></a><a class="code" href="class_dbj_run_time.html#d3">00610</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d3">DbjRunTime::executeDropIndex</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *accessPlan)
00611 {
00612     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00613     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *index = NULL;
00614     <a class="code" href="group__tableid.html#ga5">IndexId</a> indexId = DBJ_UNKNOWN_INDEX_ID;
00615 
00616     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00617 
00618     <span class="keywordflow">if</span> (!accessPlan ||
00619             accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::DropIndexStmt) {
00620         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00621         <span class="keywordflow">goto</span> cleanup;
00622     }
00623 
00624     index = accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00625     <span class="keywordflow">if</span> (!index || index-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Index ||
00626             index-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() == NULL) {
00627         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00628         <span class="keywordflow">goto</span> cleanup;
00629     }
00630     indexId = *index-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>();
00631     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(10, <span class="stringliteral">"Index ID"</span>, indexId);
00632 
00633     <span class="comment">// Loesche Index-Segment und Eintrag im Katalog</span>
00634     rc = <a class="code" href="class_dbj_run_time.html#r1">indexMgr</a>-&gt;<a class="code" href="class_dbj_index_manager.html#a1">dropIndex</a>(indexId);
00635     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00636         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00637         <span class="keywordflow">goto</span> cleanup;
00638     }
00639     rc = <a class="code" href="class_dbj_run_time.html#r0">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a8">removeIndex</a>(indexId);
00640     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00641         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00642         <span class="keywordflow">goto</span> cleanup;
00643     }
00644 
00645  cleanup:
00646     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00647 }
00648 
00649 <span class="comment">// Fuege ein oder mehrere Tupel in Tabelle ein</span>
<a name="l00650"></a><a class="code" href="class_dbj_run_time.html#d4">00650</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d4">DbjRunTime::executeInsert</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *accessPlan)
00651 {
00652     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00653     <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
00654     <a class="code" href="group__tableid.html#ga1">TableId</a> tableId = DBJ_UNKNOWN_TABLE_ID;
00655     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *table = NULL;
00656     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *row = NULL;
00657     <a class="code" href="group__int__datatypes.html#ga12">Sint32</a> numRows = 0;
00658 
00659     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00660 
00661     <span class="keywordflow">if</span> (!accessPlan || accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::InsertStmt) {
00662         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00663         <span class="keywordflow">goto</span> cleanup;
00664     }
00665     table = accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00666     <span class="keywordflow">if</span> (!table || table-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Sources) {
00667         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00668         <span class="keywordflow">goto</span> cleanup;
00669     }
00670     row = table-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00671     table = table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00672     <span class="keywordflow">if</span> (!table || table-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table ||
00673             table-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() == NULL) {
00674         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00675         <span class="keywordflow">goto</span> cleanup;
00676     }
00677     tableId = *table-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>();
00678     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(10, <span class="stringliteral">"Table ID"</span>, tableId);
00679     tableDesc = reinterpret_cast&lt;const DbjAccessPlanTable *&gt;(table)-&gt;
00680         getTableDescriptor();
00681     <span class="keywordflow">if</span> (!tableDesc) {
00682         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00683         <span class="keywordflow">goto</span> cleanup;
00684     }
00685 
00686     <span class="comment">// oeffne alle Indexe</span>
00687     rc = <a class="code" href="class_dbj_run_time.html#d14">openIndexes</a>(table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>(), tableDesc);
00688     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00689         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00690         <span class="keywordflow">goto</span> cleanup;
00691     }
00692 
00693     {
00694         <a class="code" href="class_dbj_record_tuple.html">DbjRecordTuple</a> recTuple(tableDesc);
00695         <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> numColumns = 0;
00696         <a class="code" href="struct_tuple_id.html">TupleId</a> tupleId;
00697         <span class="keywordflow">if</span> (!recTuple) {
00698             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00699             <span class="keywordflow">goto</span> cleanup;
00700         }
00701 
00702         rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a5">getNumColumns</a>(numColumns);
00703         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00704             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00705             <span class="keywordflow">goto</span> cleanup;
00706         }
00707 
00708         <span class="comment">// Fuege alle Zeilen ein</span>
00709         <span class="keywordflow">while</span> (row != NULL) {
00710             <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *value = row-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00711 
00712             <span class="comment">// Setze einzelne Attributwerte in Tupel</span>
00713             <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> i = 0; i &lt; numColumns; i++, value = value-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()) {
00714                 <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> dataType = <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>;
00715                 rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(i, dataType);
00716                 <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00717                     <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00718                     <span class="keywordflow">goto</span> cleanup;
00719                 }
00720                 <span class="keywordflow">switch</span> (dataType) {
00721                   <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>:
00722                       rc = recTuple.<a class="code" href="class_dbj_record_tuple.html#a13">setInt</a>(i, value-&gt;getIntData());
00723                       <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00724                           <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00725                           <span class="keywordflow">goto</span> cleanup;
00726                       }
00727                       <span class="keywordflow">break</span>;
00728 
00729                   <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>:
00730                       {
00731                           <span class="keyword">const</span> <span class="keywordtype">char</span> *str = value-&gt;getStringData();
00732                           <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> strLength = 0;
00733                           <span class="keywordflow">if</span> (str != NULL) {
00734                               strLength = strlen(str);
00735                           }
00736                           rc = recTuple.<a class="code" href="class_dbj_record_tuple.html#a12">setVarchar</a>(i, str, strLength);
00737                           <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00738                               <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00739                               <span class="keywordflow">goto</span> cleanup;
00740                           }
00741                       }
00742                       <span class="keywordflow">break</span>;
00743 
00744                   <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>:
00745                       <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00746                       <span class="keywordflow">goto</span> cleanup;
00747                 }
00748             }
00749 
00750             <span class="comment">// fuege komplettes Tupel in Tabelle ein</span>
00751             <span class="keywordflow">if</span> (recTuple.<a class="code" href="class_dbj_record_tuple.html#a11">getRecord</a>() == NULL) {
00752                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00753                 <span class="keywordflow">goto</span> cleanup;
00754             }
00755             rc = <a class="code" href="class_dbj_run_time.html#r2">recordMgr</a>-&gt;<a class="code" href="class_dbj_record_manager.html#a2">insert</a>(*recTuple.<a class="code" href="class_dbj_record_tuple.html#a11">getRecord</a>(), tableId, tupleId);
00756             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00757                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00758                 <span class="keywordflow">goto</span> cleanup;
00759             }
00760             numRows++;
00761 
00762             <span class="comment">// Pflege alle Indexe</span>
00763             rc = <a class="code" href="class_dbj_run_time.html#d5">insertIntoIndexes</a>(*tableDesc, recTuple, tupleId,
00764                     table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>());
00765             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00766                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00767                 <span class="keywordflow">goto</span> cleanup;
00768             }
00769 
00770             <span class="comment">// naechste Zeile</span>
00771             row = row-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00772         }
00773     }
00774 
00775     rc = <a class="code" href="class_dbj_run_time.html#r0">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a9">updateTupleCount</a>(tableId, numRows);
00776     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00777         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00778         <span class="keywordflow">goto</span> cleanup;
00779     }
00780 
00781  cleanup:
00782     <span class="comment">// "tableDesc" wird vom DbjAccessPlanTable kontrolliert</span>
00783     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00784 }
00785 
00786 <span class="comment">// Pflege Indexe fuer gegebenes Record</span>
<a name="l00787"></a><a class="code" href="class_dbj_run_time.html#d5">00787</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d5">DbjRunTime::insertIntoIndexes</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_table.html">DbjTable</a> &amp;tableDesc,
00788         <span class="keyword">const</span> <a class="code" href="class_dbj_record_tuple.html">DbjRecordTuple</a> &amp;recTuple, <span class="keyword">const</span> <a class="code" href="struct_tuple_id.html">TupleId</a> tupleId,
00789         <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *indexList)
00790 {
00791     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00792     <a class="code" href="class_dbj_index_key.html">DbjIndexKey</a> idxKey; <span class="comment">// wird wiederverwendet</span>
00793 
00794     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00795 
00796     <span class="comment">// bearbeite alle angegebenen Indexe</span>
00797     <span class="keywordflow">while</span> (indexList != NULL) {
00798         <a class="code" href="class_dbj_index.html">DbjIndex</a> *indexDesc = NULL;
00799 
00800         <span class="keywordflow">if</span> (indexList-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Index) {
00801             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00802             <span class="keywordflow">goto</span> cleanup;
00803         }
00804         indexDesc = reinterpret_cast&lt;const DbjAccessPlanIndex *&gt;(indexList)-&gt;
00805             getIndexDescriptor();
00806         <span class="keywordflow">if</span> (!indexDesc) {
00807             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00808             <span class="keywordflow">goto</span> cleanup;
00809         }
00810 
00811         <span class="comment">// Bestimme Datentyp der zu indizierenden Werte</span>
00812         {
00813             <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnId = 0;
00814             rc = indexDesc-&gt;<a class="code" href="class_dbj_index.html#a5">getColumnNumber</a>(columnId);
00815             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00816                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00817                 <span class="keywordflow">goto</span> cleanup;
00818             }
00819             rc = tableDesc.<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(columnId, idxKey.<a class="code" href="class_dbj_index_key.html#o0">dataType</a>);
00820             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00821                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00822                 <span class="keywordflow">goto</span> cleanup;
00823             }
00824         }
00825 
00826         rc = <a class="code" href="class_dbj_run_time.html#d6">insertIntoIndex</a>(&amp;recTuple, tupleId, *indexDesc, idxKey);
00827         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00828             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00829             <span class="keywordflow">goto</span> cleanup;
00830         }
00831 
00832         indexList = indexList-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00833     }
00834 
00835  cleanup:
00836     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00837 }
00838 
00839 
00840 <span class="comment">// Fuege Schluessel/TID in Index ein</span>
<a name="l00841"></a><a class="code" href="class_dbj_run_time.html#d6">00841</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d6">DbjRunTime::insertIntoIndex</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_tuple.html">DbjTuple</a> *tuple,
00842         <span class="keyword">const</span> <a class="code" href="struct_tuple_id.html">TupleId</a> tupleId, <span class="keyword">const</span> <a class="code" href="class_dbj_index.html">DbjIndex</a> &amp;indexDesc, <a class="code" href="class_dbj_index_key.html">DbjIndexKey</a> &amp;idxKey)
00843 {
00844     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00845     <a class="code" href="group__tableid.html#ga5">IndexId</a> indexId = DBJ_UNKNOWN_INDEX_ID;
00846     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnId = 0;
00847 
00848     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00849 
00850     <span class="keywordflow">if</span> (!tuple) {
00851         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00852         <span class="keywordflow">goto</span> cleanup;
00853     }
00854 
00855     rc = indexDesc.<a class="code" href="class_dbj_index.html#a1">getIndexId</a>(indexId);
00856     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00857         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00858         <span class="keywordflow">goto</span> cleanup;
00859     }
00860     rc = indexDesc.<a class="code" href="class_dbj_index.html#a5">getColumnNumber</a>(columnId);
00861     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00862         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00863         <span class="keywordflow">goto</span> cleanup;
00864     }
00865 
00866     <span class="comment">// Baue Schluesselwert fuer den Index zusammen</span>
00867     <span class="keywordflow">switch</span> (idxKey.<a class="code" href="class_dbj_index_key.html#o0">dataType</a>) {
00868       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>:
00869           {
00870               <span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga12">Sint32</a> *intValue = NULL;
00871               rc = tuple-&gt;<a class="code" href="class_dbj_tuple.html#a2">getInt</a>(columnId, intValue);
00872               <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00873                   <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00874                   <span class="keywordflow">goto</span> cleanup;
00875               }
00876               <span class="comment">// ignoriere NULL-Werte</span>
00877               <span class="keywordflow">if</span> (intValue == NULL) {
00878                   <span class="keywordflow">goto</span> cleanup;
00879               }
00880               idxKey.<a class="code" href="class_dbj_index_key.html#o1">intKey</a> = *intValue;
00881           }
00882           <span class="keywordflow">break</span>;
00883 
00884       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>:
00885           {
00886               <span class="keyword">const</span> <span class="keywordtype">char</span> *vcValue = NULL;
00887               <span class="keywordtype">char</span> vcData[DBJ_INDEX_VARCHAR_LENGTH+1];
00888               <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> vcLength = 0;
00889               rc = tuple-&gt;<a class="code" href="class_dbj_tuple.html#a1">getVarchar</a>(columnId, vcValue, vcLength);
00890               <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00891                   <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00892                   <span class="keywordflow">goto</span> cleanup;
00893               }
00894               <span class="comment">// ignoriere NULL-Werte</span>
00895               <span class="keywordflow">if</span> (vcValue == NULL) {
00896                   <span class="keywordflow">goto</span> cleanup;
00897               }
00898               <span class="keywordflow">if</span> (vcLength &gt;= <span class="keyword">sizeof</span> vcData) {
00899                   vcLength = <span class="keyword">sizeof</span>(vcData)-1;
00900               }
00901               <a class="code" href="group__memory__functions.html#ga5">DbjMemCopy</a>(vcData, vcValue, vcLength);
00902               vcData[vcLength] = <span class="charliteral">'\0'</span>;
00903               idxKey.<a class="code" href="class_dbj_index_key.html#o2">varcharKey</a> = vcData;
00904           }
00905           <span class="keywordflow">break</span>;
00906 
00907       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>:
00908           <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00909           <span class="keywordflow">goto</span> cleanup;
00910     }
00911 
00912     <span class="comment">// Jetzt koennen wir das Tupel indizieren</span>
00913     rc = <a class="code" href="class_dbj_run_time.html#r1">indexMgr</a>-&gt;<a class="code" href="class_dbj_index_manager.html#a7">insert</a>(indexId, idxKey, tupleId);
00914     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00915         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00916         <span class="keywordflow">goto</span> cleanup;
00917     }
00918 
00919  cleanup:
00920     idxKey.<a class="code" href="class_dbj_index_key.html#o2">varcharKey</a> = NULL;
00921     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00922 }
00923 
00924 
00925 <span class="comment">// Fuehre DELETE-Anweisung aus</span>
<a name="l00926"></a><a class="code" href="class_dbj_run_time.html#d7">00926</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d7">DbjRunTime::executeDelete</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *accessPlan)
00927 {
00928     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00929     <a class="code" href="group__tableid.html#ga1">TableId</a> tableId = DBJ_UNKNOWN_TABLE_ID;
00930     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *table = NULL;
00931     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *indexList = NULL;
00932     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *whereClause = NULL;
00933     <a class="code" href="class_dbj_tuple_iterator.html">DbjTupleIterator</a> *currentIter = NULL;
00934     <a class="code" href="group__int__datatypes.html#ga12">Sint32</a> numRows = 0;
00935 
00936     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00937 
00938     <span class="keywordflow">if</span> (!accessPlan ||
00939             accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::DeleteStmt) {
00940         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00941         <span class="keywordflow">goto</span> cleanup;
00942     }
00943     table = accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00944     <span class="keywordflow">if</span> (!table || table-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Sources ||
00945             table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>() == NULL) {
00946         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00947         <span class="keywordflow">goto</span> cleanup;
00948     }
00949     whereClause = table-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
00950     <span class="keywordflow">if</span> (whereClause &amp;&amp;
00951             whereClause-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::WhereClause) {
00952         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00953         <span class="keywordflow">goto</span> cleanup;
00954     }
00955     table = table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00956     <span class="keywordflow">if</span> (table-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table ||
00957             table-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() == NULL ||
00958             *table-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() &lt; DBJ_MIN_TABLE_ID ||
00959             *table-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() &gt; DBJ_MAX_TABLE_ID) {
00960         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00961         <span class="keywordflow">goto</span> cleanup;
00962     }
00963     tableId = *table-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>();
00964     indexList = table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
00965 
00966     <span class="comment">// oeffne alle Indexe</span>
00967     {
00968         <span class="keyword">const</span> <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = reinterpret_cast&lt;const DbjAccessPlanTable *&gt;(
00969                 table)-&gt;getTableDescriptor();
00970         rc = <a class="code" href="class_dbj_run_time.html#d14">openIndexes</a>(indexList, tableDesc);
00971         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00972             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00973             <span class="keywordflow">goto</span> cleanup;
00974         }
00975     }
00976 
00977     <span class="comment">/*</span>
00978 <span class="comment">     * (1) existiert ein Index-Scan, so wird ein DbjIndexTupelIterator</span>
00979 <span class="comment">     *     gebildet; andernfalls kommt ein DbjRecordTupelIterator zum Einsatz</span>
00980 <span class="comment">     * (2) existieren Tabellen-spezifische Praedikate, so wird das Ergebnis</span>
00981 <span class="comment">     *     aus (1) mittels eines DbjSelectionTupleIterators gefiltert.</span>
00982 <span class="comment">     */</span>
00983     rc = <a class="code" href="class_dbj_run_time.html#d11">getTableIterator</a>(table, currentIter);
00984     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00985         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00986         <span class="keywordflow">goto</span> cleanup;
00987     }
00988 
00989     <span class="keywordflow">if</span> (whereClause != NULL) {
00990         <a class="code" href="struct_dbj_selector.html">DbjSelector</a> *filter = NULL;
00991         <a class="code" href="class_dbj_tuple_iterator.html">DbjTupleIterator</a> *filterIter = NULL;
00992 
00993         filter = <span class="keyword">new</span> <a class="code" href="struct_dbj_selector.html">DbjSelector</a>();
00994         <span class="keywordflow">if</span> (!filter) {
00995             <span class="keywordflow">goto</span> cleanup;
00996         }
00997         rc = <a class="code" href="class_dbj_run_time.html#d12">buildSelector</a>(whereClause-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>(), *filter);
00998         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00999             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01000             <span class="keywordflow">goto</span> cleanup;
01001         }
01002 
01003         filterIter = <span class="keyword">new</span> <a class="code" href="class_dbj_selection_tuple_iterator.html">DbjSelectionTupleIterator</a>(*currentIter, *filter);
01004         <span class="keywordflow">if</span> (!filterIter) {
01005             <span class="keywordflow">goto</span> cleanup;
01006         }
01007         <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01008             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01009             <span class="keywordflow">goto</span> cleanup;
01010         }
01011         currentIter = filterIter;
01012     }
01013 
01014     <span class="comment">// Jetzt holen wir alle Tupel ueber den Iterator und loeschen</span>
01015     <span class="comment">// anschliessend alle entsprechenden Tupel aus den einzelnen Indexen</span>
01016     <span class="keywordflow">while</span> (currentIter-&gt;<a class="code" href="class_dbj_iterator.html#a1">hasNext</a>()) {
01017         <a class="code" href="class_dbj_tuple.html">DbjTuple</a> *tuple = NULL;
01018         <a class="code" href="struct_tuple_id.html">TupleId</a> tupleId;
01019 
01020         rc = currentIter-&gt;<a class="code" href="class_dbj_tuple_iterator.html#a1">getNextTuple</a>(tuple);
01021         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01022             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01023             <span class="keywordflow">goto</span> cleanup;
01024         }
01025         <span class="keywordflow">if</span> (tuple-&gt;<a class="code" href="class_dbj_tuple.html#a7">getTupleId</a>() == NULL) {
01026             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01027             <span class="keywordflow">goto</span> cleanup;
01028         }
01029         tupleId = *tuple-&gt;<a class="code" href="class_dbj_tuple.html#a7">getTupleId</a>();
01030 
01031         <span class="comment">// entferne alle Indexeintraege</span>
01032         rc = <a class="code" href="class_dbj_run_time.html#d8">deleteFromIndexes</a>(indexList, tuple, tupleId);
01033         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01034             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01035             <span class="keywordflow">goto</span> cleanup;
01036         }
01037 
01038         <span class="comment">// entferne Tupel aus der Tabelle</span>
01039         rc = <a class="code" href="class_dbj_run_time.html#r2">recordMgr</a>-&gt;<a class="code" href="class_dbj_record_manager.html#a3">remove</a>(tableId, tupleId);
01040         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01041             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01042             <span class="keywordflow">goto</span> cleanup;
01043         }
01044         numRows++;
01045     }
01046 
01047     rc = <a class="code" href="class_dbj_run_time.html#r0">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a9">updateTupleCount</a>(tableId, -numRows);
01048     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01049         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01050         <span class="keywordflow">goto</span> cleanup;
01051     }
01052 
01053  cleanup:
01054     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();                       
01055 }
01056 
01057 
01058 <span class="comment">// Loesche Index-Eintrag</span>
<a name="l01059"></a><a class="code" href="class_dbj_run_time.html#d8">01059</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d8">DbjRunTime::deleteFromIndexes</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *indexList,
01060         <a class="code" href="class_dbj_tuple.html">DbjTuple</a> *tuple, <span class="keyword">const</span> <a class="code" href="struct_tuple_id.html">TupleId</a> &amp;tupleId)
01061 {
01062     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01063     <a class="code" href="class_dbj_index_key.html">DbjIndexKey</a> idxKey; <span class="comment">// wird wiederverwendet</span>
01064 
01065     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01066 
01067     <span class="keywordflow">if</span> (!tuple) {
01068         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
01069         <span class="keywordflow">goto</span> cleanup;
01070     }
01071 
01072     <span class="comment">// bearbeite alle angegebenen Indexe</span>
01073     <span class="keywordflow">while</span> (indexList != NULL) {
01074         <a class="code" href="class_dbj_index.html">DbjIndex</a> *indexDesc = NULL;
01075 
01076         <span class="keywordflow">if</span> (indexList-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Index) {
01077             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01078             <span class="keywordflow">goto</span> cleanup;
01079         }
01080         indexDesc = reinterpret_cast&lt;const DbjAccessPlanIndex *&gt;(indexList)-&gt;
01081             getIndexDescriptor();
01082         <span class="keywordflow">if</span> (!indexDesc) {
01083             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01084             <span class="keywordflow">goto</span> cleanup;
01085         }
01086 
01087         <span class="comment">// Bestimme Datentyp der zu indizierenden Werte</span>
01088         {
01089             <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnId = 0;
01090             rc = indexDesc-&gt;<a class="code" href="class_dbj_index.html#a5">getColumnNumber</a>(columnId);
01091             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01092                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01093                 <span class="keywordflow">goto</span> cleanup;
01094             }
01095             rc = tuple-&gt;<a class="code" href="class_dbj_tuple.html#a6">getDataType</a>(columnId, idxKey.<a class="code" href="class_dbj_index_key.html#o0">dataType</a>);
01096             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01097                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01098                 <span class="keywordflow">goto</span> cleanup;
01099             }
01100         }
01101 
01102         rc = <a class="code" href="class_dbj_run_time.html#d9">deleteFromIndex</a>(tuple, tupleId, *indexDesc, idxKey);
01103         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01104             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01105             <span class="keywordflow">goto</span> cleanup;
01106         }
01107 
01108         indexList = indexList-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01109     }
01110 
01111  cleanup:
01112     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();                       
01113 }
01114 
01115 
01116 <span class="comment">// Loesche Index-Eintrag aus einem Index</span>
<a name="l01117"></a><a class="code" href="class_dbj_run_time.html#d9">01117</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d9">DbjRunTime::deleteFromIndex</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_tuple.html">DbjTuple</a> *tuple,
01118         <span class="keyword">const</span> <a class="code" href="struct_tuple_id.html">TupleId</a> tupleId, <span class="keyword">const</span> <a class="code" href="class_dbj_index.html">DbjIndex</a> &amp;indexDesc, <a class="code" href="class_dbj_index_key.html">DbjIndexKey</a> &amp;idxKey)
01119 {
01120     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01121     <a class="code" href="group__tableid.html#ga5">IndexId</a> indexId = DBJ_UNKNOWN_INDEX_ID;
01122     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnId = 0;
01123 
01124     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01125 
01126     <span class="keywordflow">if</span> (!tuple) {
01127         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
01128         <span class="keywordflow">goto</span> cleanup;
01129     }
01130 
01131     rc = indexDesc.<a class="code" href="class_dbj_index.html#a1">getIndexId</a>(indexId);
01132     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01133         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01134         <span class="keywordflow">goto</span> cleanup;
01135     }
01136     rc = indexDesc.<a class="code" href="class_dbj_index.html#a5">getColumnNumber</a>(columnId);
01137     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01138         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01139         <span class="keywordflow">goto</span> cleanup;
01140     }
01141 
01142     <span class="comment">// Baue Schluesselwert fuer den Index zusammen</span>
01143     <span class="keywordflow">switch</span> (idxKey.<a class="code" href="class_dbj_index_key.html#o0">dataType</a>) {
01144       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>:
01145           {
01146               <span class="keyword">const</span> <a class="code" href="group__int__datatypes.html#ga12">Sint32</a> *intValue = NULL;
01147               rc = tuple-&gt;<a class="code" href="class_dbj_tuple.html#a2">getInt</a>(columnId, intValue);
01148               <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01149                   <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01150                   <span class="keywordflow">goto</span> cleanup;
01151               }
01152               <span class="comment">// ignoriere NULL-Werte</span>
01153               <span class="keywordflow">if</span> (intValue == NULL) {
01154                   <span class="keywordflow">goto</span> cleanup;
01155               }
01156               idxKey.<a class="code" href="class_dbj_index_key.html#o1">intKey</a> = *intValue;
01157           }
01158           <span class="keywordflow">break</span>;
01159 
01160       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>:
01161           {
01162               <span class="keyword">const</span> <span class="keywordtype">char</span> *vcValue = NULL;
01163               <span class="keywordtype">char</span> vcData[DBJ_INDEX_VARCHAR_LENGTH+1];
01164               <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> vcLength = 0;
01165               rc = tuple-&gt;<a class="code" href="class_dbj_tuple.html#a1">getVarchar</a>(columnId, vcValue, vcLength);
01166               <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01167                   <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01168                   <span class="keywordflow">goto</span> cleanup;
01169               }
01170               <span class="comment">// ignoriere NULL-Werte</span>
01171               <span class="keywordflow">if</span> (vcValue == NULL) {
01172                   <span class="keywordflow">goto</span> cleanup;
01173               }
01174               <span class="keywordflow">if</span> (vcLength &gt;= <span class="keyword">sizeof</span> vcData) {
01175                   vcLength = <span class="keyword">sizeof</span>(vcData)-1;
01176               }
01177               <a class="code" href="group__memory__functions.html#ga5">DbjMemCopy</a>(vcData, vcValue, vcLength);
01178               vcData[vcLength] = <span class="charliteral">'\0'</span>;
01179               idxKey.<a class="code" href="class_dbj_index_key.html#o2">varcharKey</a> = vcData;
01180           }
01181           <span class="keywordflow">break</span>;
01182 
01183       <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>:
01184           <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01185           <span class="keywordflow">goto</span> cleanup;
01186     }
01187 
01188     <span class="comment">// Jetzt koennen wir das Tupel indizieren</span>
01189     rc = <a class="code" href="class_dbj_run_time.html#r1">indexMgr</a>-&gt;<a class="code" href="class_dbj_index_manager.html#a8">remove</a>(indexId, idxKey, &amp;tupleId);
01190     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01191         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01192         <span class="keywordflow">goto</span> cleanup;
01193     }
01194 
01195  cleanup:
01196     idxKey.<a class="code" href="class_dbj_index_key.html#o2">varcharKey</a> = NULL;
01197     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01198 }
01199 
01200 
01201 <span class="comment">// Fuehre SELECT-Anfrage aus</span>
<a name="l01202"></a><a class="code" href="class_dbj_run_time.html#d10">01202</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d10">DbjRunTime::executeSelect</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *accessPlan)
01203 {
01204     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01205     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *columnList = NULL;
01206     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *tableList = NULL;
01207     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *whereClause = NULL;
01208     <a class="code" href="class_dbj_tuple_iterator.html">DbjTupleIterator</a> *currentIter = NULL;
01209 
01210     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01211 
01212     <span class="keywordflow">if</span> (!accessPlan ||
01213             accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::SelectStmt) {
01214         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
01215         <span class="keywordflow">goto</span> cleanup;
01216     }
01217 
01218     columnList = accessPlan-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01219     <span class="keywordflow">if</span> (!columnList ||
01220             columnList-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Projections ||
01221             columnList-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>() == NULL) {
01222         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01223         <span class="keywordflow">goto</span> cleanup;
01224     }
01225     tableList = columnList-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01226     <span class="keywordflow">if</span> (!tableList ||
01227             tableList-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Sources ||
01228             tableList-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>() == NULL) {
01229         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01230         <span class="keywordflow">goto</span> cleanup;
01231     }
01232     whereClause = tableList-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01233     <span class="keywordflow">if</span> (whereClause &amp;&amp;
01234             whereClause-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::WhereClause) {
01235         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01236         <span class="keywordflow">goto</span> cleanup;
01237     }
01238 
01239     <span class="comment">/*</span>
01240 <span class="comment">     * Wir fangen bei den Tabellen an und bauen fuer jede Tabelle die</span>
01241 <span class="comment">     * Iteratoren.  Sind mehrere Tabellen vorhanden, so werden die einzelnen</span>
01242 <span class="comment">     * Iteratoren in einem Kreuzprodukt-Iterator zusammengefuehrt.</span>
01243 <span class="comment">     */</span>
01244     <span class="keywordflow">for</span> (<a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *table = tableList-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>(); table != NULL;
01245          table = table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()) {
01246         <a class="code" href="class_dbj_tuple_iterator.html">DbjTupleIterator</a> *tableIter = NULL;
01247 
01248         <span class="keywordflow">if</span> (table-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table ||
01249                 table-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() == NULL ||
01250                 *table-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() &lt; DBJ_MIN_TABLE_ID ||
01251                 *table-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() &gt; DBJ_MAX_TABLE_ID) {
01252             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01253             <span class="keywordflow">goto</span> cleanup;
01254         }
01255 
01256         rc = <a class="code" href="class_dbj_run_time.html#d11">getTableIterator</a>(table, tableIter);
01257         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01258             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01259             <span class="keywordflow">goto</span> cleanup;
01260         }
01261 
01262         <span class="comment">// Jetzt schauen wir, ob wir bereits einen Iterator ueber eine Tabelle</span>
01263         <span class="comment">// haben, mit der wir ein Kreuzprodukt bilden wollen.</span>
01264         <span class="keywordflow">if</span> (currentIter != NULL) {
01265             <a class="code" href="class_dbj_tuple_iterator.html">DbjTupleIterator</a> *joinIter = <span class="keyword">new</span> <a class="code" href="class_dbj_cross_product_tuple_iterator.html">DbjCrossProductTupleIterator</a>(
01266                     *currentIter, *tableIter);
01267             <span class="keywordflow">if</span> (!joinIter) {
01268                 <span class="keywordflow">goto</span> cleanup;
01269             }
01270             <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01271                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01272                 <span class="keywordflow">goto</span> cleanup;
01273             }
01274             tableIter = joinIter;
01275         }
01276 
01277         <span class="comment">// behalte den neuen Iterator fuer die weitere Verarbeitung</span>
01278         currentIter = tableIter;
01279     }
01280 
01281     <span class="comment">/*</span>
01282 <span class="comment">     * Wurde eine WHERE-Klausel angegeben, so muessen wir lediglich einen</span>
01283 <span class="comment">     * Filter definieren und ueber den zuvor erzeugten Iterator "stuelpen".</span>
01284 <span class="comment">     */</span>
01285     <span class="keywordflow">if</span> (whereClause != NULL) {
01286         <a class="code" href="struct_dbj_selector.html">DbjSelector</a> *filter = NULL;
01287         <a class="code" href="class_dbj_tuple_iterator.html">DbjTupleIterator</a> *filterIter = NULL;
01288 
01289         filter = <span class="keyword">new</span> <a class="code" href="struct_dbj_selector.html">DbjSelector</a>();
01290         <span class="keywordflow">if</span> (!filter) {
01291             <span class="keywordflow">goto</span> cleanup;
01292         }
01293         rc = <a class="code" href="class_dbj_run_time.html#d12">buildSelector</a>(whereClause-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>(), *filter,
01294                 tableList-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>());
01295         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01296             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01297             <span class="keywordflow">goto</span> cleanup;
01298         }
01299 
01300         filterIter = <span class="keyword">new</span> <a class="code" href="class_dbj_selection_tuple_iterator.html">DbjSelectionTupleIterator</a>(*currentIter, *filter);
01301         <span class="keywordflow">if</span> (!filterIter) {
01302             <span class="keywordflow">goto</span> cleanup;
01303         }
01304         <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01305             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01306             <span class="keywordflow">goto</span> cleanup;
01307         }
01308         currentIter = filterIter;
01309     }
01310 
01311     <span class="comment">/*</span>
01312 <span class="comment">     * Als letzten Schritt muessen wir noch die Projektionen vornehmen, um nur</span>
01313 <span class="comment">     * die Spalten auszugeben, die der Nutzer auch angefordert hat.  Hierfuer</span>
01314 <span class="comment">     * gehen wir wie folgt vor:</span>
01315 <span class="comment">     *</span>
01316 <span class="comment">     * (1) Zaehle die Anzahl der Spalten in der Projektionsliste</span>
01317 <span class="comment">     * (2) Baue die Abbildung auf</span>
01318 <span class="comment">     * (3) Bennenne alle Spalten um, wenn dies im Plan so angegeben wurde</span>
01319 <span class="comment">     */</span>
01320     {
01321         <a class="code" href="class_dbj_tuple_iterator.html">DbjTupleIterator</a> *projIter = NULL;
01322         <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> *columnMap = NULL;
01323         <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnMapSize = 0;
01324         <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *column = NULL;
01325         <span class="keywordtype">bool</span> joins = (tableList-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>() != NULL) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
01326 
01327         <span class="keywordflow">if</span> (columnList-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Projections) {
01328             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01329             <span class="keywordflow">goto</span> cleanup;
01330         }
01331         <span class="keywordflow">for</span> (column = columnList-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>(); column != NULL;
01332              column = column-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()) {
01333             <span class="keywordflow">if</span> (column-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Column ||
01334                     column-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() == NULL ||
01335                     *column-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() &lt; DBJ_MIN_UINT16 ||
01336                     *column-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() &gt; DBJ_MAX_UINT16) {
01337                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01338                 <span class="keywordflow">goto</span> cleanup;
01339             }
01340             columnMapSize++;
01341         }
01342 
01343         <span class="comment">// Befuelle das Array</span>
01344         columnMap = <span class="keyword">new</span> <a class="code" href="group__int__datatypes.html#ga9">Uint16</a>[columnMapSize];
01345         <span class="keywordflow">if</span> (!columnMap) {
01346             <span class="keywordflow">goto</span> cleanup;
01347         }
01348         column = columnList-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01349         <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> i = 0; i &lt; columnMapSize; i++, column = column-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()) {
01350             columnMap[i] = *column-&gt;getIntData();
01351             <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *columnNode = <span class="keyword">reinterpret_cast</span>&lt;
01352                 <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *&gt;(column);
01353 
01354             <span class="comment">// wenn wir mehrere Tabellen haben, so muessen wir noch die Anzahl</span>
01355             <span class="comment">// der Spalten (ohne Projektion) aller vorher-kommenden Tabellen</span>
01356             <span class="comment">// hinzuaddieren, um die korrekte Position in der Ergebnisliste</span>
01357             <span class="comment">// des Kreuzproduktes zu erhalten</span>
01358             <span class="keywordflow">if</span> (joins) {
01359                 <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> offset = 0;
01360                 <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan_table.html">DbjAccessPlanTable</a> *tableNode =
01361                     columnNode-&gt;<a class="code" href="class_dbj_access_plan_column.html#a2">getTableNode</a>();
01362 
01363                 <span class="keywordflow">for</span> (<a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *table = tableList-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01364                      table != NULL &amp;&amp; table != tableNode;
01365                      table = table-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()) {
01366                     <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = <span class="keyword">reinterpret_cast</span>&lt;
01367                         <a class="code" href="class_dbj_access_plan_table.html">DbjAccessPlanTable</a> *&gt;(table)-&gt;getTableDescriptor();
01368                     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> tableColumnCount = 0;
01369                     rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a5">getNumColumns</a>(tableColumnCount);
01370                     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01371                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01372                         <span class="keywordflow">goto</span> cleanup;
01373                     }
01374                     offset += tableColumnCount;
01375                 }
01376 
01377                 columnMap[i] += offset;
01378             }
01379 
01380             <span class="comment">// benenne Spalte noch um</span>
01381             <span class="keywordflow">if</span> (columnNode-&gt;<a class="code" href="class_dbj_access_plan_column.html#a1">getNewColumnName</a>() != NULL) {
01382                 <a class="code" href="class_dbj_table.html">DbjTable</a> *columnTableDesc = columnNode-&gt;<a class="code" href="class_dbj_access_plan_column.html#a3">getTableDescriptor</a>();
01383                 rc = columnTableDesc-&gt;<a class="code" href="class_dbj_table.html#a13">setColumnName</a>(*columnNode-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>(),
01384                         columnNode-&gt;<a class="code" href="class_dbj_access_plan_column.html#a1">getNewColumnName</a>());
01385                 <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01386                     <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01387                     <span class="keywordflow">goto</span> cleanup;
01388                 }
01389             }
01390         }
01391 
01392         projIter = <span class="keyword">new</span> <a class="code" href="class_dbj_projection_tuple_iterator.html">DbjProjectionTupleIterator</a>(*currentIter, columnMap,
01393                 columnMapSize);
01394         <span class="keywordflow">if</span> (!projIter) {
01395             <span class="keywordflow">goto</span> cleanup;
01396         }
01397         <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01398             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01399             <span class="keywordflow">goto</span> cleanup;
01400         }
01401         currentIter = projIter;
01402     }
01403 
01404     <span class="comment">// Belegung des fetchTupleIterator</span>
01405     <span class="keyword">delete</span> <a class="code" href="class_dbj_run_time.html#r3">fetchTupleIterator</a>;
01406     <a class="code" href="class_dbj_run_time.html#r3">fetchTupleIterator</a> = currentIter;
01407 
01408  cleanup:
01409     <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01410         <span class="keyword">delete</span> currentIter;
01411         <a class="code" href="class_dbj_run_time.html#r3">fetchTupleIterator</a> = NULL;
01412     }
01413     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01414 }
01415  
01416 
<a name="l01417"></a><a class="code" href="class_dbj_run_time.html#a2">01417</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#a2">DbjRunTime::fetch</a>(<a class="code" href="class_dbj_tuple.html">DbjTuple</a> *&amp;tuple)
01418 {
01419     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01420 
01421     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01422 
01423     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_run_time.html#r3">fetchTupleIterator</a> == NULL) {
01424         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01425         <span class="keywordflow">goto</span> cleanup;
01426     }
01427     rc = <a class="code" href="class_dbj_run_time.html#r3">fetchTupleIterator</a>-&gt;<a class="code" href="class_dbj_tuple_iterator.html#a1">getNextTuple</a>(tuple);
01428     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01429         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01430         <span class="keywordflow">goto</span> cleanup;
01431     }
01432 
01433  cleanup:
01434     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();   
01435 }
01436 
01437 
<a name="l01438"></a><a class="code" href="class_dbj_run_time.html#d12">01438</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d12">DbjRunTime::buildSelector</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *predicate,  
01439         <a class="code" href="struct_dbj_selector.html">DbjSelector</a> &amp;expression, <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *sources)
01440 {
01441     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01442     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *op = NULL;
01443     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *left = NULL;
01444     <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *right = NULL;
01445 
01446     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01447 
01448     <span class="keywordflow">if</span> (predicate == NULL) {
01449         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
01450         <span class="keywordflow">goto</span> cleanup;
01451     }
01452 
01453     expression.<a class="code" href="struct_dbj_selector.html#o1">leftExpression</a> = NULL;
01454     expression.<a class="code" href="struct_dbj_selector.html#o2">rightExpression</a> = NULL;
01455 
01456     left = predicate;
01457     op = left-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01458 
01459     <span class="comment">// Predicate - LO - Predicate</span>
01460     expression.<a class="code" href="struct_dbj_selector.html#o0">andOr</a> = DbjSelector::UnknownLO;
01461     <span class="keywordflow">if</span> (op &amp;&amp; op-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() == DbjAccessPlan::LogicalOperation) {
01462         <span class="keywordflow">if</span> (!op-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()) {
01463             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01464             <span class="keywordflow">goto</span> cleanup;
01465         }
01466         right = op-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01467 
01468         expression.<a class="code" href="struct_dbj_selector.html#o1">leftExpression</a> = <span class="keyword">new</span> <a class="code" href="struct_dbj_selector.html">DbjSelector</a>();
01469         expression.<a class="code" href="struct_dbj_selector.html#o2">rightExpression</a> = <span class="keyword">new</span> <a class="code" href="struct_dbj_selector.html">DbjSelector</a>();
01470         <span class="keywordflow">if</span> (!expression.<a class="code" href="struct_dbj_selector.html#o1">leftExpression</a> || !expression.<a class="code" href="struct_dbj_selector.html#o2">rightExpression</a>) {
01471             <span class="keywordflow">goto</span> cleanup;
01472         }
01473 
01474         <span class="keywordflow">if</span> (*op-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == <span class="charliteral">'A'</span>) {
01475             expression.<a class="code" href="struct_dbj_selector.html#o0">andOr</a> = DbjSelector::AND;
01476         }
01477         <span class="keywordflow">else</span> {
01478             expression.<a class="code" href="struct_dbj_selector.html#o0">andOr</a> = DbjSelector::OR;
01479         }    
01480         expression.<a class="code" href="struct_dbj_selector.html#o3">typ</a> = DbjSelector::and_or;
01481         <a class="code" href="class_dbj_run_time.html#d12">buildSelector</a>(left-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>(), *(expression.<a class="code" href="struct_dbj_selector.html#o1">leftExpression</a>), sources);
01482         <a class="code" href="class_dbj_run_time.html#d12">buildSelector</a>(right-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>(), *(expression.<a class="code" href="struct_dbj_selector.html#o2">rightExpression</a>), sources);
01483         <span class="keywordflow">goto</span> cleanup;
01484     }
01485 
01486     <span class="comment">/*</span>
01487 <span class="comment">     * Vergleich von 2 (einfachen) Ausdruecken</span>
01488 <span class="comment">     */</span>
01489     <span class="keywordflow">if</span> (left-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() == DbjAccessPlan::Predicate) {
01490         left = left-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01491         <span class="keywordflow">if</span> (!left) {
01492             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01493             <span class="keywordflow">goto</span> cleanup;
01494         }
01495         op = left-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01496     }
01497             
01498     <span class="comment">// Festlegung des Typs des einfachen Vergleichs</span>
01499     <span class="keywordflow">if</span> (!op || op-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Comparison ||
01500             !op-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()) {
01501         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01502         <span class="keywordflow">goto</span> cleanup;
01503     }
01504     right = op-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>();
01505 
01506     <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(op-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"&lt;"</span>) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
01507         expression.<a class="code" href="struct_dbj_selector.html#o3">typ</a> = DbjSelector::aoa;                  
01508         expression.<a class="code" href="struct_dbj_selector.html#o6">op</a> = DbjSelector::less;
01509     }
01510     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(op-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"&lt;="</span>) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
01511         expression.<a class="code" href="struct_dbj_selector.html#o3">typ</a> = DbjSelector::aoa;
01512         expression.<a class="code" href="struct_dbj_selector.html#o6">op</a> = DbjSelector::lessOrEqual;
01513     }
01514     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(op-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"="</span>) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
01515         expression.<a class="code" href="struct_dbj_selector.html#o6">op</a> = DbjSelector::equal;
01516         <span class="keywordflow">if</span> (right-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() == DbjAccessPlan::NullValue) {
01517             expression.<a class="code" href="struct_dbj_selector.html#o3">typ</a> = DbjSelector::isNull;
01518         }
01519         <span class="keywordflow">else</span> {
01520             expression.<a class="code" href="struct_dbj_selector.html#o3">typ</a> = DbjSelector::aoa;
01521         }                        
01522     }
01523     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(op-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"&gt;"</span>) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
01524         expression.<a class="code" href="struct_dbj_selector.html#o3">typ</a> = DbjSelector::aoa;                  
01525         expression.<a class="code" href="struct_dbj_selector.html#o6">op</a> = DbjSelector::greater;
01526     }
01527     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(op-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"&gt;="</span>) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
01528         expression.<a class="code" href="struct_dbj_selector.html#o3">typ</a> = DbjSelector::aoa;                  
01529         expression.<a class="code" href="struct_dbj_selector.html#o6">op</a> = DbjSelector::greaterOrEqual;
01530     }
01531     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(op-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"&lt;&gt;"</span>) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
01532         expression.<a class="code" href="struct_dbj_selector.html#o6">op</a> = DbjSelector::unequal;
01533         <span class="keywordflow">if</span> (right-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() == DbjAccessPlan::NullValue) {
01534             expression.<a class="code" href="struct_dbj_selector.html#o3">typ</a> = DbjSelector::isNotNull;
01535         }
01536         <span class="keywordflow">else</span> {
01537             expression.<a class="code" href="struct_dbj_selector.html#o3">typ</a> = DbjSelector::aoa;              
01538         }    
01539     }
01540     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(op-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"LIKE"</span>) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
01541         expression.<a class="code" href="struct_dbj_selector.html#o3">typ</a> = DbjSelector::like;
01542     }
01543     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__string__def.html#ga0">DbjStringCompare</a>(op-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(), <span class="stringliteral">"NOT LIKE"</span>) == <a class="code" href="group__datatypes.html#gga2a38">DBJ_EQUALS</a>) {
01544         expression.<a class="code" href="struct_dbj_selector.html#o3">typ</a> = DbjSelector::notLike;
01545     }    
01546 
01547     <span class="comment">// Belegung des linken und rechten Unterausdrucks</span>
01548     expression.<a class="code" href="struct_dbj_selector.html#o4">leftSubExpression</a> = <span class="keyword">new</span> <a class="code" href="struct_dbj_selector_1_1_expression.html">DbjSelector::Expression</a>();
01549     expression.<a class="code" href="struct_dbj_selector.html#o5">rightSubExpression</a> = <span class="keyword">new</span> <a class="code" href="struct_dbj_selector_1_1_expression.html">DbjSelector::Expression</a>();
01550     <span class="keywordflow">if</span> (!expression.<a class="code" href="struct_dbj_selector.html#o4">leftSubExpression</a> || !expression.<a class="code" href="struct_dbj_selector.html#o5">rightSubExpression</a>) {
01551         <span class="keywordflow">goto</span> cleanup;
01552     }
01553 
01554     rc = <a class="code" href="class_dbj_run_time.html#d13">buildExpression</a>(left, expression.<a class="code" href="struct_dbj_selector.html#o4">leftSubExpression</a>, sources);
01555     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01556         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01557         <span class="keywordflow">goto</span> cleanup;
01558     }
01559     <span class="keywordflow">if</span> (expression.<a class="code" href="struct_dbj_selector.html#o3">typ</a> != DbjSelector::isNull &amp;&amp;
01560             expression.<a class="code" href="struct_dbj_selector.html#o3">typ</a> != DbjSelector::isNotNull) {
01561         rc = <a class="code" href="class_dbj_run_time.html#d13">buildExpression</a>(right, expression.<a class="code" href="struct_dbj_selector.html#o5">rightSubExpression</a>, sources);
01562         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01563             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01564             <span class="keywordflow">goto</span> cleanup;
01565         }
01566     }
01567 
01568  cleanup:
01569     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01570 }
01571 
01572 
01573 <span class="comment">// Baue Expression zusammen</span>
<a name="l01574"></a><a class="code" href="class_dbj_run_time.html#d13">01574</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d13">DbjRunTime::buildExpression</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *node,
01575         <span class="keywordtype">void</span> *expr, <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *sources)
01576 {
01577     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01578     <a class="code" href="struct_dbj_selector_1_1_expression.html">DbjSelector::Expression</a> *expression = NULL;
01579 
01580     <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01581 
01582     <span class="keywordflow">if</span> (!node || !expr) {
01583         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
01584         <span class="keywordflow">goto</span> cleanup;
01585     }
01586     expression = static_cast&lt;DbjSelector::Expression *&gt;(expr);
01587 
01588     <span class="keywordflow">switch</span> (node-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>()) {
01589       <span class="keywordflow">case</span> DbjAccessPlan::Column:
01590           {
01591               <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnNumber = 0;
01592               <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = <span class="keyword">reinterpret_cast</span>&lt;
01593                   <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *&gt;(node)-&gt;getTableDescriptor();
01594               <span class="keywordflow">if</span> (!tableDesc || node-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() == NULL ||
01595                       *node-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() &lt; DBJ_MIN_UINT16 ||
01596                       *node-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() &gt; DBJ_MAX_UINT16) {
01597                   <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01598                   <span class="keywordflow">goto</span> cleanup;
01599               }
01600               columnNumber = *node-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>();
01601 
01602               expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o0">typ</a> = DbjSelector::spalte;
01603               rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(columnNumber,
01604                       expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o1">datatype</a>);
01605               <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01606                   <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01607                   <span class="keywordflow">goto</span> cleanup;
01608               }
01609               expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o2">numValue</a> = columnNumber;
01610 
01611               <span class="comment">// bei Joins muessen wir den "numValue" korrigieren, da er als</span>
01612               <span class="comment">// Spalten-Position im gejointen Tupel verwendet wird</span>
01613               <span class="keywordflow">if</span> (sources != NULL) {
01614                   <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> offset = 0;
01615                   <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *columnTable = <span class="keyword">reinterpret_cast</span>&lt;
01616                       <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan_column.html">DbjAccessPlanColumn</a> *&gt;(node)-&gt;getTableNode();
01617                   <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *tab = sources;
01618                        tab != NULL &amp;&amp; tab != columnTable; tab = tab-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()) {
01619                       <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> numColumns = 0;
01620 
01621                       <span class="keywordflow">if</span> (tab-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Table) {
01622                           <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01623                           <span class="keywordflow">goto</span> cleanup;
01624                       }
01625 
01626                       tableDesc = reinterpret_cast&lt;const DbjAccessPlanTable *&gt;(
01627                               tab)-&gt;getTableDescriptor();
01628                       <span class="keywordflow">if</span> (!tableDesc) {
01629                           <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01630                           <span class="keywordflow">goto</span> cleanup;
01631                       }
01632                       rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a5">getNumColumns</a>(numColumns);
01633                       <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01634                           <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01635                           <span class="keywordflow">goto</span> cleanup;
01636                       }
01637                       offset += numColumns;
01638                   }
01639                   expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o2">numValue</a> += offset;
01640               }
01641           }
01642           <span class="keywordflow">break</span>;
01643 
01644       <span class="keywordflow">case</span> DbjAccessPlan::IntegerValue:
01645           expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o0">typ</a> = DbjSelector::wert;
01646           expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o1">datatype</a> = <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>;
01647           <span class="keywordflow">if</span> (node-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() == NULL) {
01648               <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01649               <span class="keywordflow">goto</span> cleanup;
01650           }
01651           expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o2">numValue</a> = *node-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>();
01652           <span class="keywordflow">break</span>;
01653 
01654       <span class="keywordflow">case</span> DbjAccessPlan::VarcharValue:
01655           expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o0">typ</a> = DbjSelector::wert;
01656           expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o1">datatype</a> = <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>;
01657           <span class="keywordflow">if</span> (node-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>() == NULL) {
01658               <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01659               <span class="keywordflow">goto</span> cleanup;
01660           }
01661           <span class="comment">// kopiere den String in neuen Puffer da der Zugriffsplan, der den</span>
01662           <span class="comment">// String enthaelt, beim spaeteren FETCH nicht mehr vorhanden sein</span>
01663           <span class="comment">// muss</span>
01664           expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o3">strlen</a> = strlen(node-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>());
01665           expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o4">str</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o3">strlen</a>+1];
01666           <span class="keywordflow">if</span> (!expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o4">str</a>) {
01667               <span class="keywordflow">goto</span> cleanup;
01668           }
01669           <a class="code" href="group__memory__functions.html#ga5">DbjMemCopy</a>(expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o4">str</a>, node-&gt;<a class="code" href="class_dbj_access_plan.html#a6">getStringData</a>(),
01670                   expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o3">strlen</a>);
01671           expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o4">str</a>[expression-&gt;<a class="code" href="struct_dbj_selector_1_1_expression.html#o3">strlen</a>] = <span class="charliteral">'\0'</span>;
01672           <span class="keywordflow">break</span>;
01673 
01674       <span class="keywordflow">default</span>:
01675           <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01676           <span class="keywordflow">goto</span> cleanup;
01677     }
01678 
01679  cleanup:
01680     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01681 }
01682 
01683 
01684 <span class="comment">// Ermittle Iterator ueber einer Tabelle</span>
<a name="l01685"></a><a class="code" href="class_dbj_run_time.html#d11">01685</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d11">DbjRunTime::getTableIterator</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *table,
01686         <a class="code" href="class_dbj_tuple_iterator.html">DbjTupleIterator</a> *&amp;tableIter)
01687 {
01688     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01689     <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *son = NULL;
01690     <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc = NULL;
01691 
01692     <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01693 
01694     <span class="keywordflow">if</span> (!table || tableIter) {
01695         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
01696         <span class="keywordflow">goto</span> cleanup;
01697     }
01698 
01699     tableDesc = reinterpret_cast&lt;const DbjAccessPlanTable *&gt;(
01700             table)-&gt;getTableDescriptor();
01701     son = table-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01702     <span class="keywordflow">if</span> (son == NULL || son-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Index) {
01703         <a class="code" href="class_dbj_record_iterator.html">DbjRecordIterator</a> *recordIter = NULL;
01704 
01705         rc = <a class="code" href="class_dbj_run_time.html#r2">recordMgr</a>-&gt;<a class="code" href="class_dbj_record_manager.html#a6">getRecordIterator</a>(*table-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>(), recordIter);
01706         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01707             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01708             <span class="keywordflow">goto</span> cleanup;
01709         }
01710         tableIter = <span class="keyword">new</span> <a class="code" href="class_dbj_record_tuple_iterator.html">DbjRecordTupleIterator</a>(*recordIter, tableDesc);
01711         <span class="keywordflow">if</span> (!tableIter) {
01712             <span class="keywordflow">goto</span> cleanup;
01713         }
01714         <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01715             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01716             <span class="keywordflow">goto</span> cleanup;
01717         }
01718     }
01719     <span class="keywordflow">else</span> {
01720         <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan_index.html">DbjAccessPlanIndex</a> *index = <span class="keyword">reinterpret_cast</span>&lt;
01721             <span class="keyword">const</span> <a class="code" href="class_dbj_access_plan_index.html">DbjAccessPlanIndex</a> *&gt;(son);
01722         <a class="code" href="class_dbj_index_iterator.html">DbjIndexIterator</a> *indexIter = NULL;
01723 
01724         <span class="comment">// oeffne Index</span>
01725         rc = <a class="code" href="class_dbj_run_time.html#d15">openIndex</a>(index-&gt;<a class="code" href="class_dbj_access_plan_index.html#a1">getIndexDescriptor</a>(), tableDesc); 
01726         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01727             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01728             <span class="keywordflow">goto</span> cleanup;
01729         }
01730 
01731         <span class="keywordflow">if</span> (son-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() == NULL ||
01732                 *son-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() &lt; DBJ_MIN_INDEX_ID ||
01733                 *son-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>() &gt; DBJ_MAX_INDEX_ID) {
01734             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01735             <span class="keywordflow">goto</span> cleanup;
01736         }
01737 
01738         rc = <a class="code" href="class_dbj_run_time.html#r1">indexMgr</a>-&gt;<a class="code" href="class_dbj_index_manager.html#a6">findRange</a>(*son-&gt;<a class="code" href="class_dbj_access_plan.html#a7">getIntData</a>(), index-&gt;<a class="code" href="class_dbj_access_plan_index.html#a2">getStartKey</a>(),
01739                 index-&gt;<a class="code" href="class_dbj_access_plan_index.html#a3">getStopKey</a>(), indexIter);
01740         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01741             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01742             <span class="keywordflow">goto</span> cleanup;
01743         }
01744         tableIter = <span class="keyword">new</span> <a class="code" href="class_dbj_index_tuple_iterator.html">DbjIndexTupleIterator</a>(indexIter,
01745                 reinterpret_cast&lt;const DbjAccessPlanTable *&gt;(table)-&gt;
01746                 getTableDescriptor());
01747         <span class="keywordflow">if</span> (!tableIter) {
01748             <span class="keywordflow">goto</span> cleanup;
01749         }
01750         <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01751             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01752             <span class="keywordflow">goto</span> cleanup;
01753         }
01754 
01755         <span class="comment">// gehe zu eventuellen Filter-Praedikaten</span>
01756         son = son-&gt;<a class="code" href="class_dbj_access_plan.html#a4">getSon</a>();
01757     }
01758 
01759     <span class="comment">// Filterung auf der Tabellen- oder Index-Scan?</span>
01760     <span class="keywordflow">if</span> (son != NULL) {
01761         <a class="code" href="class_dbj_tuple_iterator.html">DbjTupleIterator</a> *filterIter = NULL;
01762         <a class="code" href="struct_dbj_selector.html">DbjSelector</a> *filter = NULL;
01763         <span class="keywordflow">if</span> (son-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Predicate) {
01764             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01765             <span class="keywordflow">goto</span> cleanup;
01766         }
01767 
01768         filter = <span class="keyword">new</span> <a class="code" href="struct_dbj_selector.html">DbjSelector</a>();
01769         <span class="keywordflow">if</span> (!filter) {
01770             <span class="keywordflow">goto</span> cleanup;
01771         }
01772         rc = <a class="code" href="class_dbj_run_time.html#d12">buildSelector</a>(son, *filter);
01773         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01774             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01775             <span class="keywordflow">goto</span> cleanup;
01776         }
01777 
01778         filterIter = <span class="keyword">new</span> <a class="code" href="class_dbj_selection_tuple_iterator.html">DbjSelectionTupleIterator</a>(*tableIter, *filter);
01779         <span class="keywordflow">if</span> (!filterIter) {
01780             <span class="keywordflow">goto</span> cleanup;
01781         }
01782         <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01783             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01784             <span class="keywordflow">goto</span> cleanup;
01785         }
01786         tableIter = filterIter;
01787     }
01788 
01789  cleanup:
01790     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01791 }
01792 
01793 
01794 <span class="comment">// fuehre ROLLBACK aus</span>
<a name="l01795"></a><a class="code" href="class_dbj_run_time.html#a3">01795</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#a3">DbjRunTime::executeRollback</a>()
01796 {
01797     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01798     <a class="code" href="class_dbj_lock_manager.html">DbjLockManager</a> *lockMgr = <a class="code" href="class_dbj_lock_manager.html#e0">DbjLockManager::getInstance</a>();
01799 
01800     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01801 
01802     rc = <a class="code" href="class_dbj_run_time.html#r2">recordMgr</a>-&gt;<a class="code" href="class_dbj_record_manager.html#a8">rollback</a>();
01803     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01804         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01805     }
01806     rc = <a class="code" href="class_dbj_run_time.html#r1">indexMgr</a>-&gt;<a class="code" href="class_dbj_index_manager.html#a10">rollback</a>();
01807     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01808         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01809     }
01810     rc = lockMgr-&gt;<a class="code" href="class_dbj_lock_manager.html#a2">releaseAll</a>();
01811     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01812         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01813     }
01814     rc = <a class="code" href="class_dbj_run_time.html#r0">catalogMgr</a>-&gt;<a class="code" href="class_dbj_catalog_manager.html#a0">startTransaction</a>();
01815     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01816         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01817     }
01818 
01819     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01820 }
01821 
01822 
01823 <span class="comment">// oeffne Indexe</span>
<a name="l01824"></a><a class="code" href="class_dbj_run_time.html#d14">01824</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d14">DbjRunTime::openIndexes</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *indexList,
01825         <span class="keyword">const</span> <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc)
01826 {
01827     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01828 
01829     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01830 
01831     <span class="keywordflow">if</span> (indexList == NULL) {
01832         <span class="keywordflow">goto</span> cleanup;
01833     }
01834     <span class="keywordflow">if</span> (!tableDesc) {
01835         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
01836         <span class="keywordflow">goto</span> cleanup;
01837     }
01838 
01839     <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="class_dbj_access_plan.html">DbjAccessPlan</a> *node = indexList; node != NULL;
01840          node = node-&gt;<a class="code" href="class_dbj_access_plan.html#a2">getNext</a>()) {
01841         <a class="code" href="class_dbj_index.html">DbjIndex</a> *indexDesc = NULL;
01842 
01843         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="class_dbj_access_plan.html#a1">getNodeType</a>() != DbjAccessPlan::Index) {
01844             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01845             <span class="keywordflow">goto</span> cleanup;
01846         }
01847         indexDesc = reinterpret_cast&lt;const DbjAccessPlanIndex *&gt;(
01848                 node)-&gt;getIndexDescriptor();
01849         <span class="keywordflow">if</span> (!indexDesc) {
01850             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
01851             <span class="keywordflow">goto</span> cleanup;
01852         }
01853 
01854         rc = <a class="code" href="class_dbj_run_time.html#d15">openIndex</a>(indexDesc, tableDesc);
01855         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01856             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01857             <span class="keywordflow">goto</span> cleanup;
01858         }
01859     }
01860 
01861  cleanup:
01862     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01863 }
01864 
01865 
01866 <span class="comment">// Oeffne einzelnen Index</span>
<a name="l01867"></a><a class="code" href="class_dbj_run_time.html#d15">01867</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_run_time.html#d15">DbjRunTime::openIndex</a>(<span class="keyword">const</span> <a class="code" href="class_dbj_index.html">DbjIndex</a> *indexDesc,
01868         <span class="keyword">const</span> <a class="code" href="class_dbj_table.html">DbjTable</a> *tableDesc)
01869 {
01870     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
01871     <a class="code" href="group__tableid.html#ga5">IndexId</a> indexId = DBJ_UNKNOWN_INDEX_ID;
01872     <span class="keywordtype">bool</span> unique = <span class="keyword">false</span>;
01873     <a class="code" href="group__datatypes.html#ga1">DbjIndexType</a> indexType = <a class="code" href="group__datatypes.html#gga1a37">UnknownIndexType</a>;
01874     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> columnId = 0;
01875     <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> dataType = <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>;
01876 
01877     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
01878 
01879     <span class="keywordflow">if</span> (!indexDesc || !tableDesc) {
01880         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
01881         <span class="keywordflow">goto</span> cleanup;
01882     }
01883 
01884     <span class="comment">// ermittle Index-Parameter</span>
01885     rc = indexDesc-&gt;<a class="code" href="class_dbj_index.html#a1">getIndexId</a>(indexId);
01886     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01887         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01888         <span class="keywordflow">goto</span> cleanup;
01889     }
01890     rc = indexDesc-&gt;<a class="code" href="class_dbj_index.html#a6">getUnique</a>(unique);
01891     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01892         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01893         <span class="keywordflow">goto</span> cleanup;
01894     }
01895     rc = indexDesc-&gt;<a class="code" href="class_dbj_index.html#a3">getIndexType</a>(indexType);
01896     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01897         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01898         <span class="keywordflow">goto</span> cleanup;
01899     }
01900     rc = indexDesc-&gt;<a class="code" href="class_dbj_index.html#a5">getColumnNumber</a>(columnId);
01901     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01902         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01903         <span class="keywordflow">goto</span> cleanup;
01904     }
01905     rc = tableDesc-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(columnId, dataType);
01906     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01907         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01908         <span class="keywordflow">goto</span> cleanup;
01909     }
01910 
01911     <span class="comment">// oeffne Index</span>
01912     rc = <a class="code" href="class_dbj_run_time.html#r1">indexMgr</a>-&gt;<a class="code" href="class_dbj_index_manager.html#a2">openIndex</a>(indexId, unique, indexType, dataType);
01913     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
01914         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
01915         <span class="keywordflow">goto</span> cleanup;
01916     }
01917 
01918  cleanup:
01919     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
01920 }
01921 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jul 4 15:40:30 2005 for Jenas Datenbanksystem 'System J' by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.8 </small></address>
</body>
</html>
