<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Jenas Datenbanksystem &apos;System J&apos;: dumpTable.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>dumpTable.cpp</h1><a href="dump_table_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************\</span>
00002 <span class="comment"> *                                                                       *</span>
00003 <span class="comment"> * (C) 2004-2005                                                         *</span>
00004 <span class="comment"> * Lehrstuhl fuer Datenbanken und Informationssysteme                    *</span>
00005 <span class="comment"> * Friedrich-Schiller-Universitaet Jena                                  *</span>
00006 <span class="comment"> * Ernst-Abbe-Platz 1-2                                                  *</span>
00007 <span class="comment"> * 07745 Jena                                                            *</span>
00008 <span class="comment"> *                                                                       *</span>
00009 <span class="comment">\*************************************************************************/</span>
00010 
00011 <span class="preprocessor">#include &lt;iostream&gt;</span>
00012 <span class="preprocessor">#include &lt;fstream&gt;</span>
00013 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
00014 
00015 <span class="preprocessor">#include "<a class="code" href="_dbj_record_manager_8hpp.html">DbjRecordManager.hpp</a>"</span>
00016 
00017 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00018 
<a name="l00019"></a><a class="code" href="dump_table_8cpp.html#a0">00019</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="_dbj_components_8hpp.html#a12">DbjComponent</a> <a class="code" href="dump_table_8cpp.html#a0">componentId</a> = <a class="code" href="_dbj_components_8hpp.html#a12a6">RecordManager</a>;
00020 
<a name="l00021"></a><a class="code" href="dump_table_8cpp.html#a1">00021</a> <span class="keywordtype">int</span> <a class="code" href="create__btree_8cpp.html#a1">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
00022 {
00023     <a class="code" href="class_dbj_error.html">DbjError</a> error;
00024     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00025     <a class="code" href="class_dbj_record_manager.html">DbjRecordManager</a> *recordMgr = <a class="code" href="class_dbj_record_manager.html#e0">DbjRecordManager::getInstance</a>();
00026     <a class="code" href="group__tableid.html#ga1">TableId</a> tableId = DBJ_UNKNOWN_TABLE_ID;
00027 
00028     <span class="keywordflow">if</span> (argc != 2) {
00029         cout &lt;&lt; <span class="stringliteral">"Table: "</span> &lt;&lt; flush;
00030         cin &gt;&gt; tableId;
00031     }
00032     <span class="keywordflow">else</span> {
00033         tableId = atoi(argv[1]);
00034     }
00035     rc = recordMgr-&gt;<a class="code" href="class_dbj_record_manager.html#a9">dumpTableContent</a>(tableId);
00036     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00037         <span class="keywordtype">char</span> errorMsg[1000] = { <span class="charliteral">'\0'</span> };
00038         error.<a class="code" href="class_dbj_error.html#a5">getError</a>(errorMsg, <span class="keyword">sizeof</span> errorMsg);
00039         printf(<span class="stringliteral">"%s\n"</span>, errorMsg);
00040         <span class="keywordflow">return</span> EXIT_FAILURE;
00041     }
00042     <span class="keywordflow">return</span> EXIT_SUCCESS;
00043 }
00044 
00045 <span class="comment">// ##########################################################################</span>
00046 <span class="comment">// Dummy-Treiber fuer Buffer Manager</span>
00047 <span class="comment">// ##########################################################################</span>
00048 
00049 <span class="preprocessor">#include "<a class="code" href="_dbj_buffer_manager_8hpp.html">DbjBufferManager.hpp</a>"</span>
00050 <span class="preprocessor">#include "<a class="code" href="_dbj_lock_manager_8hpp.html">DbjLockManager.hpp</a>"</span>
00051 <span class="preprocessor">#include "<a class="code" href="_dbj_page_8hpp.html">DbjPage.hpp</a>"</span>
00052 
<a name="l00053"></a><a class="code" href="class_dbj_buffer_manager.html#v0">00053</a> <a class="code" href="class_dbj_buffer_manager.html">DbjBufferManager</a> *<a class="code" href="class_dbj_buffer_manager.html#v0">DbjBufferManager::instance</a> = NULL;
00054 
00055 <a class="code" href="class_dbj_buffer_manager.html#d0">DbjBufferManager::DbjBufferManager</a>() { }
00056 
00057 <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_buffer_manager.html#a4">DbjBufferManager::getNewPage</a>(<span class="keyword">const</span> <a class="code" href="group__tableid.html#ga0">SegmentId</a>, <span class="keyword">const</span> <a class="code" href="group__id__datatypes.html#ga0">PageId</a>,
00058         <span class="keyword">const</span> DbjPage::PageType, <a class="code" href="class_dbj_page.html">DbjPage</a> *&amp;)
00059 {
00060     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(DBJ_INTERNAL_FAIL);
00061     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00062 }
00063 
00064 <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_buffer_manager.html#a3">DbjBufferManager::getPage</a>(<span class="keyword">const</span> <a class="code" href="group__tableid.html#ga0">SegmentId</a> segmentId,
00065         <span class="keyword">const</span> <a class="code" href="group__id__datatypes.html#ga0">PageId</a> pageId, <span class="keyword">const</span> DbjPage::PageType pageType, <a class="code" href="class_dbj_page.html">DbjPage</a> *&amp;page)
00066 {
00067     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00068     fstream file;
00069     <span class="keywordtype">char</span> filename[100] = { <span class="charliteral">'\0'</span> };
00070     sprintf(filename, <span class="stringliteral">"Seg%d.dbj"</span>, segmentId);
00071     file.open(filename, fstream::in | fstream::binary);
00072     <span class="keywordflow">if</span> (!file.is_open()) {
00073         <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(DBJ_FM_FILE_NOT_FOUND, segmentId);
00074         <span class="keywordflow">goto</span> cleanup;
00075     }
00076 
00077     page = <span class="keyword">new</span> <a class="code" href="class_dbj_page.html">DbjPage</a>();
00078     <span class="keywordflow">if</span> (!page) {
00079         <span class="keywordflow">goto</span> cleanup;
00080     }
00081     page = <span class="keyword">new</span> <a class="code" href="class_dbj_page.html">DbjPage</a>();
00082     page-&gt;<a class="code" href="class_dbj_page.html#r1">segmentId</a> = segmentId;
00083     page-&gt;<a class="code" href="class_dbj_page.html#r2">pageId</a> = pageId;
00084     page-&gt;<a class="code" href="class_dbj_page.html#r3">pageType</a> = pageType;
00085 
00086     <span class="comment">// Seitendaten lesen</span>
00087     file.seekg(DBJ_PAGE_SIZE * pageId, fstream::beg);
00088     file.read(reinterpret_cast&lt;char *&gt;(page-&gt;<a class="code" href="class_dbj_page.html#r0">data</a>), DBJ_PAGE_SIZE);
00089 
00090  cleanup:
00091     file.close();
00092     file.clear();
00093     <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00094         <span class="keyword">delete</span> page;
00095         page = NULL;
00096     }
00097     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00098 }
00099 
00100 <a class="code" href="group__tableid.html#ga0">SegmentId</a> <a class="code" href="class_dbj_buffer_manager.html#a9">DbjBufferManager::convertTableIdToSegmentId</a>(<span class="keyword">const</span> <a class="code" href="group__tableid.html#ga1">TableId</a> tableId)<span class="keyword"> const</span>
00101 <span class="keyword"></span>{
00102     <span class="keywordflow">return</span> tableId;
00103 }
00104 
00105 <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_buffer_manager.html#a6">DbjBufferManager::markPageAsModified</a>(<a class="code" href="class_dbj_page.html">DbjPage</a> &amp;)
00106 {
00107     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(DBJ_INTERNAL_FAIL);
00108     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00109 }
00110 
00111 
00112 <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_buffer_manager.html#a0">DbjBufferManager::createSegment</a>(<span class="keyword">const</span> <a class="code" href="group__tableid.html#ga0">SegmentId</a>)
00113 {
00114     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(DBJ_INTERNAL_FAIL);
00115     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00116 }
00117 
00118 <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_buffer_manager.html#a2">DbjBufferManager::openSegment</a>(<span class="keyword">const</span> <a class="code" href="group__tableid.html#ga0">SegmentId</a>)
00119 {
00120     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(DBJ_INTERNAL_FAIL);
00121     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00122 }
00123 
00124 <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_page.html#a5">DbjPage::markAsModified</a>()
00125 {
00126     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(DBJ_INTERNAL_FAIL);
00127     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00128 }
00129 
00130 <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_buffer_manager.html#a5">DbjBufferManager::releasePage</a>(<a class="code" href="class_dbj_page.html">DbjPage</a> *&amp;page)
00131 {
00132     <span class="keyword">delete</span> page;
00133     page = NULL;
00134     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00135 }
00136 
00137 <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_buffer_manager.html#a1">DbjBufferManager::dropSegment</a>(<span class="keyword">const</span> <a class="code" href="group__tableid.html#ga0">SegmentId</a>)
00138 {
00139     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(DBJ_INTERNAL_FAIL);
00140     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00141 }
00142 
00143 <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_buffer_manager.html#a7">DbjBufferManager::flush</a>()
00144 {
00145     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(DBJ_INTERNAL_FAIL);
00146     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00147 }
00148 
00149 <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_buffer_manager.html#a8">DbjBufferManager::discard</a>()
00150 {
00151     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(DBJ_INTERNAL_FAIL);
00152     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00153 }
00154 
00155 <span class="comment">// ##########################################################################</span>
00156 <span class="comment">// Dummy-Treiber fuer Lock Manager</span>
00157 <span class="comment">// ##########################################################################</span>
00158 
<a name="l00159"></a><a class="code" href="class_dbj_lock_manager.html#v0">00159</a> <a class="code" href="class_dbj_lock_manager.html">DbjLockManager</a> *<a class="code" href="class_dbj_lock_manager.html#v0">DbjLockManager::instance</a>;
00160 <a class="code" href="class_dbj_lock_manager.html#d0">DbjLockManager::DbjLockManager</a>() { }
00161 
00162 <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_lock_manager.html#a0">DbjLockManager::request</a>(<span class="keyword">const</span> <a class="code" href="group__tableid.html#ga0">SegmentId</a>, <span class="keyword">const</span> <a class="code" href="group__id__datatypes.html#ga0">PageId</a>,
00163         <span class="keyword">const</span> LockType)
00164 {
00165     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(DBJ_INTERNAL_FAIL);
00166     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00167 }
00168 
00169 <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_lock_manager.html#a1">DbjLockManager::release</a>(<span class="keyword">const</span> <a class="code" href="group__tableid.html#ga0">SegmentId</a>, <span class="keyword">const</span> <a class="code" href="group__id__datatypes.html#ga0">PageId</a>)
00170 {
00171     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(DBJ_INTERNAL_FAIL);
00172     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00173 }
00174 
00175 <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_lock_manager.html#a2">DbjLockManager::releaseAll</a>()
00176 {
00177     <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(DBJ_INTERNAL_FAIL);
00178     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00179 }
00180 
00181 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jul 4 15:40:30 2005 for Jenas Datenbanksystem 'System J' by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.8 </small></address>
</body>
</html>
