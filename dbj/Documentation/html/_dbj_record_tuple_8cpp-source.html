<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Jenas Datenbanksystem &apos;System J&apos;: DbjRecordTuple.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>DbjRecordTuple.cpp</h1><a href="_dbj_record_tuple_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************\</span>
00002 <span class="comment"> *                                                                       *</span>
00003 <span class="comment"> * (C) 2004-2005                                                         *</span>
00004 <span class="comment"> * Lehrstuhl fuer Datenbanken und Informationssysteme                    *</span>
00005 <span class="comment"> * Friedrich-Schiller-Universitaet Jena                                  *</span>
00006 <span class="comment"> * Ernst-Abbe-Platz 1-2                                                  *</span>
00007 <span class="comment"> * 07745 Jena                                                            *</span>
00008 <span class="comment"> *                                                                       *</span>
00009 <span class="comment">\*************************************************************************/</span>
00010 
00011 <span class="preprocessor">#include "<a class="code" href="_dbj_record_tuple_8hpp.html">DbjRecordTuple.hpp</a>"</span>
00012 
<a name="l00013"></a><a class="code" href="_dbj_record_tuple_8cpp.html#a0">00013</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="_dbj_components_8hpp.html#a12">DbjComponent</a> <a class="code" href="_dbj_record_tuple_8cpp.html#a0">componentId</a> = <a class="code" href="_dbj_components_8hpp.html#a12a5">RunTime</a>;
00014 
00015 <span class="comment">// Konstruktor</span>
<a name="l00016"></a><a class="code" href="class_dbj_record_tuple.html#a3">00016</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_record_tuple.html#a3">DbjRecordTuple::initialize</a>(<a class="code" href="class_dbj_record.html">DbjRecord</a> *rec, <a class="code" href="class_dbj_table.html">DbjTable</a> <span class="keyword">const</span> *tab)
00017 {
00018     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00019 
00020     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00021 
00022     <span class="keywordflow">if</span> (!rec || !tab) {
00023         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00024         <span class="keywordflow">goto</span> cleanup;
00025     }
00026 
00027     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_record_tuple.html#r0">record</a> &amp;&amp; <a class="code" href="class_dbj_record_tuple.html#r0">record</a> != rec) {
00028         <span class="keyword">delete</span> <a class="code" href="class_dbj_record_tuple.html#r0">record</a>;
00029     }
00030     <a class="code" href="class_dbj_record_tuple.html#r0">record</a> = rec;
00031     <a class="code" href="class_dbj_record_tuple.html#r2">table</a> = tab;
00032     rc = <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a5">getNumColumns</a>(<a class="code" href="class_dbj_record_tuple.html#r1">numSetColumns</a>);
00033     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00034         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00035         <span class="keywordflow">goto</span> cleanup;
00036     }
00037 
00038     <span class="comment">// pruefe Laenge der Daten des uebergebenen DbjRecord Objektes</span>
00039     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a2">getLength</a>() &lt; <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a6">getMinRecordLength</a>() ||
00040             <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a2">getLength</a>() &gt; <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a7">getMaxRecordLength</a>()) {
00041         <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a36">DBJ_CAT_INVALID_RECORD_SIZE</a>,
00042                 <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a2">getLength</a>(), <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a6">getMinRecordLength</a>(),
00043                 <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a7">getMaxRecordLength</a>());
00044         <span class="keywordflow">goto</span> cleanup;
00045     }
00046 
00047  cleanup:
00048     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00049 }
00050 
00051 
00052 <span class="comment">// Initialisiere leeres Tupel</span>
<a name="l00053"></a><a class="code" href="class_dbj_record_tuple.html#a4">00053</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_record_tuple.html#a3">DbjRecordTuple::initialize</a>(<a class="code" href="class_dbj_table.html">DbjTable</a> <span class="keyword">const</span> *tab)
00054 {
00055     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00056 
00057     <span class="keywordflow">if</span> (!tab) {
00058         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00059         <span class="keywordflow">goto</span> cleanup;
00060     }
00061 
00062     <a class="code" href="class_dbj_record_tuple.html#r2">table</a> = tab;
00063     <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_record_tuple.html#r0">record</a>) {
00064         <a class="code" href="class_dbj_record_tuple.html#r0">record</a> = <span class="keyword">new</span> <a class="code" href="class_dbj_record.html">DbjRecord</a>(NULL, tab-&gt;getMaxRecordLength());
00065         <span class="keywordflow">if</span> (!<a class="code" href="class_dbj_record_tuple.html#r0">record</a>) {
00066             <span class="keywordflow">goto</span> cleanup;
00067         }
00068     }
00069     <a class="code" href="class_dbj_record_tuple.html#r1">numSetColumns</a> = 0;
00070 
00071  cleanup:
00072     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00073 }
00074 
00075 
00076 <span class="comment">// gib VARCHAR-Attribut</span>
<a name="l00077"></a><a class="code" href="class_dbj_record_tuple.html#a5">00077</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_record_tuple.html#a5">DbjRecordTuple::getVarchar</a>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> columnNumber,
00078         <span class="keywordtype">char</span> <span class="keyword">const</span> *&amp;stringValue, <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> &amp;stringLength)<span class="keyword"> const</span>
00079 <span class="keyword"></span>{
00080     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00081     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> offset = 0;
00082     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <span class="keyword">const</span> *data = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a3">getRecordData</a>();
00083     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> length = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a2">getLength</a>();
00084     <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> dataType = <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>;
00085     <span class="keywordtype">bool</span> isNullable = <span class="keyword">false</span>;
00086 
00087     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00088 
00089     <span class="keywordflow">if</span> (columnNumber &gt;= <a class="code" href="class_dbj_record_tuple.html#r1">numSetColumns</a>) {
00090         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00091         <span class="keywordflow">goto</span> cleanup;
00092     }
00093     rc = <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(columnNumber, dataType);
00094     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00095         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00096         <span class="keywordflow">goto</span> cleanup;
00097     }
00098     <span class="keywordflow">if</span> (dataType != <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>) {
00099         <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a34">DBJ_CAT_DATATYPE_MISMATCH</a>, <span class="stringliteral">"VARCHAR"</span>,
00100                 columnNumber, <span class="stringliteral">"INTEGER"</span>);
00101         <span class="keywordflow">goto</span> cleanup;
00102     }
00103 
00104     rc = <a class="code" href="class_dbj_record_tuple.html#d0">findAttributeOffset</a>(columnNumber, offset);
00105     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00106         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00107         <span class="keywordflow">goto</span> cleanup;
00108     }
00109 
00110     rc = <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a12">getIsNullable</a>(columnNumber, isNullable);
00111     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00112         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00113         <span class="keywordflow">goto</span> cleanup;
00114     }
00115     <span class="keywordflow">if</span> (isNullable == <span class="keyword">true</span>) {
00116         offset += 1; <span class="comment">// springe hinter NULL-Indikator</span>
00117         <span class="keywordflow">if</span> (offset &gt; length) {
00118             <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00119                     1, offset-1, length);
00120             <span class="keywordflow">goto</span> cleanup;
00121         }
00122         <span class="keywordflow">if</span> (data[offset-1] == <span class="charliteral">'N'</span>) {
00123             stringValue = NULL;
00124             stringLength = 0;
00125             <span class="keywordflow">goto</span> cleanup;
00126         }
00127     }
00128     <span class="keywordflow">if</span> (offset + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>) &gt; length) {
00129         <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00130                 static_cast&lt;Uint8&gt;(<span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>)), offset, length);
00131         <span class="keywordflow">goto</span> cleanup;
00132     }
00133     stringLength = *(reinterpret_cast&lt;Uint16 const *&gt;(data + offset));
00134     offset += <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>);
00135     <span class="keywordflow">if</span> (offset + stringLength &gt; length) {
00136         <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00137                 stringLength, offset, length);
00138         <span class="keywordflow">goto</span> cleanup;
00139     }
00140     stringValue = reinterpret_cast&lt;char const *&gt;(data + offset);
00141 
00142  cleanup:
00143     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00144 }
00145 
00146 
00147 <span class="comment">// Gib INT-Attribut</span>
<a name="l00148"></a><a class="code" href="class_dbj_record_tuple.html#a6">00148</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_record_tuple.html#a6">DbjRecordTuple::getInt</a>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> columnNumber,
00149         <a class="code" href="group__int__datatypes.html#ga12">Sint32</a> <span class="keyword">const</span> *&amp;intValue)<span class="keyword"> const</span>
00150 <span class="keyword"></span>{
00151     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00152     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> offset = 0;
00153     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <span class="keyword">const</span> *data = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a3">getRecordData</a>();
00154     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> length = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a2">getLength</a>();
00155     <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> dataType = <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>;
00156     <span class="keywordtype">bool</span> isNullable = <span class="keyword">false</span>;
00157 
00158     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00159 
00160     <span class="keywordflow">if</span> (columnNumber &gt;= <a class="code" href="class_dbj_record_tuple.html#r1">numSetColumns</a>) {
00161         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00162         <span class="keywordflow">goto</span> cleanup;
00163     }
00164     rc = <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(columnNumber, dataType);
00165     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00166         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00167         <span class="keywordflow">goto</span> cleanup;
00168     }
00169     <span class="keywordflow">if</span> (dataType != <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>) {
00170         <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a34">DBJ_CAT_DATATYPE_MISMATCH</a>, <span class="stringliteral">"INTEGER"</span>,
00171                 columnNumber, <span class="stringliteral">"VARCHAR"</span>);
00172         <span class="keywordflow">goto</span> cleanup;
00173     }
00174 
00175     rc = <a class="code" href="class_dbj_record_tuple.html#d0">findAttributeOffset</a>(columnNumber, offset);
00176     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00177         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00178         <span class="keywordflow">goto</span> cleanup;
00179     }
00180 
00181     rc = <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a12">getIsNullable</a>(columnNumber, isNullable);
00182     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00183         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00184         <span class="keywordflow">goto</span> cleanup;
00185     }
00186     <span class="keywordflow">if</span> (isNullable == <span class="keyword">true</span>) {
00187         offset += 1; <span class="comment">// springe hinter NULL-Indikator</span>
00188         <span class="keywordflow">if</span> (offset &gt; length) {
00189             <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00190                     1, offset-1, length);
00191             <span class="keywordflow">goto</span> cleanup;
00192         }
00193         <span class="keywordflow">if</span> (data[offset-1] == <span class="charliteral">'N'</span>) {
00194             intValue = NULL;
00195             <span class="keywordflow">goto</span> cleanup;
00196         }
00197     }
00198     <span class="keywordflow">if</span> (offset + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>) &gt; length) {
00199         <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00200                 static_cast&lt;Uint8&gt;(<span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>)), offset, length);
00201         <span class="keywordflow">goto</span> cleanup;
00202     }
00203     intValue = reinterpret_cast&lt;Sint32 const *&gt;(data + offset);
00204 
00205  cleanup:
00206     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00207 }
00208 
00209 
00210 <span class="comment">// Setze VARCHAR-Wert</span>
<a name="l00211"></a><a class="code" href="class_dbj_record_tuple.html#a12">00211</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_record_tuple.html#a12">DbjRecordTuple::setVarchar</a>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> columnNumber,
00212         <span class="keywordtype">char</span> <span class="keyword">const</span> *stringValue, <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> newLength)
00213 {
00214     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00215     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> offset = 0;
00216     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#r2">rawData</a>;
00217     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> length = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a2">getLength</a>();
00218     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> oldLength = 0;
00219     <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> dataType = <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>;
00220     <span class="keywordtype">bool</span> isNullable = <span class="keyword">false</span>;
00221 
00222     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00223     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(1, <span class="stringliteral">"Column number"</span>, columnNumber);
00224 
00225     <span class="comment">// erzwinge sequenzielles Setzen der Attribute</span>
00226     <span class="keywordflow">if</span> (columnNumber &gt; <a class="code" href="class_dbj_record_tuple.html#r1">numSetColumns</a> || columnNumber &gt;= <a class="code" href="class_dbj_record_tuple.html#a9">getNumberColumns</a>()) {
00227         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00228         <span class="keywordflow">goto</span> cleanup;
00229     }
00230     rc = <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(columnNumber, dataType);
00231     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00232         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00233         <span class="keywordflow">goto</span> cleanup;
00234     }
00235     <span class="keywordflow">if</span> (dataType != <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>) {
00236         <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a34">DBJ_CAT_DATATYPE_MISMATCH</a>, <span class="stringliteral">"VARCHAR"</span>,
00237                 columnNumber, <span class="stringliteral">"INTEGER"</span>);
00238         <span class="keywordflow">goto</span> cleanup;
00239     }
00240     <span class="keywordflow">if</span> (stringValue != NULL) {
00241         <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> maxColLength = 0;
00242         rc = <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a11">getMaxColumnLength</a>(columnNumber, maxColLength);
00243         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00244             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00245             <span class="keywordflow">goto</span> cleanup;
00246         }
00247         <span class="keywordflow">if</span> (maxColLength &lt; newLength) {
00248             <a class="code" href="_dbj_error_8hpp.html#a5">DBJ_SET_ERROR_TOKEN4</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a39">DBJ_CAT_VALUE_TOO_LONG</a>, stringValue,
00249                     columnNumber, newLength, maxColLength);
00250             <span class="keywordflow">goto</span> cleanup;
00251         }
00252     }
00253 
00254     <span class="comment">// finde Stelle, wo neuer Wert hingeschrieben werden soll</span>
00255     rc = <a class="code" href="class_dbj_record_tuple.html#d0">findAttributeOffset</a>(columnNumber, offset);
00256     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00257         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00258         <span class="keywordflow">goto</span> cleanup;
00259     }
00260 
00261     rc = <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a12">getIsNullable</a>(columnNumber, isNullable);
00262     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00263         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00264         <span class="keywordflow">goto</span> cleanup;
00265     }
00266 
00267     <span class="comment">// Wert war noch nicht gesetzt</span>
00268     <span class="keywordflow">if</span> (columnNumber == <a class="code" href="class_dbj_record_tuple.html#r1">numSetColumns</a>) {
00269         <span class="comment">// stelle sicher, dass genuegend Speicher vorhanden ist und setze</span>
00270         <span class="comment">// korrekte Laenge des erweiterten Records</span>
00271         rc = <a class="code" href="class_dbj_record_tuple.html#d2">makeSpaceInRecord</a>(offset, (isNullable ? 1 : 0) +
00272                 (stringValue ? <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>) + newLength : 0),
00273                 data, length);
00274         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00275             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00276             <span class="keywordflow">goto</span> cleanup;
00277         }
00278 
00279         <span class="keywordflow">if</span> (isNullable == <span class="keyword">true</span>) {
00280             <span class="keywordflow">if</span> (stringValue == NULL) {
00281                 data[offset] = <span class="charliteral">'N'</span>; <span class="comment">// setze NULL-Indikator und das wars</span>
00282             }
00283             <span class="keywordflow">else</span> {
00284                 data[offset] = <span class="charliteral">'-'</span>; <span class="comment">// setze NULL-Indikator</span>
00285                 *reinterpret_cast&lt;Uint16 *&gt;(data + offset + 1) = newLength;
00286                 <a class="code" href="group__memory__functions.html#ga5">DbjMemCopy</a>(data + offset + 1 + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>),
00287                         stringValue, newLength);
00288             }
00289         }
00290         <span class="keywordflow">else</span> {
00291             <span class="keywordflow">if</span> (stringValue == NULL) {
00292                 <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a38">DBJ_CAT_COLUMN_NOT_NULLABLE</a>, columnNumber);
00293                 <span class="keywordflow">goto</span> cleanup;
00294             }
00295             *reinterpret_cast&lt;Uint16 *&gt;(data + offset) = newLength;
00296             <a class="code" href="group__memory__functions.html#ga5">DbjMemCopy</a>(data + offset + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>), stringValue, newLength);
00297         }
00298         rc = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#d0">setData</a>(data, length);
00299         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00300             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00301             <span class="keywordflow">goto</span> cleanup;
00302         }
00303         <a class="code" href="class_dbj_record_tuple.html#r1">numSetColumns</a>++;
00304         <span class="keywordflow">goto</span> cleanup;
00305     }
00306 
00307     <span class="comment">// Ersetze vorhandenen Wert</span>
00308     <span class="keywordflow">if</span> (isNullable == <span class="keyword">true</span>) {
00309         offset += 1; <span class="comment">// springe hinter NULL-Indikator</span>
00310         <span class="keywordflow">if</span> (offset &gt; length) {
00311             <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00312                     1, offset-1, length);
00313             <span class="keywordflow">goto</span> cleanup;
00314         }
00315 
00316         <span class="comment">// Before-Image hat einen NULL-Wert im Attribut</span>
00317         <span class="keywordflow">if</span> (data[offset-1] == <span class="charliteral">'N'</span>) {
00318             <span class="keywordflow">if</span> (stringValue == NULL) {
00319                 <span class="comment">// keine Aenderung</span>
00320                 <span class="keywordflow">goto</span> cleanup;
00321             }
00322             data[offset-1] = <span class="charliteral">'-'</span>; <span class="comment">// setze NULL-Indikator zurueck</span>
00323 
00324             <span class="comment">// Record waechst, schaffe Platz fuer Laengeninformation</span>
00325             rc = <a class="code" href="class_dbj_record_tuple.html#d2">makeSpaceInRecord</a>(offset, <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>), data, length);
00326             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00327                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00328                 <span class="keywordflow">goto</span> cleanup;
00329             }
00330         }
00331         <span class="comment">// Before-Image ist nicht NULL</span>
00332         <span class="keywordflow">else</span> {
00333             <span class="keywordflow">if</span> (offset + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>) &gt; length) {
00334                 <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00335                         static_cast&lt;Uint8&gt;(<span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>)), offset, length);
00336                 <span class="keywordflow">goto</span> cleanup;
00337             }
00338             oldLength = *reinterpret_cast&lt;Uint16 *&gt;(data + offset);
00339 
00340             <span class="comment">// Neuer Wert ist NULL - setzen!</span>
00341             <span class="keywordflow">if</span> (stringValue == NULL) {
00342                 data[offset-1] = <span class="charliteral">'N'</span>;
00343 
00344                 <span class="comment">// Luecke zum naechsten Attribut schliessen</span>
00345                 rc = <a class="code" href="class_dbj_record_tuple.html#d1">closeGapInRecord</a>(offset, <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>) + oldLength, length);
00346                 <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00347                     <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00348                     <span class="keywordflow">goto</span> cleanup;
00349                 }
00350                 <span class="keywordflow">goto</span> cleanup;
00351             }
00352         }
00353     }
00354     <span class="keywordflow">else</span> {
00355         <span class="keywordflow">if</span> (stringValue == NULL) {
00356             <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a38">DBJ_CAT_COLUMN_NOT_NULLABLE</a>, columnNumber);
00357             <span class="keywordflow">goto</span> cleanup;
00358         }
00359         <span class="keywordflow">if</span> (offset + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>) &gt; length) {
00360             <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00361                     static_cast&lt;Uint8&gt;(<span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>)), offset, length);
00362             <span class="keywordflow">goto</span> cleanup;
00363         }
00364         oldLength = *reinterpret_cast&lt;Uint16 *&gt;(data + offset);
00365     }
00366 
00367     <span class="comment">// Record waechst</span>
00368     <span class="keywordflow">if</span> (oldLength &lt; newLength) {
00369         rc = <a class="code" href="class_dbj_record_tuple.html#d2">makeSpaceInRecord</a>(offset + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>),
00370                 newLength - oldLength, data, length);
00371         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00372             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00373             <span class="keywordflow">goto</span> cleanup;
00374         }
00375     }
00376     <span class="comment">// Record schrumpft</span>
00377     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (oldLength &gt; newLength) {
00378         rc = <a class="code" href="class_dbj_record_tuple.html#d1">closeGapInRecord</a>(offset + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>),
00379                 oldLength - newLength, length);
00380         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00381             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00382             <span class="keywordflow">goto</span> cleanup;
00383         }
00384     }
00385 
00386     <span class="keywordflow">if</span> (offset + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>) + newLength &gt; length) {
00387         <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00388                 oldLength, static_cast&lt;Uint16&gt;(offset + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>)), length);
00389         <span class="keywordflow">goto</span> cleanup;
00390     }
00391 
00392     <span class="comment">// Wert ersetzen</span>
00393     *reinterpret_cast&lt;Uint16 *&gt;(data + offset) = newLength;
00394     offset += <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>);
00395     <a class="code" href="group__memory__functions.html#ga5">DbjMemCopy</a>(data + offset, stringValue, newLength);
00396     offset += newLength;
00397 
00398  cleanup:
00399     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_record_tuple.html#r1">numSetColumns</a> == columnNumber &amp;&amp; <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() == <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00400         <a class="code" href="class_dbj_record_tuple.html#r1">numSetColumns</a>++;
00401     }
00402     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00403 }
00404 
00405 
00406 <span class="comment">// Setze INTEGER-Wert</span>
<a name="l00407"></a><a class="code" href="class_dbj_record_tuple.html#a13">00407</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_record_tuple.html#a13">DbjRecordTuple::setInt</a>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> columnNumber,
00408         <a class="code" href="group__int__datatypes.html#ga12">Sint32</a> <span class="keyword">const</span> *intValue)
00409 {
00410     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00411     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> offset = 0;
00412     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#r2">rawData</a>;
00413     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> length = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a2">getLength</a>();
00414     <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> dataType = <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>;
00415     <span class="keywordtype">bool</span> isNullable = <span class="keyword">false</span>;
00416 
00417     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00418     <a class="code" href="group__trace__def.html#ga6">DBJ_TRACE_NUMBER</a>(1, <span class="stringliteral">"Column number"</span>, columnNumber);
00419 
00420     <span class="comment">// erzwinge sequenzielles Setzen der Attribute</span>
00421     <span class="keywordflow">if</span> (columnNumber &gt; <a class="code" href="class_dbj_record_tuple.html#r1">numSetColumns</a> || columnNumber &gt;= <a class="code" href="class_dbj_record_tuple.html#a9">getNumberColumns</a>()) {
00422         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00423         <span class="keywordflow">goto</span> cleanup;
00424     }
00425     rc = <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(columnNumber, dataType);
00426     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00427         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00428         <span class="keywordflow">goto</span> cleanup;
00429     }
00430     <span class="keywordflow">if</span> (dataType != <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>) {
00431         <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a34">DBJ_CAT_DATATYPE_MISMATCH</a>, <span class="stringliteral">"INTEGER"</span>,
00432                 columnNumber, <span class="stringliteral">"VARCHAR"</span>);
00433         <span class="keywordflow">goto</span> cleanup;
00434     }
00435 
00436     rc = <a class="code" href="class_dbj_record_tuple.html#d0">findAttributeOffset</a>(columnNumber, offset);
00437     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00438         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00439         <span class="keywordflow">goto</span> cleanup;
00440     }
00441 
00442     rc = <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a12">getIsNullable</a>(columnNumber, isNullable);
00443     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00444         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00445         <span class="keywordflow">goto</span> cleanup;
00446     }
00447 
00448     <span class="comment">// Wert war noch nicht gesetzt</span>
00449     <span class="keywordflow">if</span> (columnNumber == <a class="code" href="class_dbj_record_tuple.html#r1">numSetColumns</a>) {
00450         <span class="comment">// stelle sicher, dass genuegend Speicher vorhanden ist und erhoehe</span>
00451         <span class="comment">// Laenge des Records</span>
00452         rc = <a class="code" href="class_dbj_record_tuple.html#d2">makeSpaceInRecord</a>(offset, (isNullable ? 1 : 0) +
00453                 (intValue ? <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>) : 0), data, length);
00454         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00455             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00456             <span class="keywordflow">goto</span> cleanup;
00457         }
00458 
00459         <span class="keywordflow">if</span> (isNullable == <span class="keyword">true</span>) {
00460             <span class="keywordflow">if</span> (intValue == NULL) {
00461                 data[offset] = <span class="charliteral">'N'</span>; <span class="comment">// setze NULL-Indikator und das wars</span>
00462             }
00463             <span class="keywordflow">else</span> {
00464                 data[offset] = <span class="charliteral">'-'</span>; <span class="comment">// setze NULL-Indikator</span>
00465                 *reinterpret_cast&lt;Sint32 *&gt;(data + offset + 1) = *intValue;
00466             }
00467         }
00468         <span class="keywordflow">else</span> {
00469             <span class="keywordflow">if</span> (intValue == NULL) {
00470                 <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a38">DBJ_CAT_COLUMN_NOT_NULLABLE</a>, columnNumber);
00471                 <span class="keywordflow">goto</span> cleanup;
00472             }
00473             *reinterpret_cast&lt;Sint32 *&gt;(data + offset) = *intValue;
00474         }
00475         rc = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#d0">setData</a>(data, length);
00476         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00477             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00478             <span class="keywordflow">goto</span> cleanup;
00479         }
00480         <a class="code" href="class_dbj_record_tuple.html#r1">numSetColumns</a>++;
00481         <span class="keywordflow">goto</span> cleanup;
00482     }
00483 
00484     <span class="comment">// ersetze Wert</span>
00485     <span class="keywordflow">if</span> (isNullable == <span class="keyword">true</span>) {
00486         offset += 1; <span class="comment">// springe hinter NULL-Indikator</span>
00487         <span class="keywordflow">if</span> (offset &gt; length) {
00488             <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00489                     1, offset-1, length);
00490             <span class="keywordflow">goto</span> cleanup;
00491         }
00492 
00493         <span class="comment">// Before-Image enthaelt einen NULL-Wert</span>
00494         <span class="keywordflow">if</span> (data[offset-1] == <span class="charliteral">'N'</span>) {
00495             <span class="keywordflow">if</span> (intValue == NULL) {
00496                 <span class="comment">// keine Aenderung</span>
00497                 <span class="keywordflow">goto</span> cleanup;
00498             }
00499             data[offset-1] = <span class="charliteral">'-'</span>; <span class="comment">// Setze NULL-Indikator zurueck</span>
00500 
00501             <span class="comment">// Record waechst</span>
00502             rc = <a class="code" href="class_dbj_record_tuple.html#d2">makeSpaceInRecord</a>(offset, <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>), data, length);
00503             <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00504                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00505                 <span class="keywordflow">goto</span> cleanup;
00506             }
00507         }
00508         <span class="comment">// Before-Image ist nicht NULL, und After-Image ist ein NULL-Wert</span>
00509         <span class="keywordflow">else</span> {
00510             <span class="keywordflow">if</span> (intValue == NULL) {
00511                 <span class="comment">// Wert gegen NULL ersetzen</span>
00512                 data[offset-1] = <span class="charliteral">'N'</span>;
00513                 rc = <a class="code" href="class_dbj_record_tuple.html#d1">closeGapInRecord</a>(offset, <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>), length);
00514                 <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00515                     <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00516                     <span class="keywordflow">goto</span> cleanup;
00517                 }
00518                 <span class="keywordflow">goto</span> cleanup;
00519             }
00520         }
00521     }
00522     <span class="keywordflow">else</span> {
00523         <span class="comment">// non-nullable Spalte</span>
00524         <span class="keywordflow">if</span> (intValue == NULL) {
00525             <a class="code" href="_dbj_error_8hpp.html#a2">DBJ_SET_ERROR_TOKEN1</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a38">DBJ_CAT_COLUMN_NOT_NULLABLE</a>, columnNumber);
00526             <span class="keywordflow">goto</span> cleanup;
00527         }
00528     }
00529 
00530     <span class="comment">// Wert ersetzen</span>
00531     <span class="keywordflow">if</span> (offset + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>) &gt; length) {
00532         <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00533                 static_cast&lt;Uint8&gt;(<span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>)), offset, length);
00534         <span class="keywordflow">goto</span> cleanup;
00535     }
00536     *reinterpret_cast&lt;Sint32 *&gt;(data + offset) = *intValue;
00537 
00538  cleanup:
00539     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00540 }
00541 
00542 
00543 <span class="comment">// Gib Anzahl der Spalten</span>
<a name="l00544"></a><a class="code" href="class_dbj_record_tuple.html#a9">00544</a> <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <a class="code" href="class_dbj_record_tuple.html#a9">DbjRecordTuple::getNumberColumns</a>()<span class="keyword"> const</span>
00545 <span class="keyword"></span>{
00546     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00547     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> numColumns = 0;
00548 
00549     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00550 
00551     rc = <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a5">getNumColumns</a>(numColumns);
00552     <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00553         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00554         <span class="keywordflow">goto</span> cleanup;
00555     }
00556 
00557  cleanup:
00558     <span class="keywordflow">return</span> numColumns;
00559 }
00560 
00561 
00562 <span class="comment">// Gib Record zum Tupel</span>
<a name="l00563"></a><a class="code" href="class_dbj_record_tuple.html#a11">00563</a> <a class="code" href="class_dbj_record.html">DbjRecord</a> <span class="keyword">const</span> *<a class="code" href="class_dbj_record_tuple.html#a11">DbjRecordTuple::getRecord</a>()<span class="keyword"> const</span>
00564 <span class="keyword"></span>{
00565     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00566 
00567     <span class="keywordflow">if</span> (<a class="code" href="class_dbj_record_tuple.html#r1">numSetColumns</a> &lt; <a class="code" href="class_dbj_record_tuple.html#a9">getNumberColumns</a>()) {
00568         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00569         <span class="keywordflow">return</span> NULL;
00570     }
00571     <span class="keywordflow">return</span> <a class="code" href="class_dbj_record_tuple.html#r0">record</a>;
00572 }
00573 
00574 
00575 <span class="comment">// Finde Offset des Attributs im Record</span>
<a name="l00576"></a><a class="code" href="class_dbj_record_tuple.html#d0">00576</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_record_tuple.html#d0">DbjRecordTuple::findAttributeOffset</a>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> columnNumber,
00577         <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> &amp;offset)<span class="keyword"> const</span>
00578 <span class="keyword"></span>{
00579     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> rc = <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>;
00580     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <span class="keyword">const</span> *data = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a3">getRecordData</a>();
00581     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> length = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a2">getLength</a>();
00582 
00583     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00584 
00585     offset = 0;
00586 
00587     <span class="comment">// suche den Anfang des Attributs im Record</span>
00588     <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> i = 0; i &lt; columnNumber; i++) {
00589         <a class="code" href="group__datatypes.html#ga0">DbjDataType</a> dataType = <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>;
00590         <span class="keywordtype">bool</span> isNullable = <span class="keyword">false</span>;
00591 
00592         rc = <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a10">getColumnDatatype</a>(i, dataType);
00593         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00594             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00595             <span class="keywordflow">goto</span> cleanup;
00596         }
00597         rc = <a class="code" href="class_dbj_record_tuple.html#r2">table</a>-&gt;<a class="code" href="class_dbj_table.html#a12">getIsNullable</a>(i, isNullable);
00598         <span class="keywordflow">if</span> (rc != <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00599             <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00600             <span class="keywordflow">goto</span> cleanup;
00601         }
00602 
00603         <span class="comment">// springe im Record nach vorn</span>
00604         <span class="keywordflow">switch</span> (dataType) {
00605           <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a33">INTEGER</a>:
00606               <span class="keywordflow">if</span> (isNullable == <span class="keyword">true</span>) {
00607                   offset += 1; <span class="comment">// springe hinter NULL-Indikator</span>
00608                   <span class="keywordflow">if</span> (offset &gt; length) {
00609                       <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00610                               1, offset-1, length);
00611                       <span class="keywordflow">goto</span> cleanup;
00612                   }
00613                   <span class="keywordflow">if</span> (data[offset-1] == <span class="charliteral">'N'</span>) {
00614                       <span class="keywordflow">break</span>;
00615                   }
00616               }
00617               offset += <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga12">Sint32</a>); <span class="comment">// Wert</span>
00618               <span class="keywordflow">break</span>;
00619 
00620           <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a32">VARCHAR</a>:
00621               <span class="keywordflow">if</span> (isNullable == <span class="keyword">true</span>) {
00622                   offset += 1; <span class="comment">// springe hinter NULL-Indikator</span>
00623                   <span class="keywordflow">if</span> (offset &gt; length) {
00624                       <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00625                               1, offset-1, length);
00626                       <span class="keywordflow">goto</span> cleanup;
00627                   }
00628                   <span class="keywordflow">if</span> (data[offset-1] == <span class="charliteral">'N'</span>) {
00629                       <span class="keywordflow">break</span>;
00630                   }
00631               }
00632               <span class="comment">// Wert</span>
00633               {
00634                   <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> *strLength = NULL;
00635                   <span class="keywordflow">if</span> (offset + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>) &gt; length) {
00636                       <a class="code" href="_dbj_error_8hpp.html#a4">DBJ_SET_ERROR_TOKEN3</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a37">DBJ_CAT_INVALID_RECORD_STRUCTURE</a>,
00637                               static_cast&lt;Uint8&gt;(<span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>)),
00638                               static_cast&lt;Uint16&gt;(offset + <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>)),
00639                               length);
00640                       <span class="keywordflow">goto</span> cleanup;
00641                   }
00642                   strLength = reinterpret_cast&lt;Uint16 const *&gt;(data + offset);
00643                   offset += <span class="keyword">sizeof</span>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a>) + *strLength;
00644               }
00645               <span class="keywordflow">break</span>;
00646 
00647           <span class="keywordflow">case</span> <a class="code" href="group__datatypes.html#gga0a34">UnknownDataType</a>:
00648               <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00649               <span class="keywordflow">goto</span> cleanup;
00650         }
00651 
00652         <span class="keywordflow">if</span> (offset &gt; length) {
00653             <span class="comment">// irgendeine Pruefung vorher ging schief</span>
00654             <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a2">DBJ_INTERNAL_FAIL</a>);
00655             <span class="keywordflow">goto</span> cleanup;
00656         }
00657     }
00658 
00659  cleanup:
00660     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00661 }
00662 
00663 
00664 <span class="comment">// Schliesse Luecke im Record</span>
<a name="l00665"></a><a class="code" href="class_dbj_record_tuple.html#d1">00665</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_record_tuple.html#d1">DbjRecordTuple::closeGapInRecord</a>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> offset,
00666         <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> numBytes, <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> &amp;recordLength)
00667 {
00668     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#r2">rawData</a>;
00669     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> length = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a2">getLength</a>();
00670     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> nextOffset = offset + numBytes;
00671 
00672     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00673 
00674     <span class="keywordflow">if</span> (offset &gt; length || nextOffset &gt; length) {
00675         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00676         <span class="keywordflow">goto</span> cleanup;
00677     }
00678     <span class="keywordflow">if</span> (offset == length || numBytes == 0) {
00679         <span class="keywordflow">goto</span> cleanup; <span class="comment">// nichts zu tun</span>
00680     }
00681 
00682     <span class="comment">// beim letzten Attribut muessen keine nachfolgenden Daten kopiert werden</span>
00683     <span class="keywordflow">if</span> (nextOffset == length) {
00684         <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#r3">rawDataLength</a> = offset;
00685         <span class="keywordflow">goto</span> cleanup;
00686     }
00687 
00688     <span class="comment">// verschiebe Daten im Record</span>
00689     <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> i = 0; i &lt; length - offset - numBytes; i++) {
00690         data[offset + i] = data[offset + i + numBytes];
00691     }
00692     <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#r3">rawDataLength</a> -= numBytes;
00693 
00694  cleanup:
00695     recordLength = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a2">getLength</a>();
00696     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00697 }
00698 
00699 
00700 <span class="comment">// Schaffe Platz im Record</span>
<a name="l00701"></a><a class="code" href="class_dbj_record_tuple.html#d2">00701</a> <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_record_tuple.html#d2">DbjRecordTuple::makeSpaceInRecord</a>(<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> offset,
00702         <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> numBytes, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *&amp;recordData, <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> &amp;recordLength)
00703 {
00704     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> allocLength = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a4">getBufferLength</a>();
00705     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#r2">rawData</a>;
00706     <a class="code" href="group__int__datatypes.html#ga9">Uint16</a> <span class="keyword">const</span> length = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a2">getLength</a>();
00707 
00708     <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00709 
00710     <span class="keywordflow">if</span> (offset &gt; length) {
00711         <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a107a3">DBJ_PARAMETER_FAIL</a>);
00712         <span class="keywordflow">goto</span> cleanup;
00713     }
00714 
00715     <span class="comment">// Vergroesse Record-internen Puffer nach Bedarf</span>
00716     <span class="keywordflow">if</span> (recordLength + numBytes &gt; allocLength) {
00717         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *tmp = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[recordLength + numBytes + 20];
00718         <span class="keywordflow">if</span> (!tmp) {
00719             <span class="keywordflow">goto</span> cleanup;
00720         }
00721         <a class="code" href="group__memory__functions.html#ga5">DbjMemCopy</a>(tmp, data, length);
00722         <span class="keyword">delete</span> <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#r2">rawData</a>;
00723         <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#r2">rawData</a> = tmp;
00724         <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#r4">allocLength</a> = length + numBytes + 20;
00725         data = tmp;
00726     }
00727 
00728     <span class="keywordflow">if</span> (numBytes == 0 || offset == length) {
00729         <span class="keywordflow">goto</span> cleanup; <span class="comment">// nichts zu kopieren</span>
00730     }
00731 
00732     <span class="comment">// kopiere alles hinter die zu schaffende Luecke</span>
00733     <span class="keywordflow">for</span> (<a class="code" href="group__int__datatypes.html#ga9">Uint16</a> i = length - offset; i--;) {
00734         data[offset + numBytes + i] = data[offset + i];
00735     }
00736 
00737  cleanup:
00738     <span class="keywordflow">if</span> (<a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>() == <a class="code" href="_dbj_error_codes_8hpp.html#a107a1">DBJ_SUCCESS</a>) {
00739         <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#r3">rawDataLength</a> += numBytes;
00740         recordData = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#r2">rawData</a>;
00741         recordLength = <a class="code" href="class_dbj_record_tuple.html#r0">record</a>-&gt;<a class="code" href="class_dbj_record.html#a2">getLength</a>();
00742     }
00743     <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00744 }
00745 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jul 4 15:40:30 2005 for Jenas Datenbanksystem 'System J' by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.8 </small></address>
</body>
</html>
