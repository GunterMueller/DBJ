<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Jenas Datenbanksystem &apos;System J&apos;: DbjIMFreeSpaceMap.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>DbjIMFreeSpaceMap.cpp</h1><a href="_dbj_i_m_free_space_map_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="preprocessor">#include "<a class="code" href="_dbj_8hpp.html">Dbj.hpp</a>"</span>
00002 <span class="preprocessor">#include "<a class="code" href="_dbj_types_8hpp.html">DbjTypes.hpp</a>"</span>
00003 <span class="preprocessor">#include "<a class="code" href="_dbj_i_m_free_space_map_8hpp.html">DbjIMFreeSpaceMap.hpp</a>"</span>
00004 <span class="preprocessor">#include "<a class="code" href="_dbj_buffer_manager_8hpp.html">DbjBufferManager.hpp</a>"</span>
00005 <span class="preprocessor">#include "<a class="code" href="_dbj_page_8hpp.html">DbjPage.hpp</a>"</span>
00006 
<a name="l00010"></a><a class="code" href="class_dbj_i_m_free_space_map.html#a7">00010</a> <a class="code" href="class_dbj_i_m_free_space_map.html#a7">DbjIMFreeSpaceMap::DbjIMFreeSpaceMap</a>(<a class="code" href="group__tableid.html#ga0">SegmentId</a> segId, <span class="keywordtype">bool</span> create) : segmentId(segId), rootPageId(0)
00011 {
00012         <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> error;
00013         <a class="code" href="class_dbj_buffer_manager.html">DbjBufferManager</a> *buffer = <a class="code" href="class_dbj_buffer_manager.html#e0">DbjBufferManager::getInstance</a>();
00014                 
00015         <span class="comment">// Segment oeffnen</span>
00016         error = buffer-&gt;<a class="code" href="class_dbj_buffer_manager.html#a2">openSegment</a>(<a class="code" href="class_dbj_i_m_free_space_map.html#r0">segmentId</a>);
00017         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00018                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00019                 <span class="comment">// return DbjGetErrorCode();</span>
00020         }
00021         
00022         <span class="comment">// Seite erzeugen, falls noetig</span>
00023         <span class="keywordflow">if</span>(create) {
00024                 <a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html">UsedSpaceMap</a> *map = NULL;
00025                 
00026                 <span class="comment">// Seite erzeugen</span>
00027                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d3">newMap</a>(<a class="code" href="class_dbj_i_m_free_space_map.html#r0">segmentId</a>, <a class="code" href="_dbj_i_m_free_space_map_8hpp.html#a0">DEFAULT_USED_SPACE_MAP_PAGEID</a>, map);
00028                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00029                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00030                         <span class="comment">// return DbjGetErrorCode();</span>
00031                 }
00032         }
00033 }
00034  
<a name="l00038"></a><a class="code" href="class_dbj_i_m_free_space_map.html#a8">00038</a> <a class="code" href="class_dbj_i_m_free_space_map.html#a8">DbjIMFreeSpaceMap::~DbjIMFreeSpaceMap</a>() {
00039 }
00040 
<a name="l00045"></a><a class="code" href="class_dbj_i_m_free_space_map.html#a6">00045</a> <a class="code" href="group__tableid.html#ga0">SegmentId</a> <a class="code" href="class_dbj_i_m_free_space_map.html#a6">DbjIMFreeSpaceMap::getSegmentId</a>() {
00046         <span class="keywordflow">return</span> <a class="code" href="class_dbj_i_m_free_space_map.html#r0">segmentId</a>;
00047 }
00048 
<a name="l00052"></a><a class="code" href="class_dbj_i_m_free_space_map.html#a4">00052</a> <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> <a class="code" href="class_dbj_i_m_free_space_map.html#a4">DbjIMFreeSpaceMap::getRootPageId</a>(<a class="code" href="group__id__datatypes.html#ga1">PageId</a> *pageId) {
00053         <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00054         
00055         <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> error;
00056         <a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html">UsedSpaceMap</a> *map = NULL;
00057         <a class="code" href="group__id__datatypes.html#ga1">PageId</a> tmp = 0;
00058         
00059         <span class="comment">// Tabelle laden</span>
00060         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d0">getMap</a>(<a class="code" href="class_dbj_i_m_free_space_map.html#a6">getSegmentId</a>(), <a class="code" href="_dbj_i_m_free_space_map_8hpp.html#a0">DEFAULT_USED_SPACE_MAP_PAGEID</a>, map);
00061         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00062                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00063                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00064         }
00065         
00066         <span class="comment">// Seite auslesen</span>
00067         tmp = map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o1">rootPageId</a>;
00068         pageId = &amp;tmp;
00069         
00070         <span class="comment">// Tabelle schliessen</span>
00071         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d1">releaseMap</a>(map);
00072         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00073                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00074                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00075         }
00076 
00077         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>;
00078 }
00079 
<a name="l00083"></a><a class="code" href="class_dbj_i_m_free_space_map.html#a5">00083</a> <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> <a class="code" href="class_dbj_i_m_free_space_map.html#a5">DbjIMFreeSpaceMap::setRootPageId</a>(<a class="code" href="group__id__datatypes.html#ga1">PageId</a> pageId) {
00084         <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00085         
00086         <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> error;
00087         <a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html">UsedSpaceMap</a> *map = NULL;
00088         <a class="code" href="group__id__datatypes.html#ga1">PageId</a> currentMap = <a class="code" href="_dbj_i_m_free_space_map_8hpp.html#a0">DEFAULT_USED_SPACE_MAP_PAGEID</a>;
00089         
00090         <span class="keywordflow">do</span> {
00091                 <span class="comment">// Tabelle oeffnen</span>
00092                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d0">getMap</a>(<a class="code" href="class_dbj_i_m_free_space_map.html#a6">getSegmentId</a>(), currentMap, map);
00093                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00094                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00095                         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00096                 }
00097                 
00098                 <span class="comment">// Wurzelseite setzen</span>
00099                 map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o1">rootPageId</a> = pageId;
00100                 currentMap = map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o3">nextMap</a>;
00101                 
00102                 <span class="comment">// als geaendert markieren</span>
00103                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d4">modifiedMap</a>(map);
00104                 
00105                 <span class="comment">// Tabelle schliessen</span>
00106                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d1">releaseMap</a>(map);
00107                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00108                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00109                         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00110                 }
00111         } <span class="keywordflow">while</span>(currentMap != 0);
00112         
00113         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>;
00114 }
00115 
<a name="l00119"></a><a class="code" href="class_dbj_i_m_free_space_map.html#a2">00119</a> <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> <a class="code" href="class_dbj_i_m_free_space_map.html#a2">DbjIMFreeSpaceMap::addPage</a>(<a class="code" href="group__id__datatypes.html#ga1">PageId</a> pageId, DbjBufferManager::PageType pageType) {
00120         <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00121         
00122         <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> error;
00123         <a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html">UsedSpaceMap</a> *map = NULL;
00124         <a class="code" href="group__id__datatypes.html#ga1">PageId</a> currentMap = <a class="code" href="_dbj_i_m_free_space_map_8hpp.html#a0">DEFAULT_USED_SPACE_MAP_PAGEID</a>;
00125         
00126         <span class="keywordflow">do</span> {
00127                 <span class="comment">// Tabelle laden</span>
00128                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d0">getMap</a>(<a class="code" href="class_dbj_i_m_free_space_map.html#a6">getSegmentId</a>(), currentMap, map);
00129                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00130                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00131                         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00132                 }
00133                 
00134                 <span class="comment">// Pruefen, ob Wert eingefuegt werden kann</span>
00135                 <span class="keywordflow">if</span>(map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a> == <a class="code" href="_dbj_i_m_free_space_map_8hpp.html#a1">MAX_PAGES_PER_MAP</a>) {
00136                         <span class="comment">// Pruefen, ob Seiten ID hier passt</span>
00137                         <span class="keywordflow">if</span>(pageId &lt;= map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a> - 1]) {
00138                                 <a class="code" href="group__id__datatypes.html#ga1">PageId</a> maxId = map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a> - 1];
00139                                 DbjBufferManager::PageType maxType = map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o3">types</a>[map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a> - 1];
00140                                 <span class="keywordtype">int</span> index = 0;
00141                                 
00142                                 <span class="comment">// Neue Seiten ID einfuegen</span>
00143                                 <span class="keywordflow">while</span>(map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[index] &lt; pageId) {
00144                                         index++;
00145                                 }
00146                                 <span class="keywordflow">if</span>(map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[index] != pageId) {
00147                                         <span class="keywordflow">for</span>(<a class="code" href="group__int__datatypes.html#ga15">Uint32</a> i=(index + 1); i&lt;<a class="code" href="_dbj_i_m_free_space_map_8hpp.html#a1">MAX_PAGES_PER_MAP</a>; i++) {
00148                                                 map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[i] = map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[i - 1];
00149                                                 map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o3">types</a>[i] = map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o3">types</a>[i - 1];
00150                                         }
00151                                         map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[index] = pageId;
00152                                         map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o3">types</a>[index] = pageType;
00153                                         
00154                                         <span class="comment">// als geaendert markieren</span>
00155                                         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d4">modifiedMap</a>(map);
00156                                         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00157                                                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00158                                                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00159                                         }
00160 
00161                                         <span class="comment">// Seite freigeben</span>
00162                                         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d1">releaseMap</a>(map);
00163                                         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00164                                                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00165                                                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00166                                         }
00167                                         currentMap = 0;
00168                                 
00169                                         <span class="comment">// Alte Seiten ID einfuegen</span>
00170                                         <a class="code" href="class_dbj_i_m_free_space_map.html#a2">addPage</a>(maxId, maxType);
00171                                 } <span class="keywordflow">else</span> {
00172                                         <span class="comment">// Seite freigeben</span>
00173                                         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d1">releaseMap</a>(map);
00174                                         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00175                                                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00176                                                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00177                                         }
00178                                         currentMap = 0;
00179                                 }
00180                         } <span class="keywordflow">else</span> {
00181                                 <span class="keywordflow">if</span>(map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o3">nextMap</a> != 0) {
00182                                         <span class="comment">// naechste Tabelle versuchen</span>
00183                                         currentMap = map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o3">nextMap</a>;
00184                                 } <span class="keywordflow">else</span> {
00185                                         <a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html">UsedSpaceMap</a> *tmpMap = NULL;
00186                                         
00187                                         <span class="comment">// neue Tabelle erzeugen</span>
00188                                         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d3">newMap</a>(<a class="code" href="class_dbj_i_m_free_space_map.html#a6">getSegmentId</a>(), pageId + 1, tmpMap);
00189                                         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00190                                                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00191                                                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00192                                         }
00193                                         map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o3">nextMap</a> = tmpMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o2">pageId</a>;
00194                                         currentMap = tmpMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o2">pageId</a>;
00195                                         
00196                                         <span class="comment">// als geaendert markieren</span>
00197                                         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d4">modifiedMap</a>(map);
00198                                         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00199                                                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00200                                                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00201                                         }
00202 
00203                                         <span class="comment">// freigeben</span>
00204                                         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d1">releaseMap</a>(map);
00205                                         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00206                                                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00207                                                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00208                                         }
00209                                 }
00210                         }
00211                 } <span class="keywordflow">else</span> {
00212                         <span class="keywordtype">int</span> index = 0;
00213                                 
00214                         <span class="comment">// Neue Seiten ID einfuegen</span>
00215                         <span class="keywordflow">while</span>(map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[index] &lt; pageId) {
00216                                 index++;
00217                         }
00218                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=(index + 1); i&lt;=map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a>; i++) {
00219                                 map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[i] = map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[i - 1];
00220                                 map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o3">types</a>[i] = map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o3">types</a>[i - 1];
00221                         }
00222                         map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[index] = pageId;
00223                         map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[index] = pageType;
00224                         map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a>++;
00225                                         
00226                         <span class="comment">// als geaendert markieren</span>
00227                         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d4">modifiedMap</a>(map);
00228                         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00229                                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00230                                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00231                         }
00232 
00233                         <span class="comment">// Seite freigeben</span>
00234                         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d1">releaseMap</a>(map);
00235                         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00236                                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00237                                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00238                         }
00239                         currentMap = 0;
00240                 }
00241         } <span class="keywordflow">while</span>(currentMap != 0);
00242 
00243         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>;
00244 }
00245 
<a name="l00249"></a><a class="code" href="class_dbj_i_m_free_space_map.html#a1">00249</a> <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> <a class="code" href="class_dbj_i_m_free_space_map.html#a1">DbjIMFreeSpaceMap::freePage</a>(<a class="code" href="group__id__datatypes.html#ga1">PageId</a> pageId) {
00250         <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00251         
00252         <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> error;
00253         <a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html">UsedSpaceMap</a> *currentMap = NULL, *nextMap = NULL;
00254         <a class="code" href="group__id__datatypes.html#ga1">PageId</a> currentMapPageId = <a class="code" href="_dbj_i_m_free_space_map_8hpp.html#a0">DEFAULT_USED_SPACE_MAP_PAGEID</a>;
00255         
00256         <span class="keywordflow">do</span> {
00257                 <span class="comment">// Tabelle laden</span>
00258                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d0">getMap</a>(<a class="code" href="class_dbj_i_m_free_space_map.html#a6">getSegmentId</a>(), currentMapPageId, currentMap);
00259                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00260                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00261                         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00262                 }
00263                 
00264                 <span class="comment">// Pruefen, ob Wert enthalten ist</span>
00265                 <span class="keywordflow">if</span>(pageId &lt;= currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a> - 1]) {
00266                         <span class="comment">// Wert entfernen</span>
00267                         <span class="keywordtype">int</span> index = 0;
00268                         
00269                         <span class="keywordflow">while</span>(currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[index] != pageId) {
00270                                 index++;
00271                         }
00272                         
00273                         <span class="comment">// Wert enthalten???</span>
00274                         <span class="keywordflow">if</span>(index == currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a>) {              <span class="comment">// NEIN</span>
00275                                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d1">releaseMap</a>(currentMap);
00276                                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00277                                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00278                                         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00279                                 }
00280         
00281                                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>;
00282                         } <span class="keywordflow">else</span> {                                        <span class="comment">// JA</span>
00283                                 <span class="keywordflow">while</span>(currentMap != NULL) {
00284                                         <span class="comment">// Werte verschieben</span>
00285                                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=index; i&lt;(currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a> - 1); i++) {
00286                                                 currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[i] = currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[i + 1];
00287                                         }
00288                                 
00289                                         <span class="comment">// Anzahl der Werte anpassen</span>
00290                                         <span class="keywordflow">if</span>(currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a> &lt; <a class="code" href="_dbj_i_m_free_space_map_8hpp.html#a1">MAX_PAGES_PER_MAP</a> || currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o3">nextMap</a> == 0) {
00291                                                 currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a>--;
00292                                                 
00293                                                 <span class="keywordflow">if</span>(currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a> == 0) {
00294                                                         <span class="comment">// Tabelle entfernen falls leer</span>
00295                                                         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d2">dropMap</a>(currentMap);
00296                                                         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00297                                                                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00298                                                                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00299                                                         }
00300                                                 } <span class="keywordflow">else</span> {
00301                                                         <span class="comment">// als geaendert markieren</span>
00302                                                         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d4">modifiedMap</a>(currentMap);
00303                                                         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00304                                                                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00305                                                                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00306                                                         }
00307                                                 }
00308                                                 
00309                                                 currentMap = NULL;
00310                                         } <span class="keywordflow">else</span> {
00311                                                 <span class="comment">// naechste Tabelle laden</span>
00312                                                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d0">getMap</a>(<a class="code" href="class_dbj_i_m_free_space_map.html#a6">getSegmentId</a>(), currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o3">nextMap</a>, nextMap);
00313                                                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00314                                                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00315                                                         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00316                                                 }
00317                                                 
00318                                                 <span class="comment">// Wert aus naechster Tabelle holen</span>
00319                                                 currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[<a class="code" href="_dbj_i_m_free_space_map_8hpp.html#a1">MAX_PAGES_PER_MAP</a> - 1] = nextMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[0];
00320                                                 index = 0;
00321                                                 
00322                                                 <span class="comment">// als geaendert markieren</span>
00323                                                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d4">modifiedMap</a>(currentMap);
00324                                                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00325                                                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00326                                                         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00327                                                 }
00328                                                 
00329                                                 <span class="comment">// alte Tabelle freigeben</span>
00330                                                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d1">releaseMap</a>(currentMap);
00331                                                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00332                                                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00333                                                         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00334                                                 }
00335                                                 
00336                                                 currentMap = nextMap;
00337                                         }
00338                                 }
00339                                 
00340                                 currentMapPageId =  0;
00341                         }
00342                 } <span class="keywordflow">else</span> {
00343                         <span class="comment">// naechste Tabelle bestellen</span>
00344                         currentMapPageId = currentMap-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o3">nextMap</a>;
00345                         
00346                         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d1">releaseMap</a>(currentMap);
00347                         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00348                                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00349                                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00350                         }
00351                 }
00352         } <span class="keywordflow">while</span>(currentMapPageId != 0);
00353         
00354         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>;
00355 }
00356 
<a name="l00360"></a><a class="code" href="class_dbj_i_m_free_space_map.html#a0">00360</a> <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> <a class="code" href="class_dbj_i_m_free_space_map.html#a0">DbjIMFreeSpaceMap::next</a>(<a class="code" href="group__id__datatypes.html#ga1">PageId</a> *pageId, DbjBufferManager::PageType pageType) {
00361         <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00362         
00363         <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> error;
00364         <a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html">UsedSpaceMap</a> *map = NULL;
00365         <a class="code" href="group__id__datatypes.html#ga1">PageId</a> currentMap = <a class="code" href="_dbj_i_m_free_space_map_8hpp.html#a0">DEFAULT_USED_SPACE_MAP_PAGEID</a>,
00366                 tmpId = <a class="code" href="_dbj_i_m_free_space_map_8hpp.html#a0">DEFAULT_USED_SPACE_MAP_PAGEID</a>;
00367         
00368         <span class="keywordflow">do</span> {
00369                 <span class="comment">// Tabelle laden</span>
00370                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d0">getMap</a>(<a class="code" href="class_dbj_i_m_free_space_map.html#a6">getSegmentId</a>(), currentMap, map);
00371                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00372                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00373                         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00374                 }
00375                 
00376                 <span class="comment">// Freie Seite suchen</span>
00377                 <span class="keywordtype">int</span> index = 0;
00378                 <span class="keywordflow">while</span>(index &lt; map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a>) {
00379                         <span class="keywordflow">if</span>(tmpId &lt; map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[index]) {
00380                                 pageId = &amp;tmpId;
00381                                 
00382                                 <span class="comment">// Seite freigeben</span>
00383                                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d1">releaseMap</a>(map);
00384                                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00385                                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00386                                         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00387                                 }
00388                                 
00389                                 <span class="comment">// Seite hinzufuegen</span>
00390                                 <a class="code" href="class_dbj_i_m_free_space_map.html#a2">addPage</a>(tmpId, pageType);
00391 
00392                                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>;
00393                         } <span class="keywordflow">else</span> {
00394                                 index++;
00395                                 tmpId++;
00396                         }
00397                 }
00398                 
00399                 <span class="comment">// naechste Tabelle laden???</span>
00400                 <span class="keywordflow">if</span>(map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o3">nextMap</a> != 0) {
00401                         currentMap = map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o3">nextMap</a>;
00402                 } <span class="keywordflow">else</span> {
00403                         tmpId++;
00404                         pageId = &amp;tmpId;
00405                         currentMap = 0;
00406                                 
00407                         <span class="comment">// Seite hinzufuegen</span>
00408                         <a class="code" href="class_dbj_i_m_free_space_map.html#a2">addPage</a>(tmpId, pageType);
00409                 }
00410                 
00411                 <span class="comment">// Seite freigeben</span>
00412                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d1">releaseMap</a>(map);
00413                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00414                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00415                         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00416                 }
00417         } <span class="keywordflow">while</span>(currentMap != 0);
00418         
00419         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>;
00420 }
00421 
<a name="l00425"></a><a class="code" href="class_dbj_i_m_free_space_map.html#a3">00425</a> <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> <a class="code" href="class_dbj_i_m_free_space_map.html#a3">DbjIMFreeSpaceMap::getPageType</a>(<a class="code" href="group__id__datatypes.html#ga1">PageId</a> pageId, DbjBufferManager::PageType *pageType) {
00426         <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00427         
00428         <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> error, returnError;
00429         <a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html">UsedSpaceMap</a> *map = NULL;
00430         <a class="code" href="group__id__datatypes.html#ga1">PageId</a> currentMap = <a class="code" href="_dbj_i_m_free_space_map_8hpp.html#a0">DEFAULT_USED_SPACE_MAP_PAGEID</a>;
00431         
00432         <span class="keywordflow">do</span> {
00433                 <span class="comment">// Tabelle laden</span>
00434                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d0">getMap</a>(<a class="code" href="class_dbj_i_m_free_space_map.html#a6">getSegmentId</a>(), currentMap, map);
00435                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00436                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00437                         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00438                 }
00439                 
00440                 <span class="comment">// Seite suchen</span>
00441                 <span class="keywordflow">if</span>(pageId &lt; map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a> - 1]) {
00442                         <span class="keywordtype">int</span> index = 0;
00443                         
00444                         <span class="comment">// Index suchen</span>
00445                         <span class="keywordflow">while</span>(pageId &lt; map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[index]) {
00446                                 index++;
00447                         }
00448                         
00449                         <span class="comment">// Seite pruefen</span>
00450                         <span class="keywordflow">if</span>(pageId == map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o2">pages</a>[index]) {
00451                                 DbjBufferManager::PageType tmp = map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o3">types</a>[index];
00452                                 pageType = &amp;tmp;
00453                                 
00454                                 returnError = <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>;
00455                         } <span class="keywordflow">else</span> {
00456                                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a99a63">DBJ_IM_PAGE_NOT_USED</a>);
00457                                 returnError = <a class="code" href="_dbj_error_codes_8hpp.html#a99a63">DBJ_IM_PAGE_NOT_USED</a>;
00458                         }
00459                 } <span class="keywordflow">else</span> {
00460                         <span class="keywordflow">if</span>(map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o3">nextMap</a> != 0) {
00461                                 currentMap = map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o3">nextMap</a> != 0;
00462                         } <span class="keywordflow">else</span> {
00463                                 <a class="code" href="_dbj_error_8hpp.html#a1">DBJ_SET_ERROR</a>(<a class="code" href="_dbj_error_codes_8hpp.html#a99a63">DBJ_IM_PAGE_NOT_USED</a>);
00464                                 returnError = <a class="code" href="_dbj_error_codes_8hpp.html#a99a63">DBJ_IM_PAGE_NOT_USED</a>;
00465                                 currentMap = 0;
00466                         }
00467                 }
00468                 
00469                 <span class="comment">// Tabelle freigeben</span>
00470                 error = <a class="code" href="class_dbj_i_m_free_space_map.html#d1">releaseMap</a>(map);
00471                 <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00472                         <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00473                         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00474                 }
00475         } <span class="keywordflow">while</span>(currentMap != 0);
00476 
00477         <span class="keywordflow">return</span> returnError;
00478 }
00479 
<a name="l00483"></a><a class="code" href="class_dbj_i_m_free_space_map.html#d0">00483</a> <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> <a class="code" href="class_dbj_i_m_free_space_map.html#d0">DbjIMFreeSpaceMap::getMap</a>(<a class="code" href="group__tableid.html#ga0">SegmentId</a> segId, <a class="code" href="group__id__datatypes.html#ga1">PageId</a> pageId, <a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html">UsedSpaceMap</a> *map) {
00484         <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00485         
00486         <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> error;
00487         <a class="code" href="class_dbj_buffer_manager.html">DbjBufferManager</a> *buffer = <a class="code" href="class_dbj_buffer_manager.html#e0">DbjBufferManager::getInstance</a>();
00488         <a class="code" href="class_dbj_page.html">DbjPage</a> *page = NULL;
00489         
00490         <span class="comment">// Seite aus dem Speicher holen</span>
00491         error = buffer-&gt;<a class="code" href="class_dbj_buffer_manager.html#a4">getPage</a>(segId, pageId, DbjBufferManager::FreeSpaceInventoryPage, page);
00492         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00493                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00494                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00495         }
00496         
00497         <span class="comment">// Seitendaten lesen</span>
00498         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pageData = page-&gt;<a class="code" href="class_dbj_page.html#a3">getPageData</a>();
00499         map = reinterpret_cast&lt;UsedSpaceMap *&gt;(pageData);
00500         
00501         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>;
00502 }
00503         
<a name="l00507"></a><a class="code" href="class_dbj_i_m_free_space_map.html#d1">00507</a> <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> <a class="code" href="class_dbj_i_m_free_space_map.html#d1">DbjIMFreeSpaceMap::releaseMap</a>(<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html">UsedSpaceMap</a> *map) {
00508         <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00509         
00510         <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> error;
00511         <a class="code" href="class_dbj_buffer_manager.html">DbjBufferManager</a> *buffer = <a class="code" href="class_dbj_buffer_manager.html#e0">DbjBufferManager::getInstance</a>();
00512         
00513         <span class="comment">// Seite freigeben</span>
00514         error = buffer-&gt;<a class="code" href="class_dbj_buffer_manager.html#a6">releasePage</a>(map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o0">segmentId</a>, map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o2">pageId</a>);
00515         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00516                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00517                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00518         }
00519         
00520         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>;
00521 }
00522 
<a name="l00526"></a><a class="code" href="class_dbj_i_m_free_space_map.html#d2">00526</a> <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> <a class="code" href="class_dbj_i_m_free_space_map.html#d2">DbjIMFreeSpaceMap::dropMap</a>(<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html">UsedSpaceMap</a> *map) {
00527         <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00528         
00529         <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> error;
00530         
00531         <span class="comment">// Seite als nicht mehr genutzt markieren</span>
00532         <a class="code" href="class_dbj_i_m_free_space_map.html#a1">freePage</a>(map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o2">pageId</a>);
00533         
00534         <span class="comment">// Tabelle freigeben</span>
00535         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d1">releaseMap</a>(map);
00536         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00537                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00538                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00539         }
00540 
00541         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>;
00542 }
00543 
<a name="l00547"></a><a class="code" href="class_dbj_i_m_free_space_map.html#d3">00547</a> <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> <a class="code" href="class_dbj_i_m_free_space_map.html#d3">DbjIMFreeSpaceMap::newMap</a>(<a class="code" href="group__tableid.html#ga0">SegmentId</a> segId, <a class="code" href="group__id__datatypes.html#ga1">PageId</a> pageId, <a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html">UsedSpaceMap</a> *map) {
00548         <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00549         
00550         <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> error;
00551         <a class="code" href="class_dbj_buffer_manager.html">DbjBufferManager</a> *buffer = <a class="code" href="class_dbj_buffer_manager.html#e0">DbjBufferManager::getInstance</a>();
00552         <a class="code" href="class_dbj_page.html">DbjPage</a> *page = NULL;
00553         
00554         <span class="comment">// Neue Seite anfordern</span>
00555         error = buffer-&gt;<a class="code" href="class_dbj_buffer_manager.html#a5">getNewPage</a>(segId, pageId, DbjBufferManager::FreeSpaceInventoryPage, page);
00556         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00557                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00558                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00559         }
00560         
00561         <span class="comment">// Seiten Daten laden</span>
00562         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pageData = page-&gt;<a class="code" href="class_dbj_page.html#a3">getPageData</a>();
00563         map = reinterpret_cast&lt;UsedSpaceMap *&gt;(pageData);
00564         map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o0">segmentId</a> = segId;
00565         map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o2">pageId</a> = pageId;
00566         map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o3">nextMap</a> = 0;
00567         map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o1">entries</a> = 0;
00568         
00569         <span class="comment">// Seite als geaendert markieren</span>
00570         error = <a class="code" href="class_dbj_i_m_free_space_map.html#d4">modifiedMap</a>(map);
00571         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00572                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00573                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00574         }
00575         
00576         <span class="comment">// Genutzte Seite markieren</span>
00577         <a class="code" href="class_dbj_i_m_free_space_map.html#a2">addPage</a>(pageId, DbjBufferManager::FreeSpaceInventoryPage);
00578         
00579         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>;
00580 }
00581 
<a name="l00585"></a><a class="code" href="class_dbj_i_m_free_space_map.html#d4">00585</a> <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> <a class="code" href="class_dbj_i_m_free_space_map.html#d4">DbjIMFreeSpaceMap::modifiedMap</a>(<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html">UsedSpaceMap</a> *map) {
00586         <a class="code" href="group__trace__def.html#ga0">DBJ_TRACE_ENTRY</a>();
00587         
00588         <a class="code" href="_dbj_error_codes_8hpp.html#a99">DbjErrorCode</a> error;
00589         <a class="code" href="class_dbj_buffer_manager.html">DbjBufferManager</a> *buffer = <a class="code" href="class_dbj_buffer_manager.html#e0">DbjBufferManager::getInstance</a>();
00590         
00591         <span class="comment">// Seite markieren</span>
00592         error = buffer-&gt;<a class="code" href="class_dbj_buffer_manager.html#a7">markAsModified</a>(map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o0">segmentId</a>, map-&gt;<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map.html#o0">header</a>.<a class="code" href="struct_dbj_i_m_free_space_map_1_1_used_space_map_header.html#o2">pageId</a>);
00593         <span class="keywordflow">if</span>(error != <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>) {
00594                 <a class="code" href="_dbj_error_8hpp.html#a8">DBJ_TRACE_ERROR</a>();
00595                 <span class="keywordflow">return</span> <a class="code" href="_dbj_error_8hpp.html#a11">DbjGetErrorCode</a>();
00596         }
00597         
00598         <span class="keywordflow">return</span> <a class="code" href="_dbj_error_codes_8hpp.html#a99a1">DBJ_SUCCESS</a>;
00599 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jan 3 10:00:50 2005 for Jenas Datenbanksystem 'System J' by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.8 </small></address>
</body>
</html>
