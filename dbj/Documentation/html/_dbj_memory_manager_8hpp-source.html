<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Jenas Datenbanksystem &apos;System J&apos;: DbjMemoryManager.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>DbjMemoryManager.hpp</h1><a href="_dbj_memory_manager_8hpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************\</span>
00002 <span class="comment"> *                                                                       *</span>
00003 <span class="comment"> * (C) 2004-2005                                                         *</span>
00004 <span class="comment"> * Lehrstuhl fuer Datenbanken und Informationssysteme                    *</span>
00005 <span class="comment"> * Friedrich-Schiller-Universitaet Jena                                  *</span>
00006 <span class="comment"> * Ernst-Abbe-Platz 1-2                                                  *</span>
00007 <span class="comment"> * 07745 Jena                                                            *</span>
00008 <span class="comment"> *                                                                       *</span>
00009 <span class="comment">\*************************************************************************/</span>
00010 
00011 <span class="preprocessor">#if !defined(__DbjMemoryManager_hpp__)</span>
<a name="l00012"></a><a class="code" href="_dbj_memory_manager_8hpp.html#a0">00012</a> <span class="preprocessor"></span><span class="preprocessor">#define __DbjMemoryManager_hpp__</span>
00013 <span class="preprocessor"></span>
00014 <span class="preprocessor">#include "<a class="code" href="_dbj_8hpp.html">Dbj.hpp</a>"</span>
00015 <span class="preprocessor">#include &lt;new&gt;</span>
00016 
00017 
<a name="l00036"></a><a class="code" href="class_dbj_memory_manager.html">00036</a> <span class="keyword">class </span><a class="code" href="class_dbj_memory_manager.html">DbjMemoryManager</a> {
00037   <span class="keyword">public</span>:
<a name="l00042"></a><a class="code" href="class_dbj_memory_manager.html#w4">00042</a>     <span class="keyword">enum</span> <a class="code" href="class_dbj_memory_manager.html#w4">MemorySet</a> {
00044         <a class="code" href="class_dbj_memory_manager.html#w4w0">PrivatePool</a>,
00046         <a class="code" href="class_dbj_memory_manager.html#w4w1">BufferPool</a>,
00048         <a class="code" href="class_dbj_memory_manager.html#w4w2">LockList</a>,
00051         <a class="code" href="class_dbj_memory_manager.html#w4w3">FileAccess</a>
00052     };
00053 
<a name="l00060"></a><a class="code" href="class_dbj_memory_manager.html#e0">00060</a>     <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="class_dbj_memory_manager.html">DbjMemoryManager</a> *<a class="code" href="class_dbj_memory_manager.html#e0">getMemoryManager</a>()
00061           {
00062               <span class="keywordflow">if</span> (<a class="code" href="class_dbj_memory_manager.html#v1">instance</a> == NULL) {
00063                   <a class="code" href="class_dbj_memory_manager.html#v1">instance</a> = <span class="keyword">new</span> <a class="code" href="class_dbj_memory_manager.html#d5">DbjMemoryManager</a>();
00064               }
00065               <span class="keywordflow">return</span> <a class="code" href="class_dbj_memory_manager.html#v1">instance</a>;
00066           }
00067 
00095     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_memory_manager.html#a0">createMemorySet</a>(MemorySet <span class="keyword">const</span> memorySet);
00096 
00125     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_memory_manager.html#a1">destroyMemorySet</a>(MemorySet <span class="keyword">const</span> memorySet);
00126 
00141     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_memory_manager.html#a2">connectToMemorySet</a>(MemorySet <span class="keyword">const</span> setId, <span class="keywordtype">void</span> *&amp;ptr);
00142 
00158     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_memory_manager.html#a3">disconnectFromMemorySet</a>(MemorySet <span class="keyword">const</span> setId);
00159 
00179     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_memory_manager.html#a4">getMemoryBlock</a>(<a class="code" href="group__int__datatypes.html#ga15">Uint32</a> <span class="keyword">const</span> blockSize, <span class="keywordtype">void</span> *&amp;ptr,
00180             <span class="keywordtype">char</span> <span class="keyword">const</span> *fileName, <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> <span class="keyword">const</span> lineNumber,
00181             <span class="keywordtype">char</span> <span class="keyword">const</span> *function);
00182 
00199     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_memory_manager.html#a5">freeMemoryBlock</a>(<span class="keywordtype">void</span> *ptr, <span class="keywordtype">char</span> <span class="keyword">const</span> *fileName = NULL,
00200             <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> <span class="keyword">const</span> lineNumber = 0, <span class="keywordtype">char</span> <span class="keyword">const</span> *function = NULL);
00201 
00214     <span class="keywordtype">void</span> <a class="code" href="class_dbj_memory_manager.html#a6">memMove</a>(<span class="keywordtype">void</span> *destination, <span class="keywordtype">void</span> <span class="keyword">const</span> *source,
00215             <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> <span class="keyword">const</span> numBytes);
00216 
00228     <span class="keywordtype">void</span> <a class="code" href="class_dbj_memory_manager.html#a7">memCopy</a>(<span class="keywordtype">void</span> *destination, <span class="keywordtype">void</span> <span class="keyword">const</span> *source,
00229             <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> <span class="keyword">const</span> numBytes);
00230 
00242     <span class="keywordtype">void</span> <a class="code" href="class_dbj_memory_manager.html#a8">memSet</a>(<span class="keywordtype">void</span> *ptr, <span class="keywordtype">char</span> <span class="keyword">const</span> fillChar, <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> <span class="keyword">const</span> numBytes);
00243 
00259     <a class="code" href="group__datatypes.html#ga2">DbjCompareResult</a> <a class="code" href="class_dbj_memory_manager.html#a9">memCompare</a>(<span class="keywordtype">void</span> <span class="keyword">const</span> *ptr1, <span class="keywordtype">void</span> <span class="keyword">const</span> *ptr2,
00260             <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> <span class="keyword">const</span> numBytes);
00261 
00272     <span class="keywordtype">void</span> <a class="code" href="class_dbj_memory_manager.html#a10">dumpMemoryTrackInfo</a>() const;
00273 
00274   private:
<a name="l00280"></a><a class="code" href="struct_dbj_memory_manager_1_1_memory_set_attributes.html">00280</a>     struct <a class="code" href="struct_dbj_memory_manager_1_1_memory_set_attributes.html">MemorySetAttributes</a> {
<a name="l00282"></a><a class="code" href="struct_dbj_memory_manager_1_1_memory_set_attributes.html#o0">00282</a>         <a class="code" href="class_dbj_memory_manager.html#w4">MemorySet</a> setId;
<a name="l00284"></a><a class="code" href="struct_dbj_memory_manager_1_1_memory_set_attributes.html#o1">00284</a>         <span class="keywordtype">char</span> <span class="keyword">const</span> *name;
<a name="l00287"></a><a class="code" href="struct_dbj_memory_manager_1_1_memory_set_attributes.html#o2">00287</a>         <span class="keywordtype">bool</span> isShared;
<a name="l00289"></a><a class="code" href="struct_dbj_memory_manager_1_1_memory_set_attributes.html#o3">00289</a>         size_t size;
<a name="l00291"></a><a class="code" href="struct_dbj_memory_manager_1_1_memory_set_attributes.html#o4">00291</a>         <span class="keywordtype">int</span> shmId;
<a name="l00294"></a><a class="code" href="struct_dbj_memory_manager_1_1_memory_set_attributes.html#o5">00294</a>         <span class="keywordtype">void</span> <span class="keyword">const</span> *ptr;
00295     };
00296 
00298     <span class="keyword">static</span> <a class="code" href="struct_dbj_memory_manager_1_1_memory_set_attributes.html">MemorySetAttributes</a> <a class="code" href="class_dbj_memory_manager.html#v0">setProperties</a>[];
00300     <span class="keyword">static</span> <a class="code" href="class_dbj_memory_manager.html">DbjMemoryManager</a> *<a class="code" href="class_dbj_memory_manager.html#v1">instance</a>;
00301 
<a name="l00303"></a><a class="code" href="class_dbj_memory_manager.html#r0">00303</a>     <span class="keywordtype">void</span> *<a class="code" href="class_dbj_memory_manager.html#r0">allocInfo</a>;
00304 
00307     <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="class_dbj_memory_manager.html#h0">operator new</a>(size_t size) <span class="keywordflow">throw</span> (std::bad_alloc);
00308 
00310     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="class_dbj_memory_manager.html#h1">operator delete</a>(<span class="keywordtype">void</span> *ptr);
00311 
00330     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_memory_manager.html#d0">shutdown</a>();
00331 
00345     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_memory_manager.html#d1">getShmId</a>(MemorySet <span class="keyword">const</span> memorySet, <span class="keywordtype">int</span> &amp;shmId,
00346             <span class="keywordtype">bool</span> <span class="keyword">const</span> create = <span class="keyword">false</span>);
00347 
00357     <a class="code" href="_dbj_error_codes_8hpp.html#a107">DbjErrorCode</a> <a class="code" href="class_dbj_memory_manager.html#d2">getSetProperties</a>(MemorySet <span class="keyword">const</span> memorySet,
00358             <a class="code" href="struct_dbj_memory_manager_1_1_memory_set_attributes.html">MemorySetAttributes</a> *&amp;attributes) <span class="keyword">const</span>;
00359 
00366     <span class="keywordtype">void</span> <a class="code" href="class_dbj_memory_manager.html#d3">checkAllMemoryBoundaries</a>() const;
00367 
00384     <span class="keywordtype">void</span> checkMemoryBoundaries(<span class="keywordtype">void</span> const *ptr, <span class="keywordtype">char</span> const *fileName = NULL,
00385             <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> const lineNumber = 0) const;
00386 
00388     <a class="code" href="class_dbj_memory_manager.html">DbjMemoryManager</a>();
00390     ~<a class="code" href="class_dbj_memory_manager.html">DbjMemoryManager</a>();
00391 
00392     friend class <a class="code" href="class_dbj_system.html">DbjSystem</a>;
00393 };
00394 
00395 
00406 
00408 <span class="keywordtype">void</span> *operator new(size_t size, <span class="keywordtype">char</span> const *fileName,
00409         <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> const lineNumber, <span class="keywordtype">char</span> const *function) throw (std::bad_alloc);
00410 
00412 <span class="keywordtype">void</span> *operator new[](size_t size, <span class="keywordtype">char</span> const *fileName,
00413         <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> const lineNumber, <span class="keywordtype">char</span> const *function) throw (std::bad_alloc);
00414 
00416 <span class="keywordtype">void</span> operator delete(<span class="keywordtype">void</span> *ptr, <span class="keywordtype">char</span> const *fileName,
00417         <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> const lineNumber, <span class="keywordtype">char</span> const *function) throw();
00418 
00420 <span class="keywordtype">void</span> operator delete[](<span class="keywordtype">void</span> *ptr, <span class="keywordtype">char</span> const *fileName,
00421         <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> const lineNumber, <span class="keywordtype">char</span> const *function) throw();
00422 
00423 
<a name="l00426"></a><a class="code" href="group__memory__functions.html#ga8">00426</a> #define new     new(__FILE__, __LINE__, __FUNCTION__)
00427 
00428 
<a name="l00430"></a><a class="code" href="group__memory__functions.html#ga4">00430</a> inline <span class="keywordtype">void</span> DbjMemMove(<span class="keywordtype">void</span> *destination, <span class="keywordtype">void</span> const *source,
00431         <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> const numBytes)
00432 {
00433     <a class="code" href="class_dbj_memory_manager.html#e0">DbjMemoryManager::getMemoryManager</a>()-&gt;<a class="code" href="class_dbj_memory_manager.html#a6">memMove</a>(destination, source,
00434             numBytes);
00435 }
00436 
00437 
<a name="l00439"></a><a class="code" href="group__memory__functions.html#ga5">00439</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__memory__functions.html#ga5">DbjMemCopy</a>(<span class="keywordtype">void</span> *destination, <span class="keywordtype">void</span> <span class="keyword">const</span> *source,
00440         <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> <span class="keyword">const</span> numBytes)
00441 {
00442     <a class="code" href="class_dbj_memory_manager.html#e0">DbjMemoryManager::getMemoryManager</a>()-&gt;<a class="code" href="class_dbj_memory_manager.html#a7">memCopy</a>(destination, source,
00443             numBytes);
00444 }
00445 
00446 
<a name="l00448"></a><a class="code" href="group__memory__functions.html#ga6">00448</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__memory__functions.html#ga6">DbjMemSet</a>(<span class="keywordtype">void</span> *ptr, <span class="keywordtype">char</span> <span class="keyword">const</span> fillChar, <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> <span class="keyword">const</span> numBytes)
00449 {
00450     <a class="code" href="class_dbj_memory_manager.html#e0">DbjMemoryManager::getMemoryManager</a>()-&gt;<a class="code" href="class_dbj_memory_manager.html#a8">memSet</a>(ptr, fillChar, numBytes);
00451 }
00452 
00453 
<a name="l00455"></a><a class="code" href="group__memory__functions.html#ga7">00455</a> <span class="keyword">inline</span> <a class="code" href="group__datatypes.html#ga2">DbjCompareResult</a> <a class="code" href="group__memory__functions.html#ga7">DbjMemCompare</a>(<span class="keywordtype">void</span> <span class="keyword">const</span> *ptr1, <span class="keywordtype">void</span> <span class="keyword">const</span> *ptr2,
00456         <a class="code" href="group__int__datatypes.html#ga15">Uint32</a> <span class="keyword">const</span> numBytes)
00457 {
00458     <span class="keywordflow">return</span> <a class="code" href="class_dbj_memory_manager.html#e0">DbjMemoryManager::getMemoryManager</a>()-&gt;<a class="code" href="class_dbj_memory_manager.html#a9">memCompare</a>(
00459             ptr1, ptr2, numBytes);
00460 }
00461 
00463 
00464 <span class="preprocessor">#endif </span><span class="comment">/* __DbjMemoryManager_hpp__ */</span>
00465 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jul 4 15:40:29 2005 for Jenas Datenbanksystem 'System J' by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.8 </small></address>
</body>
</html>
